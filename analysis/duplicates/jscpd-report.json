{
  "statistics": {
    "detectionDate": "2025-12-29T13:31:40.187Z",
    "formats": {
      "typescript": {
        "sources": {
          "./lib/api/hooks/useWatchlists.ts": {
            "lines": 95,
            "tokens": 774,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/api/hooks/useStrategies.ts": {
            "lines": 125,
            "tokens": 1215,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/api/hooks/useSettings.ts": {
            "lines": 46,
            "tokens": 348,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/api/hooks/useSentiment.ts": {
            "lines": 17,
            "tokens": 169,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/api/hooks/usePortfolio.ts": {
            "lines": 145,
            "tokens": 1383,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/api/hooks/useOrders.ts": {
            "lines": 77,
            "tokens": 720,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/api/hooks/useMarketQuotes.ts": {
            "lines": 25,
            "tokens": 237,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/api/hooks/useFeedSources.ts": {
            "lines": 14,
            "tokens": 113,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/api/hooks/useCandidates.ts": {
            "lines": 57,
            "tokens": 501,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/api/hooks/useBacktests.ts": {
            "lines": 192,
            "tokens": 1639,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/api/hooks/useAiDecisions.ts": {
            "lines": 90,
            "tokens": 702,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/api/hooks/useAdmin.ts": {
            "lines": 678,
            "tokens": 5373,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/admin/services/provider-service.ts": {
            "lines": 419,
            "tokens": 4272,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/admin/services/orchestrator-service.ts": {
            "lines": 160,
            "tokens": 1599,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/admin/services/llm-router-service.ts": {
            "lines": 271,
            "tokens": 2675,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/admin/services/api-discovery-service.ts": {
            "lines": 367,
            "tokens": 3475,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/store/index.ts": {
            "lines": 189,
            "tokens": 1858,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/api/utils.ts": {
            "lines": 92,
            "tokens": 659,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/api/connectivity-test.ts": {
            "lines": 254,
            "tokens": 1896,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/api/client.ts": {
            "lines": 276,
            "tokens": 2289,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/admin/types.ts": {
            "lines": 338,
            "tokens": 2402,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/admin/supabase.ts": {
            "lines": 52,
            "tokens": 376,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/admin/encryption.ts": {
            "lines": 82,
            "tokens": 798,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./lib/types.ts": {
            "lines": 261,
            "tokens": 1837,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/shared/types.ts": {
            "lines": 259,
            "tokens": 1614,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 26,
            "duplicatedTokens": 152,
            "percentage": 10.04,
            "percentageTokens": 9.42,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/shared/technical-indicators.ts": {
            "lines": 497,
            "tokens": 5966,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/shared/index.ts": {
            "lines": 72,
            "tokens": 266,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/shared/genetic-algorithm.ts": {
            "lines": 552,
            "tokens": 5604,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/shared/backtest-engine.ts": {
            "lines": 517,
            "tokens": 5167,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 133,
            "duplicatedTokens": 1359,
            "percentage": 25.73,
            "percentageTokens": 26.3,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/shared/alpaca-api.ts": {
            "lines": 169,
            "tokens": 1430,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 22,
            "duplicatedTokens": 175,
            "percentage": 13.02,
            "percentageTokens": 12.24,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/verify-xss-protection.ts": {
            "lines": 100,
            "tokens": 769,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/test-sec-edgar.ts": {
            "lines": 174,
            "tokens": 2254,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/test-sec-edgar-multi.ts": {
            "lines": 98,
            "tokens": 1086,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/test-sanitization.ts": {
            "lines": 291,
            "tokens": 2174,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/test-new-modules.ts": {
            "lines": 278,
            "tokens": 2527,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/test-llm-fallbacks.ts": {
            "lines": 115,
            "tokens": 1022,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/test-gemini.ts": {
            "lines": 99,
            "tokens": 821,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/test-frankfurter.ts": {
            "lines": 200,
            "tokens": 1953,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/test-finra.ts": {
            "lines": 204,
            "tokens": 1915,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/test-critical-api-flows.ts": {
            "lines": 352,
            "tokens": 3161,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/test-api-client.ts": {
            "lines": 252,
            "tokens": 2120,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/test-all-endpoints.ts": {
            "lines": 263,
            "tokens": 2548,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/test-ai-tools.ts": {
            "lines": 386,
            "tokens": 3160,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 19,
            "duplicatedTokens": 185,
            "percentage": 4.92,
            "percentageTokens": 5.85,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/test-ai-tools-detailed.ts": {
            "lines": 280,
            "tokens": 2752,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 19,
            "duplicatedTokens": 185,
            "percentage": 6.79,
            "percentageTokens": 6.72,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/smoke-external-calls.ts": {
            "lines": 71,
            "tokens": 911,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/run-services.ts": {
            "lines": 123,
            "tokens": 1357,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/resource-monitor.ts": {
            "lines": 233,
            "tokens": 2161,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/regression-test-v2.ts": {
            "lines": 764,
            "tokens": 7358,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/omar-weight-optimizer-fast.ts": {
            "lines": 404,
            "tokens": 4538,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/omar-threshold-optimizer.ts": {
            "lines": 771,
            "tokens": 11294,
            "sources": 1,
            "clones": 27,
            "duplicatedLines": 1129,
            "duplicatedTokens": 16121,
            "percentage": 146.43,
            "percentageTokens": 142.74,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/omar-threshold-optimizer-fast.ts": {
            "lines": 753,
            "tokens": 10929,
            "sources": 1,
            "clones": 10,
            "duplicatedLines": 644,
            "duplicatedTokens": 9094,
            "percentage": 85.52,
            "percentageTokens": 83.21,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/omar-sector-rotation-optimizer.ts": {
            "lines": 690,
            "tokens": 8632,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 72,
            "duplicatedTokens": 1018,
            "percentage": 10.43,
            "percentageTokens": 11.79,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/omar-risk-optimizer.ts": {
            "lines": 678,
            "tokens": 9027,
            "sources": 1,
            "clones": 4,
            "duplicatedLines": 67,
            "duplicatedTokens": 828,
            "percentage": 9.88,
            "percentageTokens": 9.17,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/omar-momentum-optimizer.ts": {
            "lines": 803,
            "tokens": 10036,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 172,
            "duplicatedTokens": 2462,
            "percentage": 21.42,
            "percentageTokens": 24.53,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/omar-momentum-optimizer-fast.ts": {
            "lines": 666,
            "tokens": 8092,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 172,
            "duplicatedTokens": 2462,
            "percentage": 25.83,
            "percentageTokens": 30.43,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/omar-mean-reversion-optimizer.ts": {
            "lines": 822,
            "tokens": 11347,
            "sources": 1,
            "clones": 8,
            "duplicatedLines": 245,
            "duplicatedTokens": 3050,
            "percentage": 29.81,
            "percentageTokens": 26.88,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/omar-indicator-optimizer.ts": {
            "lines": 806,
            "tokens": 10503,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 42,
            "duplicatedTokens": 415,
            "percentage": 5.21,
            "percentageTokens": 3.95,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/omar-hyperoptimizer.ts": {
            "lines": 955,
            "tokens": 14939,
            "sources": 1,
            "clones": 6,
            "duplicatedLines": 221,
            "duplicatedTokens": 3328,
            "percentage": 23.14,
            "percentageTokens": 22.28,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/omar-hyperoptimizer-fast.ts": {
            "lines": 609,
            "tokens": 11185,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/omar-backtest.ts": {
            "lines": 777,
            "tokens": 9747,
            "sources": 1,
            "clones": 7,
            "duplicatedLines": 329,
            "duplicatedTokens": 2904,
            "percentage": 42.34,
            "percentageTokens": 29.79,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/omar-backtest-v2.ts": {
            "lines": 239,
            "tokens": 2037,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 148,
            "duplicatedTokens": 1218,
            "percentage": 61.92,
            "percentageTokens": 59.79,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/migrate-console-to-logger.ts": {
            "lines": 108,
            "tokens": 794,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/log-capture-server.ts": {
            "lines": 95,
            "tokens": 803,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/database-performance-test.ts": {
            "lines": 360,
            "tokens": 2941,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/create-service.ts": {
            "lines": 194,
            "tokens": 685,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/comprehensive-test-runner.ts": {
            "lines": 231,
            "tokens": 1869,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/comprehensive-performance-test.ts": {
            "lines": 390,
            "tokens": 4048,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./scripts/comprehensive-api-test.ts": {
            "lines": 531,
            "tokens": 5138,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/strategies/presets/preset-types.ts": {
            "lines": 238,
            "tokens": 1024,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/strategies/presets/preset-registry.ts": {
            "lines": 963,
            "tokens": 5270,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/backtesting/walk-forward-engine.ts": {
            "lines": 600,
            "tokens": 4760,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/backtesting/strategies.ts": {
            "lines": 268,
            "tokens": 2400,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 34,
            "duplicatedTokens": 260,
            "percentage": 12.69,
            "percentageTokens": 10.83,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/backtesting/overfitting-detector.ts": {
            "lines": 323,
            "tokens": 2307,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/backtesting/index.ts": {
            "lines": 52,
            "tokens": 243,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/backtesting/historical-data-service.ts": {
            "lines": 202,
            "tokens": 1577,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/backtesting/execution-engine.ts": {
            "lines": 567,
            "tokens": 5435,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/backtesting/backtest-runner.ts": {
            "lines": 340,
            "tokens": 2942,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/admin/trading.ts": {
            "lines": 756,
            "tokens": 7442,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/admin/system.ts": {
            "lines": 407,
            "tokens": 4014,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/admin/management.ts": {
            "lines": 343,
            "tokens": 3346,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/admin/index.ts": {
            "lines": 21,
            "tokens": 147,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/admin/api.ts": {
            "lines": 676,
            "tokens": 6099,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/admin/ai.ts": {
            "lines": 246,
            "tokens": 2488,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/replit_integrations/chat/storage.ts": {
            "lines": 65,
            "tokens": 600,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/replit_integrations/chat/routes.ts": {
            "lines": 143,
            "tokens": 1380,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/replit_integrations/batch/utils.ts": {
            "lines": 158,
            "tokens": 1100,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/providers/aitrados/aitradosService.ts": {
            "lines": 273,
            "tokens": 2059,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/providers/aitrados/aitradosSchemas.ts": {
            "lines": 100,
            "tokens": 1108,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/providers/aitrados/aitradosEndpoints.ts": {
            "lines": 130,
            "tokens": 1209,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/providers/aitrados/aitradosClient.ts": {
            "lines": 228,
            "tokens": 1801,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/validation/api-schemas.ts": {
            "lines": 235,
            "tokens": 2932,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/utils/numeric.ts": {
            "lines": 315,
            "tokens": 2620,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 26,
            "duplicatedTokens": 214,
            "percentage": 8.25,
            "percentageTokens": 8.17,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/utils/logger.ts": {
            "lines": 208,
            "tokens": 1939,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/universe/tradingEnforcement.ts": {
            "lines": 215,
            "tokens": 1707,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/universe/rebalancerService.ts": {
            "lines": 397,
            "tokens": 3271,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/universe/liquidityService.ts": {
            "lines": 353,
            "tokens": 2920,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 18,
            "duplicatedTokens": 152,
            "percentage": 5.1,
            "percentageTokens": 5.21,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/universe/index.ts": {
            "lines": 37,
            "tokens": 205,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/universe/fundamentalsService.ts": {
            "lines": 317,
            "tokens": 2931,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 36,
            "duplicatedTokens": 307,
            "percentage": 11.36,
            "percentageTokens": 10.47,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/universe/candidatesService.ts": {
            "lines": 441,
            "tokens": 3509,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/universe/asset-classifier.ts": {
            "lines": 518,
            "tokens": 4530,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 18,
            "duplicatedTokens": 155,
            "percentage": 3.47,
            "percentageTokens": 3.42,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/universe/alpacaUniverse.ts": {
            "lines": 372,
            "tokens": 3064,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/universe/allocationService.ts": {
            "lines": 323,
            "tokens": 2868,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/unified-order-executor.ts": {
            "lines": 473,
            "tokens": 3501,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/symbol-normalizer.ts": {
            "lines": 177,
            "tokens": 538,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 87,
            "duplicatedTokens": 350,
            "percentage": 49.15,
            "percentageTokens": 65.06,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/strategy-runner.ts": {
            "lines": 564,
            "tokens": 2368,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/smart-order-router.ts": {
            "lines": 634,
            "tokens": 4239,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/risk-validator.ts": {
            "lines": 396,
            "tokens": 1808,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/position-manager.ts": {
            "lines": 810,
            "tokens": 4760,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 25,
            "duplicatedTokens": 277,
            "percentage": 3.09,
            "percentageTokens": 5.82,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/portfolio-rebalancer.ts": {
            "lines": 618,
            "tokens": 3415,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/order-types-matrix.ts": {
            "lines": 922,
            "tokens": 5770,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/order-retry-api.ts": {
            "lines": 279,
            "tokens": 2166,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/order-executor.ts": {
            "lines": 628,
            "tokens": 3365,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 25,
            "duplicatedTokens": 277,
            "percentage": 3.98,
            "percentageTokens": 8.23,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/orchestrator-controller.ts": {
            "lines": 128,
            "tokens": 169,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/engine-types.ts": {
            "lines": 300,
            "tokens": 748,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/crypto-trading-config.ts": {
            "lines": 631,
            "tokens": 3934,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/broker-connection.ts": {
            "lines": 191,
            "tokens": 473,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/alpaca-trading-engine.ts": {
            "lines": 760,
            "tokens": 5535,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/alpaca-stream.ts": {
            "lines": 477,
            "tokens": 3891,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 26,
            "duplicatedTokens": 214,
            "percentage": 5.45,
            "percentageTokens": 5.5,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/trading/ai-analyzer.ts": {
            "lines": 828,
            "tokens": 4207,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 87,
            "duplicatedTokens": 350,
            "percentage": 10.51,
            "percentageTokens": 8.32,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/strategies/moving-average-crossover.ts": {
            "lines": 504,
            "tokens": 4919,
            "sources": 1,
            "clones": 13,
            "duplicatedLines": 359,
            "duplicatedTokens": 3560,
            "percentage": 71.23,
            "percentageTokens": 72.37,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/strategies/momentum-strategy.ts": {
            "lines": 602,
            "tokens": 5860,
            "sources": 1,
            "clones": 9,
            "duplicatedLines": 244,
            "duplicatedTokens": 2458,
            "percentage": 40.53,
            "percentageTokens": 41.95,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/strategies/mean-reversion-scalper.ts": {
            "lines": 635,
            "tokens": 6183,
            "sources": 1,
            "clones": 8,
            "duplicatedLines": 192,
            "duplicatedTokens": 1976,
            "percentage": 30.24,
            "percentageTokens": 31.96,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/strategies/index.ts": {
            "lines": 80,
            "tokens": 524,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/strategies/adaptive-risk-service.ts": {
            "lines": 345,
            "tokens": 2238,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/trading-session-manager.ts": {
            "lines": 564,
            "tokens": 4119,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/tradability-service.ts": {
            "lines": 189,
            "tokens": 1619,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/strategy-compiler.ts": {
            "lines": 527,
            "tokens": 4437,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/sentiment-aggregator.ts": {
            "lines": 825,
            "tokens": 5644,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/sector-exposure-service.ts": {
            "lines": 380,
            "tokens": 2660,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/position-reconciler.ts": {
            "lines": 374,
            "tokens": 2836,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/macro-indicators-service.ts": {
            "lines": 328,
            "tokens": 2714,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/llm-rate-limiter.ts": {
            "lines": 146,
            "tokens": 1259,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/enrichment-scheduler.ts": {
            "lines": 444,
            "tokens": 4042,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 36,
            "duplicatedTokens": 504,
            "percentage": 8.11,
            "percentageTokens": 12.47,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/dynamic-risk-manager.ts": {
            "lines": 554,
            "tokens": 4011,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/dynamic-exposure-controller.ts": {
            "lines": 811,
            "tokens": 6255,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/connector-metrics-service.ts": {
            "lines": 331,
            "tokens": 2973,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/connector-chain-service.ts": {
            "lines": 399,
            "tokens": 2952,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/services/advanced-rebalancing-service.ts": {
            "lines": 467,
            "tokens": 3623,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/webhooks.ts": {
            "lines": 190,
            "tokens": 1297,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 16,
            "duplicatedTokens": 158,
            "percentage": 8.42,
            "percentageTokens": 12.18,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/universe.ts": {
            "lines": 161,
            "tokens": 1605,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/uae-markets.ts": {
            "lines": 55,
            "tokens": 589,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/trading-sessions.ts": {
            "lines": 129,
            "tokens": 1003,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/trades.ts": {
            "lines": 175,
            "tokens": 1880,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/traces.ts": {
            "lines": 329,
            "tokens": 2864,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 42,
            "duplicatedTokens": 412,
            "percentage": 12.77,
            "percentageTokens": 14.39,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/tools.ts": {
            "lines": 94,
            "tokens": 942,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/strategies.ts": {
            "lines": 878,
            "tokens": 8016,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 15,
            "duplicatedTokens": 136,
            "percentage": 1.71,
            "percentageTokens": 1.7,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/stock.ts": {
            "lines": 97,
            "tokens": 1118,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/risk.ts": {
            "lines": 219,
            "tokens": 1982,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/providers.ts": {
            "lines": 430,
            "tokens": 4526,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/positions.ts": {
            "lines": 345,
            "tokens": 2878,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 79,
            "duplicatedTokens": 715,
            "percentage": 22.9,
            "percentageTokens": 24.84,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/portfolio-trading.ts": {
            "lines": 167,
            "tokens": 1519,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 75,
            "duplicatedTokens": 678,
            "percentage": 44.91,
            "percentageTokens": 44.63,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/portfolio-snapshot.ts": {
            "lines": 100,
            "tokens": 879,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 56,
            "duplicatedTokens": 564,
            "percentage": 56,
            "percentageTokens": 64.16,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/performance.ts": {
            "lines": 35,
            "tokens": 366,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/orders.ts": {
            "lines": 348,
            "tokens": 2831,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/notifications.ts": {
            "lines": 200,
            "tokens": 2198,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 16,
            "duplicatedTokens": 161,
            "percentage": 8,
            "percentageTokens": 7.32,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/news.ts": {
            "lines": 86,
            "tokens": 986,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/market-quotes.ts": {
            "lines": 50,
            "tokens": 535,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 45,
            "duplicatedTokens": 540,
            "percentage": 90,
            "percentageTokens": 100.93,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/market-data.ts": {
            "lines": 299,
            "tokens": 3243,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 28,
            "duplicatedTokens": 342,
            "percentage": 9.36,
            "percentageTokens": 10.55,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/macro.ts": {
            "lines": 141,
            "tokens": 1525,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/llm.ts": {
            "lines": 92,
            "tokens": 804,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/jina.ts": {
            "lines": 115,
            "tokens": 1300,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/health.ts": {
            "lines": 31,
            "tokens": 281,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/fusion.ts": {
            "lines": 52,
            "tokens": 427,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/feeds.ts": {
            "lines": 76,
            "tokens": 631,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/enrichment.ts": {
            "lines": 79,
            "tokens": 904,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/enforcement-fundamentals.ts": {
            "lines": 297,
            "tokens": 2174,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 30,
            "duplicatedTokens": 271,
            "percentage": 10.1,
            "percentageTokens": 12.47,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/debate.ts": {
            "lines": 64,
            "tokens": 666,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/crypto.ts": {
            "lines": 88,
            "tokens": 1015,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/connectors.ts": {
            "lines": 169,
            "tokens": 1401,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/competition.ts": {
            "lines": 216,
            "tokens": 2057,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/cmc.ts": {
            "lines": 63,
            "tokens": 702,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/cache.ts": {
            "lines": 135,
            "tokens": 1156,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/backtests.ts": {
            "lines": 185,
            "tokens": 1716,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/autonomous.ts": {
            "lines": 697,
            "tokens": 5616,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 114,
            "duplicatedTokens": 876,
            "percentage": 16.36,
            "percentageTokens": 15.6,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/auth.ts": {
            "lines": 163,
            "tokens": 1467,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/arena.ts": {
            "lines": 379,
            "tokens": 3729,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/analytics.ts": {
            "lines": 148,
            "tokens": 1497,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/alpaca.ts": {
            "lines": 474,
            "tokens": 4978,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 17,
            "duplicatedTokens": 198,
            "percentage": 3.59,
            "percentageTokens": 3.98,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/alpaca-trading.ts": {
            "lines": 139,
            "tokens": 1282,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/allocation-rebalance.ts": {
            "lines": 180,
            "tokens": 1760,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/ai-decisions.ts": {
            "lines": 833,
            "tokens": 6811,
            "sources": 1,
            "clones": 5,
            "duplicatedLines": 188,
            "duplicatedTokens": 1640,
            "percentage": 22.57,
            "percentageTokens": 24.08,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/ai-analysis.ts": {
            "lines": 224,
            "tokens": 2047,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 97,
            "duplicatedTokens": 915,
            "percentage": 43.3,
            "percentageTokens": 44.7,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/agent-control.ts": {
            "lines": 47,
            "tokens": 441,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes/activity.ts": {
            "lines": 245,
            "tokens": 2254,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/orchestration/logger.ts": {
            "lines": 256,
            "tokens": 2107,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/orchestration/index.ts": {
            "lines": 15,
            "tokens": 105,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/orchestration/events.ts": {
            "lines": 236,
            "tokens": 1826,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/orchestration/coordinator.ts": {
            "lines": 291,
            "tokens": 2454,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/observability/routes.ts": {
            "lines": 583,
            "tokens": 5211,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 42,
            "duplicatedTokens": 412,
            "percentage": 7.2,
            "percentageTokens": 7.91,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/observability/otel.ts": {
            "lines": 172,
            "tokens": 1311,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/observability/alertService.ts": {
            "lines": 430,
            "tokens": 3545,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/middleware/request-logger.ts": {
            "lines": 92,
            "tokens": 736,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/middleware/error-handler.ts": {
            "lines": 89,
            "tokens": 671,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/middleware/audit-logger.ts": {
            "lines": 310,
            "tokens": 2405,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/webhook-emitter.ts": {
            "lines": 222,
            "tokens": 1837,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/valyuBudget.ts": {
            "lines": 313,
            "tokens": 2447,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/tool-security.ts": {
            "lines": 298,
            "tokens": 2509,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/temporal-context.ts": {
            "lines": 255,
            "tokens": 1983,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/technical-indicators.ts": {
            "lines": 315,
            "tokens": 3597,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 33,
            "duplicatedTokens": 386,
            "percentage": 10.48,
            "percentageTokens": 10.73,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/standard-errors.ts": {
            "lines": 202,
            "tokens": 1279,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/sse-emitter.ts": {
            "lines": 334,
            "tokens": 2621,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/session.ts": {
            "lines": 99,
            "tokens": 683,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/sanitization.ts": {
            "lines": 155,
            "tokens": 1084,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/rateLimiter.ts": {
            "lines": 235,
            "tokens": 2203,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/providerFallback.ts": {
            "lines": 245,
            "tokens": 2023,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/persistentApiCache.ts": {
            "lines": 337,
            "tokens": 2572,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/performance-metrics.ts": {
            "lines": 151,
            "tokens": 1347,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/order-execution-cache.ts": {
            "lines": 178,
            "tokens": 1450,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/notification-service.ts": {
            "lines": 335,
            "tokens": 2693,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/fetchWithBudgetAndCache.ts": {
            "lines": 260,
            "tokens": 2092,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/connectorClient.ts": {
            "lines": 131,
            "tokens": 1038,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/circuitBreaker.ts": {
            "lines": 156,
            "tokens": 1365,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/callExternal.ts": {
            "lines": 325,
            "tokens": 2366,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 54,
            "duplicatedTokens": 310,
            "percentage": 16.62,
            "percentageTokens": 13.1,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/apiPolicy.ts": {
            "lines": 408,
            "tokens": 3806,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/apiBudget.ts": {
            "lines": 320,
            "tokens": 2703,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/lib/api-cache.ts": {
            "lines": 248,
            "tokens": 2260,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/jobs/position-reconciliation.ts": {
            "lines": 282,
            "tokens": 1953,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/fusion/data-fusion-engine.ts": {
            "lines": 515,
            "tokens": 4731,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/connectors/valyu.ts": {
            "lines": 889,
            "tokens": 7128,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/connectors/uae-markets.ts": {
            "lines": 550,
            "tokens": 4021,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/connectors/sec-edgar.ts": {
            "lines": 849,
            "tokens": 7156,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/connectors/newsapi.ts": {
            "lines": 281,
            "tokens": 2297,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/connectors/jina.ts": {
            "lines": 308,
            "tokens": 2516,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/connectors/huggingface.ts": {
            "lines": 305,
            "tokens": 2496,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/connectors/gdelt.ts": {
            "lines": 589,
            "tokens": 4978,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/connectors/futures-broker-interface.ts": {
            "lines": 804,
            "tokens": 4433,
            "sources": 1,
            "clones": 4,
            "duplicatedLines": 406,
            "duplicatedTokens": 2832,
            "percentage": 50.5,
            "percentageTokens": 63.88,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/connectors/fred.ts": {
            "lines": 372,
            "tokens": 2913,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/connectors/frankfurter.ts": {
            "lines": 519,
            "tokens": 4700,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 30,
            "duplicatedTokens": 298,
            "percentage": 5.78,
            "percentageTokens": 6.34,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/connectors/finra.ts": {
            "lines": 361,
            "tokens": 3143,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/connectors/finnhub.ts": {
            "lines": 468,
            "tokens": 4048,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/connectors/coinmarketcap.ts": {
            "lines": 449,
            "tokens": 3707,
            "sources": 1,
            "clones": 2,
            "duplicatedLines": 36,
            "duplicatedTokens": 326,
            "percentage": 8.02,
            "percentageTokens": 8.79,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/connectors/coingecko.ts": {
            "lines": 441,
            "tokens": 3785,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/config/trading-config.ts": {
            "lines": 420,
            "tokens": 1758,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/config/index.ts": {
            "lines": 126,
            "tokens": 790,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/config/env-validator.ts": {
            "lines": 220,
            "tokens": 1505,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/config/env-helpers.ts": {
            "lines": 92,
            "tokens": 648,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/cache/unified-cache.ts": {
            "lines": 504,
            "tokens": 3645,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/cache/cache-config.ts": {
            "lines": 92,
            "tokens": 547,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/autonomous/watchlist-cache.ts": {
            "lines": 170,
            "tokens": 551,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 21,
            "duplicatedTokens": 163,
            "percentage": 12.35,
            "percentageTokens": 29.58,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/autonomous/universe-builder.ts": {
            "lines": 279,
            "tokens": 1336,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/autonomous/types.ts": {
            "lines": 343,
            "tokens": 912,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/autonomous/rebalancing-manager.ts": {
            "lines": 610,
            "tokens": 3557,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/autonomous/profit-cycling-engine.ts": {
            "lines": 752,
            "tokens": 5449,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/autonomous/pre-trade-guard.ts": {
            "lines": 258,
            "tokens": 1382,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/autonomous/position-sync.ts": {
            "lines": 143,
            "tokens": 984,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/autonomous/order-queue.ts": {
            "lines": 465,
            "tokens": 2611,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/autonomous/orchestrator.ts": {
            "lines": 795,
            "tokens": 5911,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/autonomous/market-data-fetcher.ts": {
            "lines": 350,
            "tokens": 2132,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/autonomous/lifecycle-manager.ts": {
            "lines": 592,
            "tokens": 2029,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/autonomous/crypto-utils.ts": {
            "lines": 237,
            "tokens": 810,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 21,
            "duplicatedTokens": 163,
            "percentage": 8.86,
            "percentageTokens": 20.12,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/tools.ts": {
            "lines": 452,
            "tokens": 3087,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/toolRouter.ts": {
            "lines": 327,
            "tokens": 2818,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/togetherClient.ts": {
            "lines": 31,
            "tokens": 123,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/roleBasedRouter.ts": {
            "lines": 599,
            "tokens": 4657,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/openrouterClient.ts": {
            "lines": 30,
            "tokens": 155,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/openrouter-provider.ts": {
            "lines": 221,
            "tokens": 1863,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/openaiCompatibleClient.ts": {
            "lines": 208,
            "tokens": 1646,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/openaiClient.ts": {
            "lines": 34,
            "tokens": 174,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/news-enhanced-decision-engine.ts": {
            "lines": 825,
            "tokens": 6537,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/market-condition-analyzer.ts": {
            "lines": 476,
            "tokens": 4128,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/llmClient.ts": {
            "lines": 129,
            "tokens": 802,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/learning-service.ts": {
            "lines": 334,
            "tokens": 2993,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/index.ts": {
            "lines": 125,
            "tokens": 1216,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/huggingfaceClient.ts": {
            "lines": 361,
            "tokens": 2602,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/groqClient.ts": {
            "lines": 31,
            "tokens": 123,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/geminiClient.ts": {
            "lines": 293,
            "tokens": 2006,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 16,
            "duplicatedTokens": 132,
            "percentage": 5.46,
            "percentageTokens": 6.58,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/enhanced-decision-log.ts": {
            "lines": 506,
            "tokens": 3963,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/docAssistantCore.ts": {
            "lines": 145,
            "tokens": 837,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/debateArena.ts": {
            "lines": 474,
            "tokens": 3787,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/cloudflareClient.ts": {
            "lines": 270,
            "tokens": 1869,
            "sources": 1,
            "clones": 1,
            "duplicatedLines": 16,
            "duplicatedTokens": 132,
            "percentage": 5.93,
            "percentageTokens": 7.06,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/claudeClient.ts": {
            "lines": 292,
            "tokens": 2184,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/baseLLMClient.ts": {
            "lines": 98,
            "tokens": 752,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/aimlClient.ts": {
            "lines": 31,
            "tokens": 123,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/ai/ai-strategy-validator.ts": {
            "lines": 195,
            "tokens": 1234,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/admin/settings.ts": {
            "lines": 180,
            "tokens": 1535,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/admin/registry.ts": {
            "lines": 327,
            "tokens": 2070,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/admin/rbac.ts": {
            "lines": 111,
            "tokens": 804,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/admin/global-search.ts": {
            "lines": 225,
            "tokens": 1973,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/adapters/broker-adapter.interface.ts": {
            "lines": 403,
            "tokens": 1218,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/adapters/alpaca-rest-adapter.ts": {
            "lines": 442,
            "tokens": 3155,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/routes.ts": {
            "lines": 538,
            "tokens": 4543,
            "sources": 1,
            "clones": 3,
            "duplicatedLines": 62,
            "duplicatedTokens": 590,
            "percentage": 11.52,
            "percentageTokens": 12.99,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/index.ts": {
            "lines": 345,
            "tokens": 2917,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          },
          "./server/db.ts": {
            "lines": 42,
            "tokens": 320,
            "sources": 1,
            "clones": 0,
            "duplicatedLines": 0,
            "duplicatedTokens": 0,
            "percentage": 0,
            "percentageTokens": 0,
            "newDuplicatedLines": 0,
            "newClones": 0
          }
        },
        "total": {
          "lines": 90949,
          "tokens": 771995,
          "sources": 283,
          "clones": 89,
          "duplicatedLines": 3114,
          "duplicatedTokens": 34680,
          "percentage": 3.42,
          "percentageTokens": 4.49,
          "newDuplicatedLines": 0,
          "newClones": 0
        }
      }
    },
    "total": {
      "lines": 90949,
      "tokens": 771995,
      "sources": 283,
      "clones": 89,
      "duplicatedLines": 3114,
      "duplicatedTokens": 34680,
      "percentage": 3.42,
      "percentageTokens": 4.49,
      "newDuplicatedLines": 0,
      "newClones": 0
    }
  },
  "duplicates": [
    {
      "format": "typescript",
      "lines": 20,
      "fragment": "import { finra } from \"../server/connectors/finra\";\nimport { secEdgarConnector } from \"../server/connectors/sec-edgar\";\nimport { fred } from \"../server/connectors/fred\";\nimport { frankfurter } from \"../server/connectors/frankfurter\";\n\ninterface TestResult {\n  toolName: string;\n  testCase: string;\n  success: boolean;\n  data?: any;\n  error?: string;\n  executionTime?: number;\n}\n\nconst results: TestResult[] = [];\n\nfunction logResult(result: TestResult) {\n  results.push(result);\n  const status = result.success ? \" PASS\" : \" FAIL\";\n  console.log(`\\n${status} - ${result.toolName} (${result.testCase}) [",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/test-ai-tools-detailed.ts",
        "start": 8,
        "end": 27,
        "startLoc": {
          "line": 8,
          "column": 1,
          "position": 15
        },
        "endLoc": {
          "line": 27,
          "column": 4,
          "position": 200
        }
      },
      "secondFile": {
        "name": "scripts/test-ai-tools.ts",
        "start": 8,
        "end": 27,
        "startLoc": {
          "line": 8,
          "column": 1,
          "position": 15
        },
        "endLoc": {
          "line": 27,
          "column": 3,
          "position": 200
        }
      }
    },
    {
      "format": "typescript",
      "lines": 54,
      "fragment": ",\n  maxDailyLoss: 0.05,\n  technicalWeight: 0.20,\n  momentumWeight: 0.20,\n  volatilityWeight: 0.08,\n  volumeWeight: 0.12,\n  sentimentWeight: 0.12,\n  patternWeight: 0.10,\n  breadthWeight: 0.08,\n  correlationWeight: 0.10,\n  rsiPeriod: 14,\n  rsiOversold: 30,\n  rsiOverbought: 70,\n  macdFast: 12,\n  macdSlow: 26,\n  macdSignal: 9,\n  bbPeriod: 20,\n  bbStdDev: 2.0,\n  atrPeriod: 14,\n  momentumLookback: 10,\n  volatilityLookback: 20,\n  correlationLookback: 30,\n};\n\ninterface AlpacaBar {\n  t: string;\n  o: number;\n  h: number;\n  l: number;\n  c: number;\n  v: number;\n}\n\ninterface ThresholdConfig {\n  buyThreshold: number;\n  confidenceMin: number;\n  atrMultStop: number;\n  atrMultTarget: number;\n}\n\ninterface BacktestResult {\n  config: ThresholdConfig;\n  totalReturn: number;\n  sharpe: number;\n  sortino: number;\n  calmar: number;\n  maxDrawdown: number;\n  winRate: number;\n  trades: TradeResult[];\n  riskRewardRatio: number;\n  avgWin: number;\n  avgLoss: number;\n  profitFactor: number;\n  stopsHit",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-threshold-optimizer-fast.ts",
        "start": 50,
        "end": 103,
        "startLoc": {
          "line": 50,
          "column": 3,
          "position": 324
        },
        "endLoc": {
          "line": 103,
          "column": 9,
          "position": 658
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 50,
        "end": 103,
        "startLoc": {
          "line": 50,
          "column": 3,
          "position": 348
        },
        "endLoc": {
          "line": 103,
          "column": 2,
          "position": 681
        }
      }
    },
    {
      "format": "typescript",
      "lines": 245,
      "fragment": ": number;\n}\n\ninterface TradeResult {\n  symbol: string;\n  entry: number;\n  exit: number;\n  pnl: number;\n  pnlPct: number;\n  holdingDays: number;\n  entryDate: string;\n  exitDate: string;\n  confidence: number;\n  hitStop: boolean;\n  hitTarget: boolean;\n}\n\n// ============= ALPACA DATA FETCHER =============\n\nasync function fetchAlpacaBars(symbol: string, start: string, end: string): Promise<AlpacaBar[]> {\n  const allBars: AlpacaBar[] = [];\n  let pageToken: string | null = null;\n\n  do {\n    let url = `${ALPACA_DATA_URL}/v2/stocks/${symbol}/bars?timeframe=1Day&start=${start}&end=${end}&limit=10000&feed=iex`;\n    if (pageToken) url += `&page_token=${pageToken}`;\n\n    const response = await fetch(url, {\n      headers: {\n        'APCA-API-KEY-ID': ALPACA_KEY,\n        'APCA-API-SECRET-KEY': ALPACA_SECRET,\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n\n    const data = await response.json();\n    if (data.bars && Array.isArray(data.bars)) {\n      allBars.push(...data.bars);\n    }\n    pageToken = data.next_page_token || null;\n  } while (pageToken);\n\n  return allBars;\n}\n\n// ============= TECHNICAL INDICATORS =============\n\nfunction calculateSMA(data: number[], period: number): number[] {\n  const result: number[] = [];\n  for (let i = 0; i < data.length; i++) {\n    if (i < period - 1) result.push(NaN);\n    else {\n      const sum = data.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0);\n      result.push(sum / period);\n    }\n  }\n  return result;\n}\n\nfunction calculateEMA(data: number[], period: number): number[] {\n  const result: number[] = [];\n  const multiplier = 2 / (period + 1);\n  for (let i = 0; i < data.length; i++) {\n    if (i === 0) result.push(data[0]);\n    else result.push((data[i] - result[i - 1]) * multiplier + result[i - 1]);\n  }\n  return result;\n}\n\nfunction calculateRSI(closes: number[], period: number): number[] {\n  const changes: number[] = [];\n  for (let i = 1; i < closes.length; i++) changes.push(closes[i] - closes[i - 1]);\n  const gains = changes.map(c => c > 0 ? c : 0);\n  const losses = changes.map(c => c < 0 ? -c : 0);\n  const avgGain = calculateEMA(gains, period);\n  const avgLoss = calculateEMA(losses, period);\n\n  const rsi: number[] = [NaN];\n  for (let i = 0; i < avgGain.length; i++) {\n    if (avgLoss[i] === 0) rsi.push(100);\n    else rsi.push(100 - (100 / (1 + avgGain[i] / avgLoss[i])));\n  }\n  return rsi;\n}\n\nfunction calculateMACD(closes: number[], fast: number, slow: number, signal: number): { macd: number[], signal: number[], histogram: number[] } {\n  const emaFast = calculateEMA(closes, fast);\n  const emaSlow = calculateEMA(closes, slow);\n  const macdLine = emaFast.map((v, i) => v - emaSlow[i]);\n  const signalLine = calculateEMA(macdLine, signal);\n  const histogram = macdLine.map((v, i) => v - signalLine[i]);\n  return { macd: macdLine, signal: signalLine, histogram };\n}\n\nfunction calculateBollingerBands(closes: number[], period: number, stdDev: number): { upper: number[], middle: number[], lower: number[] } {\n  const middle = calculateSMA(closes, period);\n  const upper: number[] = [];\n  const lower: number[] = [];\n\n  for (let i = 0; i < closes.length; i++) {\n    if (i < period - 1) { upper.push(NaN); lower.push(NaN); }\n    else {\n      const slice = closes.slice(i - period + 1, i + 1);\n      const mean = middle[i];\n      const variance = slice.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / period;\n      const std = Math.sqrt(variance);\n      upper.push(mean + stdDev * std);\n      lower.push(mean - stdDev * std);\n    }\n  }\n  return { upper, middle, lower };\n}\n\nfunction calculateATR(highs: number[], lows: number[], closes: number[], period: number): number[] {\n  const tr: number[] = [highs[0] - lows[0]];\n  for (let i = 1; i < closes.length; i++) {\n    const hl = highs[i] - lows[i];\n    const hc = Math.abs(highs[i] - closes[i - 1]);\n    const lc = Math.abs(lows[i] - closes[i - 1]);\n    tr.push(Math.max(hl, hc, lc));\n  }\n  return calculateEMA(tr, period);\n}\n\nfunction calculateOBV(closes: number[], volumes: number[]): number[] {\n  const obv: number[] = [0];\n  for (let i = 1; i < closes.length; i++) {\n    if (closes[i] > closes[i - 1]) obv.push(obv[i - 1] + volumes[i]);\n    else if (closes[i] < closes[i - 1]) obv.push(obv[i - 1] - volumes[i]);\n    else obv.push(obv[i - 1]);\n  }\n  return obv;\n}\n\n// ============= SIGNAL GENERATION =============\n\nfunction generateSignal(bars: AlpacaBar[], params: typeof FIXED_PARAMS): { score: number, confidence: number } {\n  if (bars.length < 50) return { score: 0, confidence: 0 };\n\n  const closes = bars.map(b => b.c);\n  const highs = bars.map(b => b.h);\n  const lows = bars.map(b => b.l);\n  const volumes = bars.map(b => b.v);\n\n  const factors: Record<string, number> = {};\n\n  // Technical\n  const rsi = calculateRSI(closes, params.rsiPeriod);\n  const currentRSI = rsi[rsi.length - 1];\n  const macd = calculateMACD(closes, params.macdFast, params.macdSlow, params.macdSignal);\n  const bb = calculateBollingerBands(closes, params.bbPeriod, params.bbStdDev);\n\n  let technicalScore = 0;\n  if (currentRSI < params.rsiOversold) technicalScore += 0.3;\n  else if (currentRSI > params.rsiOverbought) technicalScore -= 0.3;\n  else technicalScore += (50 - currentRSI) / 100;\n\n  const macdCurrent = macd.histogram[macd.histogram.length - 1];\n  const macdPrev = macd.histogram[macd.histogram.length - 2];\n  if (macdCurrent > 0 && macdCurrent > macdPrev) technicalScore += 0.25;\n  else if (macdCurrent < 0 && macdCurrent < macdPrev) technicalScore -= 0.25;\n\n  const currentClose = closes[closes.length - 1];\n  const bbLower = bb.lower[bb.lower.length - 1];\n  const bbUpper = bb.upper[bb.upper.length - 1];\n  if (currentClose < bbLower) technicalScore += 0.2;\n  else if (currentClose > bbUpper) technicalScore -= 0.2;\n\n  factors.technical = Math.max(-1, Math.min(1, technicalScore));\n\n  // Momentum\n  const returns: number[] = [];\n  for (let i = 1; i < closes.length; i++) returns.push((closes[i] - closes[i - 1]) / closes[i - 1]);\n  const recentReturns = returns.slice(-params.momentumLookback);\n  const avgReturn = recentReturns.reduce((a, b) => a + b, 0) / recentReturns.length;\n  const momentum5 = (closes[closes.length - 1] - closes[closes.length - 6]) / closes[closes.length - 6];\n  const momentum20 = closes.length >= 21 ? (closes[closes.length - 1] - closes[closes.length - 21]) / closes[closes.length - 21] : 0;\n  factors.momentum = Math.max(-1, Math.min(1, (avgReturn * 50 + momentum5 * 5 + momentum20 * 2) / 3));\n\n  // Volatility\n  const recentVolReturns = returns.slice(-params.volatilityLookback);\n  const volatility = Math.sqrt(recentVolReturns.reduce((sum, r) => sum + r * r, 0) / recentVolReturns.length) * Math.sqrt(252);\n  factors.volatility = Math.max(-1, Math.min(1, 0.5 - volatility));\n\n  // Volume\n  const avgVolume = volumes.slice(-20).reduce((a, b) => a + b, 0) / 20;\n  const currentVolume = volumes[volumes.length - 1];\n  const volumeRatio = currentVolume / avgVolume;\n  const obv = calculateOBV(closes, volumes);\n  const obvTrend = obv[obv.length - 1] - obv[obv.length - 6];\n  factors.volume = Math.max(-1, Math.min(1, (volumeRatio - 1) * 0.5 + (obvTrend > 0 ? 0.2 : -0.2)));\n\n  // Sentiment proxy\n  const trendUp = momentum20 > 0.05;\n  const trendDown = momentum20 < -0.05;\n  factors.sentiment = Math.max(-1, Math.min(1, (trendUp ? 0.3 : trendDown ? -0.3 : 0) + (volumeRatio > 1.5 && momentum5 > 0 ? 0.2 : volumeRatio > 1.5 && momentum5 < 0 ? -0.2 : 0)));\n\n  // Pattern (simplified)\n  factors.pattern = momentum5 > 0.02 ? 0.3 : momentum5 < -0.02 ? -0.3 : 0;\n\n  // Breadth\n  const sma10 = calculateSMA(closes, 10);\n  const sma20 = calculateSMA(closes, 20);\n  const sma50 = closes.length >= 50 ? calculateSMA(closes, 50) : sma20;\n  const current = closes[closes.length - 1];\n  factors.breadth = (current > sma10[sma10.length - 1] ? 0.33 : -0.33) + (current > sma20[sma20.length - 1] ? 0.33 : -0.33) + (current > sma50[sma50.length - 1] ? 0.34 : -0.34);\n\n  // Correlation\n  const bbMiddle = bb.middle[bb.middle.length - 1];\n  const deviation = (current - bbMiddle) / (bbUpper - bbMiddle || 1);\n  factors.correlation = Math.max(-1, Math.min(1, -deviation * 0.5));\n\n  // Weighted score\n  const score = factors.technical * params.technicalWeight +\n    factors.momentum * params.momentumWeight +\n    factors.volatility * params.volatilityWeight +\n    factors.volume * params.volumeWeight +\n    factors.sentiment * params.sentimentWeight +\n    factors.pattern * params.patternWeight +\n    factors.breadth * params.breadthWeight +\n    factors.correlation * params.correlationWeight;\n\n  const factorValues = Object.values(factors);\n  const positiveFactors = factorValues.filter(f => f > 0).length;\n  const negativeFactors = factorValues.filter(f => f < 0).length;\n  const agreement = Math.max(positiveFactors, negativeFactors) / factorValues.length;\n  const confidence = agreement * Math.abs(score);\n\n  return { score, confidence };\n}\n\n// ============= BACKTEST ENGINE =============\n\nasync function runBacktest(config: ThresholdConfig, bars: Map<string, AlpacaBar[]>, startDate: Date, endDate: Date): Promise<BacktestResult> {\n  const initialCapital = 100000;\n  let capital = initialCapital;\n  const trades: TradeResult[] = [];\n  const equity: number[] = [capital];\n  const dailyReturns: number[] = [];\n  const positions: Map<string, { entry: number, shares: number, entryDate: string, stopLoss: number, takeProfit: number, confidence: number }> = new Map();\n\n  let",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-threshold-optimizer-fast.ts",
        "start": 104,
        "end": 348,
        "startLoc": {
          "line": 104,
          "column": 11,
          "position": 666
        },
        "endLoc": {
          "line": 348,
          "column": 4,
          "position": 4636
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 102,
        "end": 346,
        "startLoc": {
          "line": 102,
          "column": 13,
          "position": 676
        },
        "endLoc": {
          "line": 346,
          "column": 20,
          "position": 4646
        }
      }
    },
    {
      "format": "typescript",
      "lines": 32,
      "fragment": ";\n\n  // Get trading days\n  const tradingDays: string[] = [];\n  const firstBars = bars.values().next().value;\n  if (firstBars) {\n    for (const bar of firstBars) {\n      const date = new Date(bar.t);\n      if (date >= startDate && date <= endDate) tradingDays.push(bar.t);\n    }\n  }\n\n  for (let dayIdx = 50; dayIdx < tradingDays.length; dayIdx++) {\n    const currentDate = tradingDays[dayIdx];\n\n    // Check exits\n    for (const [symbol, pos] of positions) {\n      const symbolBars = bars.get(symbol);\n      if (!symbolBars) continue;\n      const currentBar = symbolBars.find(b => b.t === currentDate);\n      if (!currentBar) continue;\n\n      const high = currentBar.h;\n      const low = currentBar.l;\n      let exitPrice: number | null = null;\n      let hitStop = false;\n      let hitTarget = false;\n\n      if (low <= pos.stopLoss) {\n        exitPrice = pos.stopLoss;\n        hitStop = true;\n        stopsHit",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-threshold-optimizer-fast.ts",
        "start": 349,
        "end": 380,
        "startLoc": {
          "line": 349,
          "column": 2,
          "position": 4653
        },
        "endLoc": {
          "line": 380,
          "column": 9,
          "position": 4996
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 344,
        "end": 375,
        "startLoc": {
          "line": 344,
          "column": 2,
          "position": 4642
        },
        "endLoc": {
          "line": 375,
          "column": 2,
          "position": 4985
        }
      }
    },
    {
      "format": "typescript",
      "lines": 142,
      "fragment": ";\n      }\n\n      if (exitPrice) {\n        const pnl = (exitPrice - pos.entry) * pos.shares;\n        const pnlPct = (exitPrice - pos.entry) / pos.entry;\n        capital += pos.shares * exitPrice;\n        trades.push({\n          symbol,\n          entry: pos.entry,\n          exit: exitPrice,\n          pnl,\n          pnlPct,\n          holdingDays: dayIdx - tradingDays.indexOf(pos.entryDate),\n          entryDate: pos.entryDate,\n          exitDate: currentDate,\n          confidence: pos.confidence,\n          hitStop,\n          hitTarget,\n        });\n        positions.delete(symbol);\n      }\n    }\n\n    // Check entries\n    if (positions.size < FIXED_PARAMS.maxPositions) {\n      const candidates: { symbol: string, score: number, confidence: number, price: number, atr: number }[] = [];\n\n      for (const [symbol, symbolBars] of bars) {\n        if (positions.has(symbol)) continue;\n        const barsToDate = symbolBars.filter(b => b.t <= currentDate).slice(-60);\n        if (barsToDate.length < 50) continue;\n\n        const signal = generateSignal(barsToDate, FIXED_PARAMS);\n        if (signal.score >= config.buyThreshold && signal.confidence >= config.confidenceMin) {\n          const currentBar = barsToDate[barsToDate.length - 1];\n          const closes = barsToDate.map(b => b.c);\n          const highs = barsToDate.map(b => b.h);\n          const lows = barsToDate.map(b => b.l);\n          const atr = calculateATR(highs, lows, closes, FIXED_PARAMS.atrPeriod);\n          candidates.push({ symbol, score: signal.score, confidence: signal.confidence, price: currentBar.c, atr: atr[atr.length - 1] });\n        }\n      }\n\n      candidates.sort((a, b) => b.score - a.score);\n\n      for (const candidate of candidates.slice(0, FIXED_PARAMS.maxPositions - positions.size)) {\n        const maxPositionSize = capital * FIXED_PARAMS.maxPositionPct;\n        const shares = Math.floor(maxPositionSize / candidate.price);\n\n        if (shares > 0 && shares * candidate.price <= capital) {\n          const stopLoss = candidate.price - candidate.atr * config.atrMultStop;\n          const takeProfit = candidate.price + candidate.atr * config.atrMultTarget;\n          positions.set(candidate.symbol, {\n            entry: candidate.price,\n            shares,\n            entryDate: currentDate,\n            stopLoss,\n            takeProfit,\n            confidence: candidate.confidence,\n          });\n          capital -= shares * candidate.price;\n        }\n      }\n    }\n\n    // Update equity\n    let currentEquity = capital;\n    for (const [symbol, pos] of positions) {\n      const symbolBars = bars.get(symbol);\n      if (symbolBars) {\n        const currentBar = symbolBars.find(b => b.t === currentDate);\n        if (currentBar) currentEquity += pos.shares * currentBar.c;\n      }\n    }\n    equity.push(currentEquity);\n    if (equity.length > 1) dailyReturns.push((currentEquity - equity[equity.length - 2]) / equity[equity.length - 2]);\n  }\n\n  // Close remaining positions\n  for (const [symbol, pos] of positions) {\n    const symbolBars = bars.get(symbol);\n    if (symbolBars && symbolBars.length > 0) {\n      const lastBar = symbolBars[symbolBars.length - 1];\n      const exitPrice = lastBar.c;\n      trades.push({\n        symbol,\n        entry: pos.entry,\n        exit: exitPrice,\n        pnl: (exitPrice - pos.entry) * pos.shares,\n        pnlPct: (exitPrice - pos.entry) / pos.entry,\n        holdingDays: tradingDays.length - tradingDays.indexOf(pos.entryDate),\n        entryDate: pos.entryDate,\n        exitDate: tradingDays[tradingDays.length - 1],\n        confidence: pos.confidence,\n        hitStop: false,\n        hitTarget: false,\n      });\n    }\n  }\n\n  // Calculate metrics\n  const totalReturn = (equity[equity.length - 1] - initialCapital) / initialCapital;\n  const maxDrawdown = equity.reduce((maxDD, val, i) => {\n    const peak = Math.max(...equity.slice(0, i + 1));\n    return Math.max(maxDD, (peak - val) / peak);\n  }, 0);\n\n  const avgReturn = dailyReturns.reduce((a, b) => a + b, 0) / (dailyReturns.length || 1);\n  const stdReturn = Math.sqrt(dailyReturns.reduce((sum, r) => sum + Math.pow(r - avgReturn, 2), 0) / (dailyReturns.length || 1));\n  const sharpe = stdReturn > 0 ? (avgReturn * 252) / (stdReturn * Math.sqrt(252)) : 0;\n  const negativeReturns = dailyReturns.filter(r => r < 0);\n  const downstdReturn = Math.sqrt(negativeReturns.reduce((sum, r) => sum + r * r, 0) / (negativeReturns.length || 1));\n  const sortino = downstdReturn > 0 ? (avgReturn * 252) / (downstdReturn * Math.sqrt(252)) : 0;\n  const years = tradingDays.length / 252;\n  const cagr = Math.pow(1 + totalReturn, 1 / years) - 1;\n  const calmar = maxDrawdown > 0 ? cagr / maxDrawdown : 0;\n  const winRate = trades.length > 0 ? trades.filter(t => t.pnl > 0).length / trades.length : 0;\n\n  // Calculate win/loss metrics\n  const wins = trades.filter(t => t.pnl > 0);\n  const losses = trades.filter(t => t.pnl < 0);\n  const avgWin = wins.length > 0 ? wins.reduce((sum, t) => sum + t.pnl, 0) / wins.length : 0;\n  const avgLoss = losses.length > 0 ? Math.abs(losses.reduce((sum, t) => sum + t.pnl, 0) / losses.length) : 0;\n  const totalWins = wins.reduce((sum, t) => sum + t.pnl, 0);\n  const totalLosses = Math.abs(losses.reduce((sum, t) => sum + t.pnl, 0));\n  const profitFactor = totalLosses > 0 ? totalWins / totalLosses : totalWins > 0 ? Infinity : 0;\n\n  return {\n    config,\n    totalReturn,\n    sharpe,\n    sortino,\n    calmar,\n    maxDrawdown,\n    winRate,\n    trades,\n    riskRewardRatio: config.atrMultTarget / config.atrMultStop,\n    avgWin,\n    avgLoss,\n    profitFactor,\n    stopsHit",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-threshold-optimizer-fast.ts",
        "start": 384,
        "end": 525,
        "startLoc": {
          "line": 384,
          "column": 3,
          "position": 5040
        },
        "endLoc": {
          "line": 525,
          "column": 9,
          "position": 7084
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 377,
        "end": 518,
        "startLoc": {
          "line": 377,
          "column": 5,
          "position": 5019
        },
        "endLoc": {
          "line": 518,
          "column": 2,
          "position": 7063
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": "const start = startDate.toISOString().split('T')[0];\n  const end = endDate.toISOString().split('T')[0];\n\n  console.log(`\\nLoading historical data for ${SYMBOLS.length} symbols...`);\n  console.log(`Period: ${start} to ${end}`);\n\n  let loaded = 0;\n  for (const symbol of SYMBOLS) {\n    try {\n      const symbolBars = await fetchAlpacaBars(symbol, start, end);\n      if (symbolBars.length > 100) {\n        bars.set(symbol, symbolBars);\n        loaded++;\n      }\n      await new Promise(r => setTimeout(r, 100));\n    }",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-threshold-optimizer-fast.ts",
        "start": 538,
        "end": 553,
        "startLoc": {
          "line": 538,
          "column": 3,
          "position": 7193
        },
        "endLoc": {
          "line": 553,
          "column": 2,
          "position": 7378
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 529,
        "end": 543,
        "startLoc": {
          "line": 529,
          "column": 3,
          "position": 7166
        },
        "endLoc": {
          "line": 543,
          "column": 14,
          "position": 7350
        }
      }
    },
    {
      "format": "typescript",
      "lines": 54,
      "fragment": ");\n  console.log(''.repeat(80));\n\n  // Calculate total iterations\n  const buyThresholdSteps = Math.round((BUY_THRESHOLD_MAX - BUY_THRESHOLD_MIN) / BUY_THRESHOLD_STEP) + 1;\n  const confidenceSteps = Math.round((CONFIDENCE_MAX - CONFIDENCE_MIN) / CONFIDENCE_STEP) + 1;\n  const atrStopSteps = Math.round((ATR_STOP_MAX - ATR_STOP_MIN) / ATR_STOP_STEP) + 1;\n  const atrTargetSteps = Math.round((ATR_TARGET_MAX - ATR_TARGET_MIN) / ATR_TARGET_STEP) + 1;\n  const totalIterations = buyThresholdSteps * confidenceSteps * atrStopSteps * atrTargetSteps;\n\n  console.log(`\\n  Configuration:`);\n  console.log(`  - Buy Threshold: ${BUY_THRESHOLD_MIN} to ${BUY_THRESHOLD_MAX} (step ${BUY_THRESHOLD_STEP}) = ${buyThresholdSteps} values`);\n  console.log(`  - Confidence Min: ${CONFIDENCE_MIN} to ${CONFIDENCE_MAX} (step ${CONFIDENCE_STEP}) = ${confidenceSteps} values`);\n  console.log(`  - ATR Stop: ${ATR_STOP_MIN} to ${ATR_STOP_MAX} (step ${ATR_STOP_STEP}) = ${atrStopSteps} values`);\n  console.log(`  - ATR Target: ${ATR_TARGET_MIN} to ${ATR_TARGET_MAX} (step ${ATR_TARGET_STEP}) = ${atrTargetSteps} values`);\n  console.log(`  - Total Iterations: ${totalIterations.toLocaleString()}`);\n\n  const bars = await loadHistoricalData();\n  if (bars.size < 10) {\n    console.error('Insufficient data. Aborting.');\n    return;\n  }\n\n  const startDate = new Date();\n  startDate.setFullYear(startDate.getFullYear() - 2);\n  const endDate = new Date();\n\n  const results: BacktestResult[] = [];\n  let iteration = 0;\n  const startTime = Date.now();\n\n  console.log('\\n' + ''.repeat(80));\n  console.log('  STARTING THRESHOLD OPTIMIZATION');\n  console.log(''.repeat(80));\n\n  // Generate all threshold combinations\n  for (let buyThreshold = BUY_THRESHOLD_MIN; buyThreshold <= BUY_THRESHOLD_MAX; buyThreshold += BUY_THRESHOLD_STEP) {\n    for (let confidenceMin = CONFIDENCE_MIN; confidenceMin <= CONFIDENCE_MAX; confidenceMin += CONFIDENCE_STEP) {\n      for (let atrMultStop = ATR_STOP_MIN; atrMultStop <= ATR_STOP_MAX; atrMultStop += ATR_STOP_STEP) {\n        for (let atrMultTarget = ATR_TARGET_MIN; atrMultTarget <= ATR_TARGET_MAX; atrMultTarget += ATR_TARGET_STEP) {\n          iteration++;\n\n          const config: ThresholdConfig = {\n            buyThreshold: Math.round(buyThreshold * 100) / 100,\n            confidenceMin: Math.round(confidenceMin * 100) / 100,\n            atrMultStop: Math.round(atrMultStop * 100) / 100,\n            atrMultTarget: Math.round(atrMultTarget * 100) / 100,\n          };\n\n          try {\n            const result = await runBacktest(config, bars, startDate, endDate);\n            results.push(result);\n\n            // Progress update every 25 iterations",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-threshold-optimizer-fast.ts",
        "start": 565,
        "end": 618,
        "startLoc": {
          "line": 565,
          "column": 73,
          "position": 7473
        },
        "endLoc": {
          "line": 618,
          "column": 39,
          "position": 8197
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 556,
        "end": 609,
        "startLoc": {
          "line": 556,
          "column": 66,
          "position": 7448
        },
        "endLoc": {
          "line": 609,
          "column": 39,
          "position": 8172
        }
      }
    },
    {
      "format": "typescript",
      "lines": 37,
      "fragment": ") {\n              const elapsed = (Date.now() - startTime) / 1000;\n              const rate = iteration / elapsed;\n              const eta = (totalIterations - iteration) / rate;\n              const progress = (iteration / totalIterations * 100).toFixed(1);\n\n              console.log(`\\n  Iteration ${iteration}/${totalIterations} (${progress}%)`);\n              console.log(`   Current: buyThresh=${config.buyThreshold.toFixed(2)}, conf=${config.confidenceMin.toFixed(2)}, stop=${config.atrMultStop.toFixed(2)}x, target=${config.atrMultTarget.toFixed(2)}x`);\n              console.log(`   Result: Return=${(result.totalReturn * 100).toFixed(1)}%, Sharpe=${result.sharpe.toFixed(2)}, Trades=${result.trades.length}`);\n              console.log(`   Rate: ${rate.toFixed(1)} iter/s | ETA: ${Math.round(eta)}s`);\n\n              // Show current best\n              if (results.length > 0) {\n                const best = results.reduce((a, b) => a.sharpe > b.sharpe ? a : b);\n                console.log(`   Best so far: Sharpe=${best.sharpe.toFixed(2)}, Return=${(best.totalReturn * 100).toFixed(1)}%, WinRate=${(best.winRate * 100).toFixed(1)}%`);\n              }\n            }\n          } catch (err) {\n            // Skip failed backtests\n          }\n        }\n      }\n    }\n  }\n\n  const totalTime = (Date.now() - startTime) / 1000;\n\n  console.log('\\n' + ''.repeat(80));\n  console.log('  OPTIMIZATION COMPLETE');\n  console.log(''.repeat(80));\n\n  console.log(`\\n  Total Iterations: ${iteration.toLocaleString()}`);\n  console.log(`  Total Time: ${Math.round(totalTime)}s (${(iteration / totalTime).toFixed(1)} iter/s)`);\n  console.log(`  Valid Results: ${results.length}`);\n\n  // Sort by different metrics\n  const bySharpe = [...results].sort((a, b) => b.sharpe - a.sharpe).slice(0, 10",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-threshold-optimizer-fast.ts",
        "start": 619,
        "end": 655,
        "startLoc": {
          "line": 619,
          "column": 16,
          "position": 8220
        },
        "endLoc": {
          "line": 655,
          "column": 3,
          "position": 8773
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 610,
        "end": 646,
        "startLoc": {
          "line": 610,
          "column": 2,
          "position": 8187
        },
        "endLoc": {
          "line": 646,
          "column": 2,
          "position": 8740
        }
      }
    },
    {
      "format": "typescript",
      "lines": 25,
      "fragment": "${(riskRewards.reduce((a, b) => a + b, 0) / riskRewards.length).toFixed(2)}:1`);\n\n  console.log('\\n' + ''.repeat(80));\n  console.log('  RECOMMENDED THRESHOLD CONFIGURATION');\n  console.log(''.repeat(80));\n\n  const best = bySharpe[0];\n  console.log(`\\n  Based on ${results.length} backtests, the optimal configuration is:`);\n  console.log(`\\n  Entry Thresholds:`);\n  console.log(`    Buy Threshold: ${best.config.buyThreshold.toFixed(2)}`);\n  console.log(`    Confidence Minimum: ${best.config.confidenceMin.toFixed(2)}`);\n  console.log(`\\n  Exit Thresholds:`);\n  console.log(`    ATR Stop Multiplier: ${best.config.atrMultStop.toFixed(2)}x`);\n  console.log(`    ATR Target Multiplier: ${best.config.atrMultTarget.toFixed(2)}x`);\n  console.log(`    Risk/Reward Ratio: ${best.riskRewardRatio.toFixed(2)}:1`);\n  console.log(`\\n  Expected Performance:`);\n  console.log(`    Sharpe Ratio: ${best.sharpe.toFixed(3)}`);\n  console.log(`    Sortino Ratio: ${best.sortino.toFixed(3)}`);\n  console.log(`    Calmar Ratio: ${best.calmar.toFixed(3)}`);\n  console.log(`    Total Return: ${(best.totalReturn * 100).toFixed(2)}%`);\n  console.log(`    Max Drawdown: ${(best.maxDrawdown * 100).toFixed(2)}%`);\n  console.log(`    Win Rate: ${(best.winRate * 100).toFixed(1)}%`);\n  console.log(`    Trades: ${best.trades.length}`);\n  console.log(`    Profit Factor: ${best.profitFactor.toFixed(2)}`);\n  console.log(`    Avg Win: $${best.avgWin.toFixed(2)} | Avg Loss: $",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-threshold-optimizer-fast.ts",
        "start": 724,
        "end": 748,
        "startLoc": {
          "line": 724,
          "column": 11,
          "position": 10427
        },
        "endLoc": {
          "line": 748,
          "column": 15,
          "position": 10857
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 742,
        "end": 766,
        "startLoc": {
          "line": 742,
          "column": 11,
          "position": 10804
        },
        "endLoc": {
          "line": 766,
          "column": 2,
          "position": 11234
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": "async function fetchAlpacaBars(symbol: string, start: string, end: string): Promise<AlpacaBar[]> {\n  const allBars: AlpacaBar[] = [];\n  let pageToken: string | null = null;\n\n  do {\n    let url = `${ALPACA_DATA_URL}/v2/stocks/${symbol}/bars?timeframe=1Day&start=${start}&end=${end}&limit=10000&feed=iex`;\n    if (pageToken) url += `&page_token=${pageToken}`;\n\n    const response = await fetch(url, {\n      headers: {\n        'APCA-API-KEY-ID': ALPACA_KEY,\n        'APCA-API-SECRET-KEY': ALPACA_SECRET,\n      },\n    });\n\n    if (!response.ok) {\n      console",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-sector-rotation-optimizer.ts",
        "start": 131,
        "end": 147,
        "startLoc": {
          "line": 131,
          "column": 1,
          "position": 1537
        },
        "endLoc": {
          "line": 147,
          "column": 8,
          "position": 1714
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 121,
        "end": 137,
        "startLoc": {
          "line": 121,
          "column": 1,
          "position": 773
        },
        "endLoc": {
          "line": 137,
          "column": 6,
          "position": 950
        }
      }
    },
    {
      "format": "typescript",
      "lines": 38,
      "fragment": ";\n    }\n\n    const data = await response.json();\n    if (data.bars && Array.isArray(data.bars)) {\n      allBars.push(...data.bars);\n    }\n    pageToken = data.next_page_token || null;\n  } while (pageToken);\n\n  return allBars;\n}\n\n// ============= TECHNICAL INDICATORS =============\n\nfunction calculateSMA(data: number[], period: number): number[] {\n  const result: number[] = [];\n  for (let i = 0; i < data.length; i++) {\n    if (i < period - 1) result.push(NaN);\n    else {\n      const sum = data.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0);\n      result.push(sum / period);\n    }\n  }\n  return result;\n}\n\nfunction calculateEMA(data: number[], period: number): number[] {\n  const result: number[] = [];\n  const multiplier = 2 / (period + 1);\n  for (let i = 0; i < data.length; i++) {\n    if (i === 0) result.push(data[0]);\n    else result.push((data[i] - result[i - 1]) * multiplier + result[i - 1]);\n  }\n  return result;\n}\n\nfunction calculateMomentum",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-sector-rotation-optimizer.ts",
        "start": 148,
        "end": 185,
        "startLoc": {
          "line": 148,
          "column": 2,
          "position": 1737
        },
        "endLoc": {
          "line": 185,
          "column": 18,
          "position": 2176
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 137,
        "end": 174,
        "startLoc": {
          "line": 137,
          "column": 2,
          "position": 964
        },
        "endLoc": {
          "line": 174,
          "column": 13,
          "position": 1403
        }
      }
    },
    {
      "format": "typescript",
      "lines": 20,
      "fragment": "});\n    }\n  }\n\n  // Calculate metrics\n  const totalReturn = (equity[equity.length - 1] - initialCapital) / initialCapital;\n  const maxDrawdown = equity.reduce((maxDD, val, i) => {\n    const peak = Math.max(...equity.slice(0, i + 1));\n    return Math.max(maxDD, (peak - val) / peak);\n  }, 0);\n\n  const avgReturn = dailyReturns.reduce((a, b) => a + b, 0) / (dailyReturns.length || 1);\n  const stdReturn = Math.sqrt(dailyReturns.reduce((sum, r) => sum + Math.pow(r - avgReturn, 2), 0) / (dailyReturns.length || 1));\n  const sharpe = stdReturn > 0 ? (avgReturn * 252) / (stdReturn * Math.sqrt(252)) : 0;\n\n  const negativeReturns = dailyReturns.filter(r => r < 0);\n  const downstdReturn = Math.sqrt(negativeReturns.reduce((sum, r) => sum + r * r, 0) / (negativeReturns.length || 1));\n  const sortino = downstdReturn > 0 ? (avgReturn * 252) / (downstdReturn * Math.sqrt(252)) : 0;\n\n  const years = allDates",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-sector-rotation-optimizer.ts",
        "start": 462,
        "end": 481,
        "startLoc": {
          "line": 462,
          "column": 7,
          "position": 5605
        },
        "endLoc": {
          "line": 481,
          "column": 9,
          "position": 6007
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 474,
        "end": 491,
        "startLoc": {
          "line": 474,
          "column": 7,
          "position": 6211
        },
        "endLoc": {
          "line": 491,
          "column": 12,
          "position": 6611
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": "async function fetchAlpacaBars(symbol: string, start: string, end: string): Promise<AlpacaBar[]> {\n  const allBars: AlpacaBar[] = [];\n  let pageToken: string | null = null;\n\n  do {\n    let url = `${ALPACA_DATA_URL}/v2/stocks/${symbol}/bars?timeframe=1Day&start=${start}&end=${end}&limit=10000&feed=iex`;\n    if (pageToken) url += `&page_token=${pageToken}`;\n\n    const response = await fetch(url, {\n      headers: {\n        'APCA-API-KEY-ID': ALPACA_KEY,\n        'APCA-API-SECRET-KEY': ALPACA_SECRET,\n      },\n    });\n\n    if (!response.ok) throw",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-risk-optimizer.ts",
        "start": 104,
        "end": 119,
        "startLoc": {
          "line": 104,
          "column": 1,
          "position": 727
        },
        "endLoc": {
          "line": 119,
          "column": 6,
          "position": 901
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 121,
        "end": 136,
        "startLoc": {
          "line": 121,
          "column": 1,
          "position": 773
        },
        "endLoc": {
          "line": 136,
          "column": 2,
          "position": 947
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": "): number[] {\n  const changes: number[] = [];\n  for (let i = 1; i < closes.length; i++) changes.push(closes[i] - closes[i - 1]);\n  const gains = changes.map(c => c > 0 ? c : 0);\n  const losses = changes.map(c => c < 0 ? -c : 0);\n  const avgGain = calculateEMA(gains, period);\n  const avgLoss = calculateEMA(losses, period);\n\n  const rsi: number[] = [NaN];\n  for (let i = 0; i < avgGain.length; i++) {\n    if (avgLoss[i] === 0) rsi.push(100);\n    else rsi.push(100 - (100 / (1 + avgGain[i] / avgLoss[i])));\n  }\n  return rsi;\n}\n\nfunction calculateATR",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-risk-optimizer.ts",
        "start": 150,
        "end": 166,
        "startLoc": {
          "line": 150,
          "column": 3,
          "position": 1347
        },
        "endLoc": {
          "line": 166,
          "column": 13,
          "position": 1634
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 174,
        "end": 190,
        "startLoc": {
          "line": 174,
          "column": 7,
          "position": 1417
        },
        "endLoc": {
          "line": 190,
          "column": 14,
          "position": 1704
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": "}\n      }\n    }\n\n    // Update equity\n    let currentEquity = capital;\n    for (const [symbol, pos] of positions) {\n      const symbolBars = bars.get(symbol);\n      if (symbolBars) {\n        const currentBar = symbolBars.find(b => b.t === currentDate);\n        if (currentBar) currentEquity += pos.shares * currentBar.c;\n      }\n    }\n\n    equity.push(currentEquity);\n    peakCapital",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-risk-optimizer.ts",
        "start": 378,
        "end": 393,
        "startLoc": {
          "line": 378,
          "column": 9,
          "position": 4444
        },
        "endLoc": {
          "line": 393,
          "column": 12,
          "position": 4574
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 439,
        "end": 453,
        "startLoc": {
          "line": 439,
          "column": 9,
          "position": 5804
        },
        "endLoc": {
          "line": 453,
          "column": 3,
          "position": 5933
        }
      }
    },
    {
      "format": "typescript",
      "lines": 22,
      "fragment": "const start = startDate.toISOString().split('T')[0];\n  const end = endDate.toISOString().split('T')[0];\n\n  console.log(`\\nLoading historical data for ${SYMBOLS.length} symbols...`);\n  console.log(`Period: ${start} to ${end}`);\n\n  let loaded = 0;\n  for (const symbol of SYMBOLS) {\n    try {\n      const symbolBars = await fetchAlpacaBars(symbol, start, end);\n      if (symbolBars.length > 100) {\n        bars.set(symbol, symbolBars);\n        loaded++;\n      }\n      await new Promise(r => setTimeout(r, 100));\n    } catch (err) {\n      // Skip errors\n    }\n    process.stdout.write(`\\r  Loaded ${loaded}/${SYMBOLS.length} symbols`);\n  }\n\n  console.log(`\\n  Successfully loaded ${bars.size} symbols\\n`",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-risk-optimizer.ts",
        "start": 518,
        "end": 539,
        "startLoc": {
          "line": 518,
          "column": 3,
          "position": 6618
        },
        "endLoc": {
          "line": 539,
          "column": 12,
          "position": 6855
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 529,
        "end": 559,
        "startLoc": {
          "line": 529,
          "column": 3,
          "position": 7166
        },
        "endLoc": {
          "line": 559,
          "column": 10,
          "position": 7430
        }
      }
    },
    {
      "format": "typescript",
      "lines": 25,
      "fragment": "technicalWeight: number;\n  volatilityWeight: number;\n  volumeWeight: number;\n  sentimentWeight: number;\n}\n\ninterface BacktestMetrics {\n  totalTrades: number;\n  winRate: number;\n  totalReturn: number;\n  sharpeRatio: number;\n  sortinoRatio: number;\n  calmarRatio: number;\n  maxDrawdown: number;\n  profitFactor: number;\n  avgHoldingDays: number;\n  finalEquity: number;\n  cagr: number;\n}\n\ninterface OptimizationResult {\n  config: MomentumConfig;\n  metrics: BacktestMetrics;\n  score: number;\n}",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-momentum-optimizer-fast.ts",
        "start": 35,
        "end": 59,
        "startLoc": {
          "line": 35,
          "column": 3,
          "position": 159
        },
        "endLoc": {
          "line": 59,
          "column": 2,
          "position": 302
        }
      },
      "secondFile": {
        "name": "scripts/omar-momentum-optimizer.ts",
        "start": 44,
        "end": 67,
        "startLoc": {
          "line": 44,
          "column": 3,
          "position": 180
        },
        "endLoc": {
          "line": 67,
          "column": 31,
          "position": 323
        }
      }
    },
    {
      "format": "typescript",
      "lines": 67,
      "fragment": "// ============================================================================\n\nfunction calculateSMA(prices: number[], period: number): (number | null)[] {\n  const result: (number | null)[] = [];\n  for (let i = 0; i < prices.length; i++) {\n    if (i < period - 1) result.push(null);\n    else result.push(prices.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0) / period);\n  }\n  return result;\n}\n\nfunction calculateEMA(prices: number[], period: number): (number | null)[] {\n  const result: (number | null)[] = [];\n  const k = 2 / (period + 1);\n  for (let i = 0; i < prices.length; i++) {\n    if (i < period - 1) result.push(null);\n    else if (i === period - 1) result.push(prices.slice(0, period).reduce((a, b) => a + b, 0) / period);\n    else result.push((prices[i] - result[i - 1]!) * k + result[i - 1]!);\n  }\n  return result;\n}\n\nfunction calculateRSI(prices: number[], period: number): (number | null)[] {\n  const result: (number | null)[] = [];\n  for (let i = 0; i < prices.length; i++) {\n    if (i < period) {\n      result.push(null);\n    } else {\n      let gains = 0, losses = 0;\n      for (let j = i - period + 1; j <= i; j++) {\n        const change = prices[j] - prices[j - 1];\n        if (change > 0) gains += change;\n        else losses += Math.abs(change);\n      }\n      const avgGain = gains / period;\n      const avgLoss = losses / period;\n      const rs = avgLoss === 0 ? 100 : avgGain / avgLoss;\n      result.push(100 - (100 / (1 + rs)));\n    }\n  }\n  return result;\n}\n\nfunction calculateATR(highs: number[], lows: number[], closes: number[], period: number): (number | null)[] {\n  const result: (number | null)[] = [];\n  const tr: number[] = [];\n  for (let i = 0; i < highs.length; i++) {\n    if (i === 0) tr.push(highs[i] - lows[i]);\n    else tr.push(Math.max(highs[i] - lows[i], Math.abs(highs[i] - closes[i - 1]), Math.abs(lows[i] - closes[i - 1])));\n  }\n  for (let i = 0; i < tr.length; i++) {\n    if (i < period - 1) result.push(null);\n    else result.push(tr.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0) / period);\n  }\n  return result;\n}\n\nfunction calculateROC(prices: number[], period: number): (number | null)[] {\n  const result: (number | null)[] = [];\n  for (let i = 0; i < prices.length; i++) {\n    if (i < period) result.push(null);\n    else result.push(((prices[i] - prices[i - period]) / prices[i - period]) * 100);\n  }\n  return result;\n}\n\n// ============================================================================",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-momentum-optimizer-fast.ts",
        "start": 75,
        "end": 141,
        "startLoc": {
          "line": 75,
          "column": 1,
          "position": 399
        },
        "endLoc": {
          "line": 141,
          "column": 80,
          "position": 1617
        }
      },
      "secondFile": {
        "name": "scripts/omar-momentum-optimizer.ts",
        "start": 89,
        "end": 155,
        "startLoc": {
          "line": 89,
          "column": 1,
          "position": 437
        },
        "endLoc": {
          "line": 155,
          "column": 9,
          "position": 1655
        }
      }
    },
    {
      "format": "typescript",
      "lines": 83,
      "fragment": "}\n\n  // Calculate metrics\n  const winningTrades = trades.filter(t => t.pnl > 0);\n  const losingTrades = trades.filter(t => t.pnl <= 0);\n  const totalWins = winningTrades.reduce((sum, t) => sum + t.pnl, 0);\n  const totalLosses = Math.abs(losingTrades.reduce((sum, t) => sum + t.pnl, 0));\n\n  const returns = trades.map(t => t.pnlPct / 100);\n  const avgReturn = returns.length > 0 ? returns.reduce((a, b) => a + b, 0) / returns.length : 0;\n  const stdDev = returns.length > 1 ? Math.sqrt(returns.reduce((sum, r) => sum + Math.pow(r - avgReturn, 2), 0) / returns.length) : 0;\n  const downReturns = returns.filter(r => r < 0);\n  const downStdDev = downReturns.length > 1 ? Math.sqrt(downReturns.reduce((sum, r) => sum + Math.pow(r, 2), 0) / downReturns.length) : 1;\n\n  const sharpeRatio = stdDev !== 0 ? (avgReturn * Math.sqrt(252)) / stdDev : 0;\n  const sortinoRatio = downStdDev !== 0 ? (avgReturn * Math.sqrt(252)) / downStdDev : 0;\n  const years = 2.95;\n  const cagr = years > 0 ? (Math.pow(equity / config.initialCapital, 1 / years) - 1) * 100 : 0;\n  const calmarRatio = maxDrawdown > 0 ? cagr / maxDrawdown : 0;\n\n  return {\n    totalTrades: trades.length,\n    winRate: trades.length > 0 ? (winningTrades.length / trades.length) * 100 : 0,\n    totalReturn: (equity - config.initialCapital) / config.initialCapital * 100,\n    sharpeRatio,\n    sortinoRatio,\n    calmarRatio,\n    maxDrawdown,\n    profitFactor: totalLosses > 0 ? totalWins / totalLosses : 0,\n    avgHoldingDays: trades.length > 0 ? trades.reduce((sum, t) => sum + t.holdingDays, 0) / trades.length : 0,\n    finalEquity: equity,\n    cagr,\n  };\n}\n\n// ============================================================================\n// DATA FETCHING\n// ============================================================================\n\nasync function fetchAlpacaBars(symbol: string, startDate: string, endDate: string): Promise<AlpacaBar[]> {\n  const ALPACA_KEY = process.env.ALPACA_API_KEY;\n  const ALPACA_SECRET = process.env.ALPACA_SECRET_KEY;\n\n  if (!ALPACA_KEY || !ALPACA_SECRET) {\n    throw new Error(\"Alpaca API credentials not configured\");\n  }\n\n  const baseUrl = \"https://data.alpaca.markets/v2/stocks\";\n  const allBars: AlpacaBar[] = [];\n  let pageToken: string | null = null;\n\n  do {\n    const params = new URLSearchParams({\n      start: `${startDate}T00:00:00Z`,\n      end: `${endDate}T23:59:59Z`,\n      timeframe: \"1Day\",\n      limit: \"10000\",\n    });\n\n    if (pageToken) params.set(\"page_token\", pageToken);\n    const url = `${baseUrl}/${symbol}/bars?${params.toString()}`;\n\n    const response = await fetch(url, {\n      headers: {\n        \"APCA-API-KEY-ID\": ALPACA_KEY,\n        \"APCA-API-SECRET-KEY\": ALPACA_SECRET,\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`Alpaca API error: ${response.status}`);\n    }\n\n    const data = await response.json();\n    allBars.push(...(data.bars || []));\n    pageToken = data.next_page_token || null;\n  } while (pageToken);\n\n  return allBars;\n}\n\n// ============================================================================\n// MAIN OPTIMIZER",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-momentum-optimizer-fast.ts",
        "start": 424,
        "end": 506,
        "startLoc": {
          "line": 424,
          "column": 3,
          "position": 4828
        },
        "endLoc": {
          "line": 506,
          "column": 18,
          "position": 5929
        }
      },
      "secondFile": {
        "name": "scripts/omar-momentum-optimizer.ts",
        "start": 482,
        "end": 565,
        "startLoc": {
          "line": 482,
          "column": 3,
          "position": 5607
        },
        "endLoc": {
          "line": 565,
          "column": 13,
          "position": 6709
        }
      }
    },
    {
      "format": "typescript",
      "lines": 71,
      "fragment": ";\n}\n\n// ============= ALPACA DATA FETCHER =============\n\nasync function fetchAlpacaBars(symbol: string, start: string, end: string): Promise<AlpacaBar[]> {\n  const allBars: AlpacaBar[] = [];\n  let pageToken: string | null = null;\n\n  do {\n    let url = `${ALPACA_DATA_URL}/v2/stocks/${symbol}/bars?timeframe=1Day&start=${start}&end=${end}&limit=10000&feed=iex`;\n    if (pageToken) url += `&page_token=${pageToken}`;\n\n    const response = await fetch(url, {\n      headers: {\n        'APCA-API-KEY-ID': ALPACA_KEY,\n        'APCA-API-SECRET-KEY': ALPACA_SECRET,\n      },\n    });\n\n    if (!response.ok) throw new Error(`HTTP ${response.status}`);\n\n    const data = await response.json();\n    if (data.bars && Array.isArray(data.bars)) allBars.push(...data.bars);\n    pageToken = data.next_page_token || null;\n  } while (pageToken);\n\n  return allBars;\n}\n\n// ============= TECHNICAL INDICATORS =============\n\nfunction calculateSMA(data: number[], period: number): number[] {\n  const result: number[] = [];\n  for (let i = 0; i < data.length; i++) {\n    if (i < period - 1) result.push(NaN);\n    else {\n      const sum = data.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0);\n      result.push(sum / period);\n    }\n  }\n  return result;\n}\n\nfunction calculateEMA(data: number[], period: number): number[] {\n  const result: number[] = [];\n  const multiplier = 2 / (period + 1);\n  for (let i = 0; i < data.length; i++) {\n    if (i === 0) result.push(data[0]);\n    else result.push((data[i] - result[i - 1]) * multiplier + result[i - 1]);\n  }\n  return result;\n}\n\nfunction calculateRSI(closes: number[], period: number): number[] {\n  const changes: number[] = [];\n  for (let i = 1; i < closes.length; i++) changes.push(closes[i] - closes[i - 1]);\n  const gains = changes.map(c => c > 0 ? c : 0);\n  const losses = changes.map(c => c < 0 ? -c : 0);\n  const avgGain = calculateEMA(gains, period);\n  const avgLoss = calculateEMA(losses, period);\n\n  const rsi: number[] = [NaN];\n  for (let i = 0; i < avgGain.length; i++) {\n    if (avgLoss[i] === 0) rsi.push(100);\n    else rsi.push(100 - (100 / (1 + avgGain[i] / avgLoss[i])));\n  }\n  return rsi;\n}\n\nfunction calculateBollingerBands",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-mean-reversion-optimizer.ts",
        "start": 118,
        "end": 188,
        "startLoc": {
          "line": 118,
          "column": 7,
          "position": 1279
        },
        "endLoc": {
          "line": 188,
          "column": 24,
          "position": 2206
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 116,
        "end": 190,
        "startLoc": {
          "line": 116,
          "column": 8,
          "position": 765
        },
        "endLoc": {
          "line": 190,
          "column": 14,
          "position": 1704
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": ",\n  bars: Map<string, AlpacaBar[]>,\n  startDate: Date,\n  endDate: Date\n): Promise<BacktestResult> {\n  const initialCapital = 100000;\n  let capital = initialCapital;\n  const trades: TradeResult[] = [];\n  const equity: number[] = [capital];\n  const dailyReturns: number[] = [];\n  const positions: Map<string, {\n    entry: number,\n    shares: number,\n    entryDate: string,\n    stopLoss: number,\n    takeProfit: number,\n    entryRSI",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-mean-reversion-optimizer.ts",
        "start": 419,
        "end": 435,
        "startLoc": {
          "line": 419,
          "column": 2,
          "position": 5926
        },
        "endLoc": {
          "line": 435,
          "column": 9,
          "position": 6084
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 338,
        "end": 344,
        "startLoc": {
          "line": 338,
          "column": 16,
          "position": 4479
        },
        "endLoc": {
          "line": 344,
          "column": 11,
          "position": 4627
        }
      }
    },
    {
      "format": "typescript",
      "lines": 24,
      "fragment": ": number\n  }> = new Map();\n\n  // Get trading days\n  const tradingDays: string[] = [];\n  const firstBars = bars.values().next().value;\n  if (firstBars) {\n    for (const bar of firstBars) {\n      const date = new Date(bar.t);\n      if (date >= startDate && date <= endDate) tradingDays.push(bar.t);\n    }\n  }\n\n  for (let dayIdx = 50; dayIdx < tradingDays.length; dayIdx++) {\n    const currentDate = tradingDays[dayIdx];\n\n    // Check exits\n    for (const [symbol, pos] of positions) {\n      const symbolBars = bars.get(symbol);\n      if (!symbolBars) continue;\n      const currentBar = symbolBars.find(b => b.t === currentDate);\n      if (!currentBar) continue;\n\n      const currentPrice",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-mean-reversion-optimizer.ts",
        "start": 436,
        "end": 459,
        "startLoc": {
          "line": 436,
          "column": 16,
          "position": 6092
        },
        "endLoc": {
          "line": 459,
          "column": 13,
          "position": 6357
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 344,
        "end": 366,
        "startLoc": {
          "line": 344,
          "column": 11,
          "position": 4628
        },
        "endLoc": {
          "line": 366,
          "column": 5,
          "position": 4892
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": ";\n      }\n\n      if (exitPrice) {\n        const pnl = (exitPrice - pos.entry) * pos.shares;\n        const pnlPct = (exitPrice - pos.entry) / pos.entry;\n        capital += pos.shares * exitPrice;\n        trades.push({\n          symbol,\n          entry: pos.entry,\n          exit: exitPrice,\n          pnl,\n          pnlPct,\n          holdingDays: dayIdx - tradingDays.indexOf(pos.entryDate),\n          entryDate: pos.entryDate,\n          exitDate: currentDate,\n          entryRSI",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-mean-reversion-optimizer.ts",
        "start": 470,
        "end": 486,
        "startLoc": {
          "line": 470,
          "column": 9,
          "position": 6486
        },
        "endLoc": {
          "line": 486,
          "column": 9,
          "position": 6633
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 377,
        "end": 393,
        "startLoc": {
          "line": 377,
          "column": 5,
          "position": 5019
        },
        "endLoc": {
          "line": 393,
          "column": 11,
          "position": 5166
        }
      }
    },
    {
      "format": "typescript",
      "lines": 35,
      "fragment": "});\n          capital -= shares * candidate.price;\n        }\n      }\n    }\n\n    // Update equity\n    let currentEquity = capital;\n    for (const [symbol, pos] of positions) {\n      const symbolBars = bars.get(symbol);\n      if (symbolBars) {\n        const currentBar = symbolBars.find(b => b.t === currentDate);\n        if (currentBar) currentEquity += pos.shares * currentBar.c;\n      }\n    }\n    equity.push(currentEquity);\n    if (equity.length > 1) dailyReturns.push((currentEquity - equity[equity.length - 2]) / equity[equity.length - 2]);\n  }\n\n  // Close remaining positions\n  for (const [symbol, pos] of positions) {\n    const symbolBars = bars.get(symbol);\n    if (symbolBars && symbolBars.length > 0) {\n      const lastBar = symbolBars[symbolBars.length - 1];\n      const exitPrice = lastBar.c;\n      trades.push({\n        symbol,\n        entry: pos.entry,\n        exit: exitPrice,\n        pnl: (exitPrice - pos.entry) * pos.shares,\n        pnlPct: (exitPrice - pos.entry) / pos.entry,\n        holdingDays: tradingDays.length - tradingDays.indexOf(pos.entryDate),\n        entryDate: pos.entryDate,\n        exitDate: tradingDays[tradingDays.length - 1],\n        entryRSI",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-mean-reversion-optimizer.ts",
        "start": 546,
        "end": 580,
        "startLoc": {
          "line": 546,
          "column": 11,
          "position": 7350
        },
        "endLoc": {
          "line": 580,
          "column": 9,
          "position": 7753
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 437,
        "end": 471,
        "startLoc": {
          "line": 437,
          "column": 11,
          "position": 5785
        },
        "endLoc": {
          "line": 471,
          "column": 11,
          "position": 6188
        }
      }
    },
    {
      "format": "typescript",
      "lines": 22,
      "fragment": "});\n    }\n  }\n\n  // Calculate metrics\n  const totalReturn = (equity[equity.length - 1] - initialCapital) / initialCapital;\n  const maxDrawdown = equity.reduce((maxDD, val, i) => {\n    const peak = Math.max(...equity.slice(0, i + 1));\n    return Math.max(maxDD, (peak - val) / peak);\n  }, 0);\n\n  const avgReturn = dailyReturns.reduce((a, b) => a + b, 0) / (dailyReturns.length || 1);\n  const stdReturn = Math.sqrt(dailyReturns.reduce((sum, r) => sum + Math.pow(r - avgReturn, 2), 0) / (dailyReturns.length || 1));\n  const sharpe = stdReturn > 0 ? (avgReturn * 252) / (stdReturn * Math.sqrt(252)) : 0;\n  const negativeReturns = dailyReturns.filter(r => r < 0);\n  const downstdReturn = Math.sqrt(negativeReturns.reduce((sum, r) => sum + r * r, 0) / (negativeReturns.length || 1));\n  const sortino = downstdReturn > 0 ? (avgReturn * 252) / (downstdReturn * Math.sqrt(252)) : 0;\n  const years = tradingDays.length / 252;\n  const cagr = Math.pow(1 + totalReturn, 1 / years) - 1;\n  const calmar = maxDrawdown > 0 ? cagr / maxDrawdown : 0;\n  const winRate = trades.length > 0 ? trades.filter(t => t.pnl > 0).length / trades.length : 0;\n  const",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-mean-reversion-optimizer.ts",
        "start": 582,
        "end": 603,
        "startLoc": {
          "line": 582,
          "column": 7,
          "position": 7770
        },
        "endLoc": {
          "line": 603,
          "column": 6,
          "position": 8283
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 474,
        "end": 496,
        "startLoc": {
          "line": 474,
          "column": 7,
          "position": 6211
        },
        "endLoc": {
          "line": 496,
          "column": 30,
          "position": 6725
        }
      }
    },
    {
      "format": "typescript",
      "lines": 32,
      "fragment": "async function loadHistoricalData(): Promise<Map<string, AlpacaBar[]>> {\n  const bars = new Map<string, AlpacaBar[]>();\n  const endDate = new Date();\n  const startDate = new Date();\n  startDate.setFullYear(startDate.getFullYear() - 2);\n\n  const start = startDate.toISOString().split('T')[0];\n  const end = endDate.toISOString().split('T')[0];\n\n  console.log(`\\nLoading historical data for ${SYMBOLS.length} symbols...`);\n  console.log(`Period: ${start} to ${end}`);\n\n  let loaded = 0;\n  for (const symbol of SYMBOLS) {\n    try {\n      const symbolBars = await fetchAlpacaBars(symbol, start, end);\n      if (symbolBars.length > 100) {\n        bars.set(symbol, symbolBars);\n        loaded++;\n      }\n      await new Promise(r => setTimeout(r, 100));\n    } catch (err) {\n      // Skip errors\n    }\n    process.stdout.write(`\\r  Loaded ${loaded}/${SYMBOLS.length} symbols`);\n  }\n\n  console.log(`\\n  Successfully loaded ${bars.size} symbols`);\n  return bars;\n}\n\nfunction",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-mean-reversion-optimizer.ts",
        "start": 610,
        "end": 641,
        "startLoc": {
          "line": 610,
          "column": 1,
          "position": 8379
        },
        "endLoc": {
          "line": 641,
          "column": 9,
          "position": 8721
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer-fast.ts",
        "start": 532,
        "end": 563,
        "startLoc": {
          "line": 532,
          "column": 1,
          "position": 7101
        },
        "endLoc": {
          "line": 563,
          "column": 6,
          "position": 7443
        }
      }
    },
    {
      "format": "typescript",
      "lines": 26,
      "fragment": "async function fetchAlpacaBars(symbol: string, start: string, end: string): Promise<AlpacaBar[]> {\n  const allBars: AlpacaBar[] = [];\n  let pageToken: string | null = null;\n\n  do {\n    let url = `${ALPACA_DATA_URL}/v2/stocks/${symbol}/bars?timeframe=1Day&start=${start}&end=${end}&limit=10000&feed=iex`;\n    if (pageToken) url += `&page_token=${pageToken}`;\n\n    const response = await fetch(url, {\n      headers: {\n        'APCA-API-KEY-ID': ALPACA_KEY,\n        'APCA-API-SECRET-KEY': ALPACA_SECRET,\n      },\n    });\n\n    if (!response.ok) throw new Error(`HTTP ${response.status}`);\n\n    const data = await response.json();\n    if (data.bars && Array.isArray(data.bars)) allBars.push(...data.bars);\n    pageToken = data.next_page_token || null;\n  } while (pageToken);\n\n  return allBars;\n}\n\n// ============================================================================",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-indicator-optimizer.ts",
        "start": 131,
        "end": 156,
        "startLoc": {
          "line": 131,
          "column": 1,
          "position": 914
        },
        "endLoc": {
          "line": 156,
          "column": 80,
          "position": 1186
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 121,
        "end": 129,
        "startLoc": {
          "line": 121,
          "column": 1,
          "position": 773
        },
        "endLoc": {
          "line": 129,
          "column": 52,
          "position": 999
        }
      }
    },
    {
      "format": "typescript",
      "lines": 18,
      "fragment": ",\n          });\n          capital -= shares * candidate.price;\n        }\n      }\n    }\n\n    // Update equity\n    let currentEquity = capital;\n    for (const [symbol, pos] of positions) {\n      const symbolBars = bars.get(symbol);\n      if (symbolBars) {\n        const currentBar = symbolBars.find(b => b.t === currentDate);\n        if (currentBar) currentEquity += pos.shares * currentBar.c;\n      }\n    }\n\n    equityCurve",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-indicator-optimizer.ts",
        "start": 479,
        "end": 496,
        "startLoc": {
          "line": 479,
          "column": 11,
          "position": 6147
        },
        "endLoc": {
          "line": 496,
          "column": 12,
          "position": 6290
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 436,
        "end": 452,
        "startLoc": {
          "line": 436,
          "column": 11,
          "position": 5782
        },
        "endLoc": {
          "line": 452,
          "column": 7,
          "position": 5924
        }
      }
    },
    {
      "format": "typescript",
      "lines": 35,
      "fragment": ": number;\n}\n\n// ============= ALPACA DATA FETCHER =============\n\nasync function fetchAlpacaBars(symbol: string, start: string, end: string): Promise<AlpacaBar[]> {\n  const allBars: AlpacaBar[] = [];\n  let pageToken: string | null = null;\n\n  do {\n    let url = `${ALPACA_DATA_URL}/v2/stocks/${symbol}/bars?timeframe=1Day&start=${start}&end=${end}&limit=10000&feed=iex`;\n    if (pageToken) url += `&page_token=${pageToken}`;\n\n    const response = await fetch(url, {\n      headers: {\n        'APCA-API-KEY-ID': ALPACA_KEY,\n        'APCA-API-SECRET-KEY': ALPACA_SECRET,\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n\n    const data = await response.json();\n    if (data.bars && Array.isArray(data.bars)) {\n      allBars.push(...data.bars);\n    }\n    pageToken = data.next_page_token || null;\n  } while (pageToken);\n\n  return allBars;\n}\n\n// ============= GENETIC OPERATORS =============",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-hyperoptimizer.ts",
        "start": 137,
        "end": 171,
        "startLoc": {
          "line": 137,
          "column": 15,
          "position": 1697
        },
        "endLoc": {
          "line": 171,
          "column": 49,
          "position": 1992
        }
      },
      "secondFile": {
        "name": "scripts/omar-mean-reversion-optimizer.ts",
        "start": 118,
        "end": 150,
        "startLoc": {
          "line": 118,
          "column": 15,
          "position": 1276
        },
        "endLoc": {
          "line": 150,
          "column": 52,
          "position": 1057
        }
      }
    },
    {
      "format": "typescript",
      "lines": 110,
      "fragment": ";\n}\n\n// ============= TECHNICAL INDICATORS =============\n\nfunction calculateSMA(data: number[], period: number): number[] {\n  const result: number[] = [];\n  for (let i = 0; i < data.length; i++) {\n    if (i < period - 1) result.push(NaN);\n    else {\n      const sum = data.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0);\n      result.push(sum / period);\n    }\n  }\n  return result;\n}\n\nfunction calculateEMA(data: number[], period: number): number[] {\n  const result: number[] = [];\n  const multiplier = 2 / (period + 1);\n  for (let i = 0; i < data.length; i++) {\n    if (i === 0) result.push(data[0]);\n    else result.push((data[i] - result[i - 1]) * multiplier + result[i - 1]);\n  }\n  return result;\n}\n\nfunction calculateRSI(closes: number[], period: number): number[] {\n  const changes: number[] = [];\n  for (let i = 1; i < closes.length; i++) changes.push(closes[i] - closes[i - 1]);\n  const gains = changes.map(c => c > 0 ? c : 0);\n  const losses = changes.map(c => c < 0 ? -c : 0);\n  const avgGain = calculateEMA(gains, period);\n  const avgLoss = calculateEMA(losses, period);\n\n  const rsi: number[] = [NaN];\n  for (let i = 0; i < avgGain.length; i++) {\n    if (avgLoss[i] === 0) rsi.push(100);\n    else rsi.push(100 - (100 / (1 + avgGain[i] / avgLoss[i])));\n  }\n  return rsi;\n}\n\nfunction calculateMACD(closes: number[], fast: number, slow: number, signal: number): { macd: number[], signal: number[], histogram: number[] } {\n  const emaFast = calculateEMA(closes, fast);\n  const emaSlow = calculateEMA(closes, slow);\n  const macdLine = emaFast.map((v, i) => v - emaSlow[i]);\n  const signalLine = calculateEMA(macdLine, signal);\n  const histogram = macdLine.map((v, i) => v - signalLine[i]);\n  return { macd: macdLine, signal: signalLine, histogram };\n}\n\nfunction calculateBollingerBands(closes: number[], period: number, stdDev: number): { upper: number[], middle: number[], lower: number[] } {\n  const middle = calculateSMA(closes, period);\n  const upper: number[] = [];\n  const lower: number[] = [];\n\n  for (let i = 0; i < closes.length; i++) {\n    if (i < period - 1) { upper.push(NaN); lower.push(NaN); }\n    else {\n      const slice = closes.slice(i - period + 1, i + 1);\n      const mean = middle[i];\n      const variance = slice.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / period;\n      const std = Math.sqrt(variance);\n      upper.push(mean + stdDev * std);\n      lower.push(mean - stdDev * std);\n    }\n  }\n  return { upper, middle, lower };\n}\n\nfunction calculateATR(highs: number[], lows: number[], closes: number[], period: number): number[] {\n  const tr: number[] = [highs[0] - lows[0]];\n  for (let i = 1; i < closes.length; i++) {\n    const hl = highs[i] - lows[i];\n    const hc = Math.abs(highs[i] - closes[i - 1]);\n    const lc = Math.abs(lows[i] - closes[i - 1]);\n    tr.push(Math.max(hl, hc, lc));\n  }\n  return calculateEMA(tr, period);\n}\n\nfunction calculateStochastic(highs: number[], lows: number[], closes: number[], period: number): { k: number[], d: number[] } {\n  const k: number[] = [];\n  for (let i = 0; i < closes.length; i++) {\n    if (i < period - 1) k.push(NaN);\n    else {\n      const highSlice = highs.slice(i - period + 1, i + 1);\n      const lowSlice = lows.slice(i - period + 1, i + 1);\n      const highest = Math.max(...highSlice);\n      const lowest = Math.min(...lowSlice);\n      const range = highest - lowest;\n      k.push(range === 0 ? 50 : ((closes[i] - lowest) / range) * 100);\n    }\n  }\n  const d = calculateSMA(k.filter(v => !isNaN(v)), 3);\n  return { k, d };\n}\n\nfunction calculateOBV(closes: number[], volumes: number[]): number[] {\n  const obv: number[] = [0];\n  for (let i = 1; i < closes.length; i++) {\n    if (closes[i] > closes[i - 1]) obv.push(obv[i - 1] + volumes[i]);\n    else if (closes[i] < closes[i - 1]) obv.push(obv[i - 1] - volumes[i]);\n    else obv.push(obv[i - 1]);\n  }\n  return obv;\n}\n\n// ============= PATTERN DETECTION =============",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-hyperoptimizer.ts",
        "start": 279,
        "end": 388,
        "startLoc": {
          "line": 279,
          "column": 2,
          "position": 3487
        },
        "endLoc": {
          "line": 388,
          "column": 49,
          "position": 5394
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 147,
        "end": 239,
        "startLoc": {
          "line": 147,
          "column": 8,
          "position": 1052
        },
        "endLoc": {
          "line": 239,
          "column": 49,
          "position": 2634
        }
      }
    },
    {
      "format": "typescript",
      "lines": 25,
      "fragment": "const tradingDays: string[] = [];\n  const firstBars = bars.values().next().value;\n  if (firstBars) {\n    for (const bar of firstBars) {\n      const date = new Date(bar.t);\n      if (date >= startDate && date <= endDate) tradingDays.push(bar.t);\n    }\n  }\n\n  for (let dayIdx = 50; dayIdx < tradingDays.length; dayIdx++) {\n    const currentDate = tradingDays[dayIdx];\n\n    // Check exits\n    for (const [symbol, pos] of positions) {\n      const symbolBars = bars.get(symbol);\n      if (!symbolBars) continue;\n      const currentBar = symbolBars.find(b => b.t === currentDate);\n      if (!currentBar) continue;\n\n      const currentPrice = currentBar.c;\n      const high = currentBar.h;\n      const low = currentBar.l;\n      let exitPrice: number | null = null;\n\n      if",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-hyperoptimizer.ts",
        "start": 560,
        "end": 584,
        "startLoc": {
          "line": 560,
          "column": 3,
          "position": 8743
        },
        "endLoc": {
          "line": 584,
          "column": 3,
          "position": 9038
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 347,
        "end": 463,
        "startLoc": {
          "line": 347,
          "column": 3,
          "position": 4649
        },
        "endLoc": {
          "line": 463,
          "column": 4,
          "position": 6408
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": "});\n          capital -= shares * candidate.price;\n        }\n      }\n    }\n\n    // Update equity\n    let currentEquity = capital;\n    for (const [symbol, pos] of positions) {\n      const symbolBars = bars.get(symbol);\n      if (symbolBars) {\n        const currentBar = symbolBars.find(b => b.t === currentDate);\n        if (currentBar) currentEquity += pos.shares * currentBar.c;\n      }\n    }\n    equity.push(currentEquity);\n    maxCapital",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-hyperoptimizer.ts",
        "start": 625,
        "end": 641,
        "startLoc": {
          "line": 625,
          "column": 2,
          "position": 9863
        },
        "endLoc": {
          "line": 641,
          "column": 11,
          "position": 10011
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 437,
        "end": 453,
        "startLoc": {
          "line": 437,
          "column": 11,
          "position": 5785
        },
        "endLoc": {
          "line": 453,
          "column": 3,
          "position": 5933
        }
      }
    },
    {
      "format": "typescript",
      "lines": 23,
      "fragment": "});\n    }\n  }\n\n  // Calculate metrics\n  const totalReturn = (equity[equity.length - 1] - initialCapital) / initialCapital;\n  const maxDrawdown = equity.reduce((maxDD, val, i) => {\n    const peak = Math.max(...equity.slice(0, i + 1));\n    return Math.max(maxDD, (peak - val) / peak);\n  }, 0);\n\n  const avgReturn = dailyReturns.reduce((a, b) => a + b, 0) / (dailyReturns.length || 1);\n  const stdReturn = Math.sqrt(dailyReturns.reduce((sum, r) => sum + Math.pow(r - avgReturn, 2), 0) / (dailyReturns.length || 1));\n  const sharpe = stdReturn > 0 ? (avgReturn * 252) / (stdReturn * Math.sqrt(252)) : 0;\n  const negativeReturns = dailyReturns.filter(r => r < 0);\n  const downstdReturn = Math.sqrt(negativeReturns.reduce((sum, r) => sum + r * r, 0) / (negativeReturns.length || 1));\n  const sortino = downstdReturn > 0 ? (avgReturn * 252) / (downstdReturn * Math.sqrt(252)) : 0;\n  const years = tradingDays.length / 252;\n  const cagr = Math.pow(1 + totalReturn, 1 / years) - 1;\n  const calmar = maxDrawdown > 0 ? cagr / maxDrawdown : 0;\n  const winRate = trades.length > 0 ? trades.filter(t => t.pnl > 0).length / trades.length : 0;\n\n  return",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-hyperoptimizer.ts",
        "start": 651,
        "end": 673,
        "startLoc": {
          "line": 651,
          "column": 2,
          "position": 10280
        },
        "endLoc": {
          "line": 673,
          "column": 7,
          "position": 10794
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer.ts",
        "start": 474,
        "end": 496,
        "startLoc": {
          "line": 474,
          "column": 7,
          "position": 6211
        },
        "endLoc": {
          "line": 496,
          "column": 30,
          "position": 6725
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": ");\n\n  const start = startDate.toISOString().split('T')[0];\n  const end = endDate.toISOString().split('T')[0];\n\n  console.log(`\\nLoading historical data for ${SYMBOLS.length} symbols...`);\n  console.log(`Period: ${start} to ${end}`);\n\n  let loaded = 0;\n  for (const symbol of SYMBOLS) {\n    try {\n      const symbolBars = await fetchAlpacaBars(symbol, start, end);\n      if (symbolBars.length > 100) {\n        bars.set(symbol, symbolBars);\n        loaded++;\n      }\n      // Rate limit",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-hyperoptimizer.ts",
        "start": 748,
        "end": 764,
        "startLoc": {
          "line": 748,
          "column": 2,
          "position": 12018
        },
        "endLoc": {
          "line": 764,
          "column": 14,
          "position": 12187
        }
      },
      "secondFile": {
        "name": "scripts/omar-threshold-optimizer-fast.ts",
        "start": 536,
        "end": 543,
        "startLoc": {
          "line": 536,
          "column": 2,
          "position": 7188
        },
        "endLoc": {
          "line": 543,
          "column": 6,
          "position": 7330
        }
      }
    },
    {
      "format": "typescript",
      "lines": 27,
      "fragment": "interface BacktestConfig {\n  symbols: string[];\n  startDate: string;\n  endDate: string;\n  initialCapital: number;\n  maxPositionPct: number;\n  stopLossPct: number;\n  takeProfitPct: number;\n\n  // Technical Analysis Parameters\n  rsiPeriod: number;\n  rsiOversold: number;\n  rsiOverbought: number;\n  smaPeriod: number;\n  emaPeriodFast: number;\n  emaPeriodSlow: number;\n  atrPeriod: number;\n  atrMultiplierStop: number;\n  atrMultiplierTarget: number;\n\n  // Signal Thresholds\n  buyThreshold: number;\n  sellThreshold: number;\n  confidenceMinimum: number;\n}\n\ninterface",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-backtest.ts",
        "start": 16,
        "end": 42,
        "startLoc": {
          "line": 16,
          "column": 1,
          "position": 10
        },
        "endLoc": {
          "line": 42,
          "column": 10,
          "position": 162
        }
      },
      "secondFile": {
        "name": "scripts/shared/types.ts",
        "start": 25,
        "end": 51,
        "startLoc": {
          "line": 25,
          "column": 2,
          "position": 102
        },
        "endLoc": {
          "line": 51,
          "column": 7,
          "position": 254
        }
      }
    },
    {
      "format": "typescript",
      "lines": 23,
      "fragment": "}/stocks/${symbol}/bars?${params}`;\n\n    const response = await fetch(url, {\n      headers: {\n        \"APCA-API-KEY-ID\": apiKey,\n        \"APCA-API-SECRET-KEY\": secretKey,\n      },\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      console.error(`Error fetching ${symbol}: ${response.status} - ${error}`);\n      break;\n    }\n\n    const data = await response.json();\n    if (data.bars) {\n      bars.push(...data.bars);\n    }\n    pageToken = data.next_page_token;\n\n    // Rate limiting\n    await",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-backtest.ts",
        "start": 135,
        "end": 157,
        "startLoc": {
          "line": 135,
          "column": 16,
          "position": 842
        },
        "endLoc": {
          "line": 157,
          "column": 6,
          "position": 1017
        }
      },
      "secondFile": {
        "name": "scripts/shared/alpaca-api.ts",
        "start": 55,
        "end": 77,
        "startLoc": {
          "line": 55,
          "column": 16,
          "position": 347
        },
        "endLoc": {
          "line": 77,
          "column": 3,
          "position": 522
        }
      }
    },
    {
      "format": "typescript",
      "lines": 98,
      "fragment": "bbUpper[index];\n\n  if (currentRSI === null || currentSMA === null || currentATR === null) {\n    return { signal: \"hold\", confidence: 0, reasoning: [\"Insufficient data\"] };\n  }\n\n  let bullishScore = 0;\n  let bearishScore = 0;\n  const reasoning: string[] = [];\n\n  // RSI Analysis (weight: 20)\n  if (currentRSI < config.rsiOversold) {\n    bullishScore += 20;\n    reasoning.push(`RSI oversold: ${currentRSI.toFixed(1)}`);\n  } else if (currentRSI > config.rsiOverbought) {\n    bearishScore += 20;\n    reasoning.push(`RSI overbought: ${currentRSI.toFixed(1)}`);\n  } else if (currentRSI < 45) {\n    bullishScore += 8;\n  } else if (currentRSI > 55) {\n    bearishScore += 8;\n  }\n\n  // Price vs SMA (weight: 15)\n  if (currentPrice > currentSMA * 1.02) {\n    bullishScore += 15;\n    reasoning.push(`Price above SMA${config.smaPeriod}`);\n  } else if (currentPrice < currentSMA * 0.98) {\n    bearishScore += 15;\n    reasoning.push(`Price below SMA${config.smaPeriod}`);\n  }\n\n  // EMA Crossover (weight: 15)\n  if (currentEMAFast !== null && currentEMASlow !== null) {\n    if (currentEMAFast > currentEMASlow) {\n      bullishScore += 15;\n      reasoning.push(\"EMA bullish alignment\");\n    } else {\n      bearishScore += 15;\n    }\n  }\n\n  // Stochastic (weight: 12)\n  if (currentStochK !== null) {\n    if (currentStochK < 20) {\n      bullishScore += 12;\n      reasoning.push(`Stochastic oversold: ${currentStochK.toFixed(1)}`);\n    } else if (currentStochK > 80) {\n      bearishScore += 12;\n      reasoning.push(`Stochastic overbought: ${currentStochK.toFixed(1)}`);\n    }\n  }\n\n  // MACD Histogram (weight: 12)\n  if (currentMACDHist !== null) {\n    if (currentMACDHist > 0) {\n      bullishScore += 12;\n      reasoning.push(\"MACD positive\");\n    } else {\n      bearishScore += 12;\n    }\n  }\n\n  // Bollinger Bands (weight: 10)\n  if (currentBBLower !== null && currentBBUpper !== null) {\n    if (currentPrice < currentBBLower) {\n      bullishScore += 10;\n      reasoning.push(\"Price at lower Bollinger\");\n    } else if (currentPrice > currentBBUpper) {\n      bearishScore += 10;\n      reasoning.push(\"Price at upper Bollinger\");\n    }\n  }\n\n  // Momentum (weight: 8)\n  if (index > 5) {\n    const momentum5d = ((currentPrice - prices[index - 5]) / prices[index - 5]) * 100;\n    if (momentum5d > 3) {\n      bullishScore += 8;\n      reasoning.push(`5d momentum: +${momentum5d.toFixed(1)}%`);\n    } else if (momentum5d < -3) {\n      bearishScore += 8;\n      reasoning.push(`5d momentum: ${momentum5d.toFixed(1)}%`);\n    }\n  }\n\n  // Volatility adjustment\n  const atrPct = (currentATR / currentPrice) * 100;\n  if (atrPct > 4) {\n    bearishScore += 8;\n  }\n\n  const totalScore = bullishScore + bearishScore;\n  const netScore = bullishScore - bearishScore;\n  const normalizedScore = totalScore > 0 ? netScore / totalScore : 0;\n\n  const signalStrength = Math.abs(normalizedScore);\n  let confidence = 0.35 + (",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-backtest.ts",
        "start": 362,
        "end": 459,
        "startLoc": {
          "line": 362,
          "column": 2,
          "position": 4035
        },
        "endLoc": {
          "line": 459,
          "column": 2,
          "position": 4992
        }
      },
      "secondFile": {
        "name": "scripts/shared/backtest-engine.ts",
        "start": 121,
        "end": 218,
        "startLoc": {
          "line": 121,
          "column": 2,
          "position": 956
        },
        "endLoc": {
          "line": 218,
          "column": 15,
          "position": 1913
        }
      }
    },
    {
      "format": "typescript",
      "lines": 37,
      "fragment": ");\n\n      const positionKey = symbol;\n      const existingPosition = openPositions.get(positionKey);\n\n      if (existingPosition) {\n        const dayLow = lows[i];\n        const dayHigh = highs[i];\n\n        let exitPrice: number | undefined;\n        let exitReason: Trade[\"exitReason\"];\n\n        if (dayLow <= existingPosition.stopLoss) {\n          exitPrice = existingPosition.stopLoss;\n          exitReason = \"stop_loss\";\n        } else if (dayHigh >= existingPosition.takeProfit) {\n          exitPrice = existingPosition.takeProfit;\n          exitReason = \"take_profit\";\n        } else if (signalResult.signal === \"sell\" && existingPosition.side === \"buy\") {\n          exitPrice = currentPrice;\n          exitReason = \"signal\";\n        }\n\n        if (exitPrice) {\n          existingPosition.exitDate = currentDate;\n          existingPosition.exitPrice = exitPrice;\n          existingPosition.exitReason = exitReason;\n          existingPosition.pnl = (exitPrice - existingPosition.entryPrice) * existingPosition.quantity;\n          existingPosition.pnlPct = ((exitPrice - existingPosition.entryPrice) / existingPosition.entryPrice) * 100;\n          existingPosition.holdingDays = Math.round(\n            (new Date(currentDate).getTime() - new Date(existingPosition.entryDate).getTime()) / (1000 * 60 * 60 * 24)\n          );\n\n          equity += existingPosition.pnl;\n          trades.push({ ...existingPosition });\n          openPositions.delete(positionKey);\n        }",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-backtest.ts",
        "start": 541,
        "end": 577,
        "startLoc": {
          "line": 541,
          "column": 7,
          "position": 5995
        },
        "endLoc": {
          "line": 577,
          "column": 2,
          "position": 6397
        }
      },
      "secondFile": {
        "name": "scripts/shared/backtest-engine.ts",
        "start": 293,
        "end": 333,
        "startLoc": {
          "line": 293,
          "column": 7,
          "position": 2648
        },
        "endLoc": {
          "line": 333,
          "column": 3,
          "position": 3054
        }
      }
    },
    {
      "format": "typescript",
      "lines": 72,
      "fragment": "const parameterSets: Partial<BacktestConfig>[] = [\n  // Iteration 1: Conservative baseline\n  {\n    rsiPeriod: 14,\n    rsiOversold: 30,\n    rsiOverbought: 70,\n    smaPeriod: 20,\n    emaPeriodFast: 12,\n    emaPeriodSlow: 26,\n    atrPeriod: 14,\n    atrMultiplierStop: 2.0,\n    atrMultiplierTarget: 3.0,\n    buyThreshold: 0.3,\n    sellThreshold: 0.3,\n    confidenceMinimum: 0.5,\n    maxPositionPct: 0.05,\n    stopLossPct: 0.03,\n    takeProfitPct: 0.06\n  },\n  // Iteration 2: Aggressive momentum\n  {\n    rsiPeriod: 10,\n    rsiOversold: 25,\n    rsiOverbought: 75,\n    smaPeriod: 10,\n    emaPeriodFast: 8,\n    emaPeriodSlow: 21,\n    atrPeriod: 10,\n    atrMultiplierStop: 1.5,\n    atrMultiplierTarget: 4.0,\n    buyThreshold: 0.2,\n    sellThreshold: 0.2,\n    confidenceMinimum: 0.45,\n    maxPositionPct: 0.08,\n    stopLossPct: 0.04,\n    takeProfitPct: 0.08\n  },\n  // Iteration 3: Tight stops\n  {\n    rsiPeriod: 14,\n    rsiOversold: 35,\n    rsiOverbought: 65,\n    smaPeriod: 20,\n    emaPeriodFast: 12,\n    emaPeriodSlow: 26,\n    atrPeriod: 14,\n    atrMultiplierStop: 1.2,\n    atrMultiplierTarget: 2.5,\n    buyThreshold: 0.25,\n    sellThreshold: 0.25,\n    confidenceMinimum: 0.55,\n    maxPositionPct: 0.06,\n    stopLossPct: 0.02,\n    takeProfitPct: 0.05\n  },\n  // Iteration 4: Wide targets\n  {\n    rsiPeriod: 21,\n    rsiOversold: 30,\n    rsiOverbought: 70,\n    smaPeriod: 50,\n    emaPeriodFast: 12,\n    emaPeriodSlow: 26,\n    atrPeriod: 20,\n    atrMultiplierStop: 2.5,\n    atrMultiplierTarget: 5.0,\n    buyThreshold: 0.35,\n    sellThreshold: 0.35,\n    confidenceMinimum: 0.6,\n    maxPositionPct: 0.05,\n    stopLossPct: 0.05,\n    takeProfitPct: 0.1",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-backtest-v2.ts",
        "start": 24,
        "end": 95,
        "startLoc": {
          "line": 24,
          "column": 1,
          "position": 72
        },
        "endLoc": {
          "line": 95,
          "column": 4,
          "position": 538
        }
      },
      "secondFile": {
        "name": "scripts/omar-backtest.ts",
        "start": 699,
        "end": 707,
        "startLoc": {
          "line": 699,
          "column": 3,
          "position": 8123
        },
        "endLoc": {
          "line": 707,
          "column": 5,
          "position": 8526
        }
      }
    },
    {
      "format": "typescript",
      "lines": 38,
      "fragment": "},\n  // Iteration 5: High confidence only\n  {\n    rsiPeriod: 14,\n    rsiOversold: 28,\n    rsiOverbought: 72,\n    smaPeriod: 20,\n    emaPeriodFast: 9,\n    emaPeriodSlow: 21,\n    atrPeriod: 14,\n    atrMultiplierStop: 2.0,\n    atrMultiplierTarget: 3.5,\n    buyThreshold: 0.4,\n    sellThreshold: 0.4,\n    confidenceMinimum: 0.65,\n    maxPositionPct: 0.07,\n    stopLossPct: 0.03,\n    takeProfitPct: 0.07\n  },\n  // Iteration 6: Balanced optimized\n  {\n    rsiPeriod: 12,\n    rsiOversold: 32,\n    rsiOverbought: 68,\n    smaPeriod: 15,\n    emaPeriodFast: 10,\n    emaPeriodSlow: 24,\n    atrPeriod: 12,\n    atrMultiplierStop: 1.8,\n    atrMultiplierTarget: 3.2,\n    buyThreshold: 0.28,\n    sellThreshold: 0.28,\n    confidenceMinimum: 0.52,\n    maxPositionPct: 0.065,\n    stopLossPct: 0.028,\n    takeProfitPct: 0.065\n  }\n]",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-backtest-v2.ts",
        "start": 96,
        "end": 133,
        "startLoc": {
          "line": 96,
          "column": 3,
          "position": 541
        },
        "endLoc": {
          "line": 133,
          "column": 2,
          "position": 771
        }
      },
      "secondFile": {
        "name": "scripts/omar-backtest.ts",
        "start": 707,
        "end": 711,
        "startLoc": {
          "line": 707,
          "column": 2,
          "position": 8528
        },
        "endLoc": {
          "line": 711,
          "column": 2,
          "position": 8725
        }
      }
    },
    {
      "format": "typescript",
      "lines": 41,
      "fragment": "};\n\n    console.log(`\\n${\"=\".repeat(60)}`);\n    console.log(`ITERATION ${i + 1}`);\n    console.log(`${\"=\".repeat(60)}`);\n\n    const result = runBacktest(dataMap, config);\n    const score = calculateScore(result.metrics);\n\n    results.push({\n      iteration: i + 1,\n      config,\n      metrics: result.metrics,\n      score,\n      sampleTrades: result.sampleTrades\n    });\n\n    console.log(`Trades: ${result.metrics.totalTrades} | Win Rate: ${result.metrics.winRate.toFixed(1)}%`);\n    console.log(`P&L: $${result.metrics.totalPnl.toFixed(0)} (${result.metrics.totalPnlPct.toFixed(1)}%)`);\n    console.log(`Profit Factor: ${result.metrics.profitFactor.toFixed(2)} | Sharpe: ${result.metrics.sharpeRatio.toFixed(2)}`);\n    console.log(`Max DD: ${result.metrics.maxDrawdown.toFixed(1)}% | CAGR: ${result.metrics.cagr.toFixed(1)}%`);\n    console.log(`Score: ${score.toFixed(2)}`);\n  }\n\n  results.sort((a, b) => b.score - a.score);\n  const best = results[0];\n\n  console.log(`\\n${\"=\".repeat(80)}`);\n  console.log(\"OPTIMIZATION COMPLETE - BEST RESULT\");\n  console.log(`${\"=\".repeat(80)}`);\n  console.log(`Iteration: ${best.iteration}`);\n  console.log(`Score: ${best.score.toFixed(2)}`);\n  console.log(`\\nMetrics:`);\n  console.log(JSON.stringify(best.metrics, null, 2));\n  console.log(`\\nConfig:`);\n  console.log(JSON.stringify(best.config, null, 2));\n\n  console.log(`\\nSample Trades:`);\n  best.sampleTrades.slice(0, 5).forEach((t, i) => {\n    console.log(\n      `  ${i ",
      "tokens": 0,
      "firstFile": {
        "name": "scripts/omar-backtest-v2.ts",
        "start": 188,
        "end": 228,
        "startLoc": {
          "line": 188,
          "column": 5,
          "position": 1330
        },
        "endLoc": {
          "line": 228,
          "column": 3,
          "position": 1852
        }
      },
      "secondFile": {
        "name": "scripts/omar-backtest.ts",
        "start": 736,
        "end": 769,
        "startLoc": {
          "line": 736,
          "column": 5,
          "position": 9057
        },
        "endLoc": {
          "line": 769,
          "column": 2,
          "position": 9571
        }
      }
    },
    {
      "format": "typescript",
      "lines": 18,
      "fragment": "});\n  }\n\n  return {\n    onBar(\n      bar: HistoricalBar,\n      barIndex: number,\n      allBarsUpToNow: HistoricalBar[]\n    ): StrategySignal[] {\n      const signals: StrategySignal[] = [];\n      const symbol = bar.symbol;\n\n      let symbolState = state.get(symbol);\n      if (!symbolState) {\n        symbolState = {\n          prices: [],\n          position: \"none\",\n          positionQty: 0,",
      "tokens": 0,
      "firstFile": {
        "name": "server/services/backtesting/strategies.ts",
        "start": 125,
        "end": 142,
        "startLoc": {
          "line": 125,
          "column": 5,
          "position": 1153
        },
        "endLoc": {
          "line": 142,
          "column": 2,
          "position": 1283
        }
      },
      "secondFile": {
        "name": "server/services/backtesting/strategies.ts",
        "start": 33,
        "end": 47,
        "startLoc": {
          "line": 33,
          "column": 2,
          "position": 258
        },
        "endLoc": {
          "line": 47,
          "column": 2,
          "position": 386
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": ");\n\n    let targetSymbols: string[];\n    if (symbols && symbols.length > 0) {\n      targetSymbols = symbols;\n    } else {\n      const assets = await db\n        .select({ symbol: universeAssets.symbol })\n        .from(universeAssets)\n        .where(\n          and(\n            eq(universeAssets.tradable, true),\n            eq(universeAssets.excluded, false)\n          )\n        );\n      targetSymbols = assets.map((a) => a.symbol);\n    }\n\n    log.info(\"FundamentalsService\"",
      "tokens": 0,
      "firstFile": {
        "name": "server/universe/fundamentalsService.ts",
        "start": 123,
        "end": 141,
        "startLoc": {
          "line": 123,
          "column": 2,
          "position": 1202
        },
        "endLoc": {
          "line": 141,
          "column": 22,
          "position": 1354
        }
      },
      "secondFile": {
        "name": "server/universe/liquidityService.ts",
        "start": 107,
        "end": 125,
        "startLoc": {
          "line": 107,
          "column": 2,
          "position": 775
        },
        "endLoc": {
          "line": 125,
          "column": 19,
          "position": 927
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": ", { traceId });\n\n    let targetSymbols: string[];\n    if (symbols && symbols.length > 0) {\n      targetSymbols = symbols;\n    } else {\n      const assets = await db\n        .select({ symbol: universeAssets.symbol })\n        .from(universeAssets)\n        .where(\n          and(\n            eq(universeAssets.tradable, true),\n            eq(universeAssets.excluded, false)\n          )\n        );\n      targetSymbols = assets.map((a) => a.symbol);\n    }\n\n    let",
      "tokens": 0,
      "firstFile": {
        "name": "server/universe/asset-classifier.ts",
        "start": 424,
        "end": 442,
        "startLoc": {
          "line": 424,
          "column": 32,
          "position": 3698
        },
        "endLoc": {
          "line": 442,
          "column": 4,
          "position": 3853
        }
      },
      "secondFile": {
        "name": "server/universe/fundamentalsService.ts",
        "start": 123,
        "end": 125,
        "startLoc": {
          "line": 123,
          "column": 30,
          "position": 1195
        },
        "endLoc": {
          "line": 125,
          "column": 4,
          "position": 923
        }
      }
    },
    {
      "format": "typescript",
      "lines": 26,
      "fragment": "private async updateAgentStats(): Promise<void> {\n    try {\n      const trades = await storage.getTrades(undefined, 1000);\n      const closingTrades = trades.filter(\n        (t) => t.pnl !== null && t.pnl !== \"0\"\n      );\n      const totalRealizedPnl = closingTrades.reduce(\n        (sum, t) => sum + safeParseFloat(t.pnl, 0),\n        0\n      );\n      const winningTrades = closingTrades.filter(\n        (t) => safeParseFloat(t.pnl, 0) > 0\n      );\n      const winRate =\n        closingTrades.length > 0\n          ? (winningTrades.length / closingTrades.length) * 100\n          : 0;\n\n      await storage.updateAgentStatus({\n        totalTrades: trades.length,\n        totalPnl: totalRealizedPnl.toString(),\n        winRate: winRate.toString(),\n        lastHeartbeat: new Date(),\n      });\n    } catch (error) {\n      log.error(\"OrderExecutor\"",
      "tokens": 0,
      "firstFile": {
        "name": "server/trading/order-executor.ts",
        "start": 597,
        "end": 622,
        "startLoc": {
          "line": 597,
          "column": 3,
          "position": 3038
        },
        "endLoc": {
          "line": 622,
          "column": 16,
          "position": 3315
        }
      },
      "secondFile": {
        "name": "server/trading/position-manager.ts",
        "start": 779,
        "end": 804,
        "startLoc": {
          "line": 779,
          "column": 3,
          "position": 4433
        },
        "endLoc": {
          "line": 804,
          "column": 18,
          "position": 4710
        }
      }
    },
    {
      "format": "typescript",
      "lines": 27,
      "fragment": "order: {\n    id: string;\n    client_order_id: string;\n    created_at: string;\n    updated_at: string;\n    submitted_at: string;\n    filled_at: string | null;\n    expired_at: string | null;\n    canceled_at: string | null;\n    failed_at: string | null;\n    asset_id: string;\n    symbol: string;\n    asset_class: string;\n    notional: string | null;\n    qty: string;\n    filled_qty: string;\n    filled_avg_price: string | null;\n    order_class: string;\n    order_type: string;\n    type: string;\n    side: string;\n    time_in_force: string;\n    limit_price: string | null;\n    stop_price: string | null;\n    status: string;\n    extended_hours: boolean;\n  };",
      "tokens": 0,
      "firstFile": {
        "name": "server/trading/alpaca-stream.ts",
        "start": 17,
        "end": 43,
        "startLoc": {
          "line": 17,
          "column": 3,
          "position": 143
        },
        "endLoc": {
          "line": 43,
          "column": 2,
          "position": 357
        }
      },
      "secondFile": {
        "name": "server/utils/numeric.ts",
        "start": 260,
        "end": 286,
        "startLoc": {
          "line": 260,
          "column": 2,
          "position": 2106
        },
        "endLoc": {
          "line": 286,
          "column": 2,
          "position": 2319
        }
      }
    },
    {
      "format": "typescript",
      "lines": 32,
      "fragment": "normalizeCryptoSymbol(symbol: string): string {\n    const upperSymbol = symbol.toUpperCase();\n    if (upperSymbol.includes(\"/\")) {\n      return upperSymbol;\n    }\n    if (upperSymbol === \"BTCUSD\") return \"BTC/USD\";\n    if (upperSymbol === \"ETHUSD\") return \"ETH/USD\";\n    if (upperSymbol === \"SOLUSD\") return \"SOL/USD\";\n    if (upperSymbol.endsWith(\"USD\") && upperSymbol.length > 3) {\n      const base = upperSymbol.slice(0, -3);\n      return `${base}/USD`;\n    }\n    return upperSymbol;\n  }\n\n  /**\n   * Check if a symbol is a crypto symbol\n   *\n   * Determines if a symbol represents a cryptocurrency pair based on known\n   * crypto pairs and slash format detection.\n   *\n   * @private\n   * @param symbol - Symbol to check\n   * @returns True if symbol is a cryptocurrency pair\n   *\n   * @example\n   * ```typescript\n   * isCryptoSymbol(\"BTC/USD\") // returns true\n   * isCryptoSymbol(\"BTCUSD\") // returns true\n   * isCryptoSymbol(\"AAPL\") // returns false\n   * ```\n   */",
      "tokens": 0,
      "firstFile": {
        "name": "server/trading/ai-analyzer.ts",
        "start": 105,
        "end": 136,
        "startLoc": {
          "line": 105,
          "column": 2,
          "position": 214
        },
        "endLoc": {
          "line": 136,
          "column": 6,
          "position": 379
        }
      },
      "secondFile": {
        "name": "server/trading/symbol-normalizer.ts",
        "start": 147,
        "end": 175,
        "startLoc": {
          "line": 147,
          "column": 2,
          "position": 352
        },
        "endLoc": {
          "line": 175,
          "column": 4,
          "position": 515
        }
      }
    },
    {
      "format": "typescript",
      "lines": 57,
      "fragment": "isCryptoSymbol(symbol: string): boolean {\n    const upperSymbol = symbol.toUpperCase();\n    // Common crypto pairs on Alpaca\n    const cryptoPairs = [\n      \"BTC/USD\",\n      \"ETH/USD\",\n      \"SOL/USD\",\n      \"DOGE/USD\",\n      \"SHIB/USD\",\n      \"AVAX/USD\",\n      \"DOT/USD\",\n      \"LINK/USD\",\n      \"UNI/USD\",\n      \"AAVE/USD\",\n      \"LTC/USD\",\n      \"BCH/USD\",\n      \"BTCUSD\",\n      \"ETHUSD\",\n      \"SOLUSD\",\n      \"DOGEUSD\",\n      \"SHIBUSD\",\n      \"AVAXUSD\",\n      \"DOTUSD\",\n      \"LINKUSD\",\n      \"UNIUSD\",\n      \"AAVEUSD\",\n      \"LTCUSD\",\n      \"BCHUSD\",\n    ];\n    // Check if it's a known crypto pair or contains a slash (crypto format)\n    return (\n      cryptoPairs.includes(upperSymbol) ||\n      (symbol.includes(\"/\") && upperSymbol.endsWith(\"USD\"))\n    );\n  }\n\n  /**\n   * Normalize symbol for Alpaca API calls\n   *\n   * Handles different symbol format requirements for crypto vs stocks\n   * and for orders vs lookups.\n   *\n   * @private\n   * @param symbol - Symbol to normalize\n   * @param forOrder - If true, use format required for orders (default: false)\n   * @returns Normalized symbol for Alpaca API\n   *\n   * @example\n   * ```typescript\n   * // For crypto orders - use slash format\n   * normalizeSymbolForAlpaca(\"BTC/USD\", true) // returns \"BTC/USD\"\n   *\n   * // For stock lookups - remove slashes\n   * normalizeSymbolForAlpaca(\"AAPL\", false) // returns \"AAPL\"\n   * normalizeSymbolForAlpaca(\"BTC/USD\", false) // returns \"BTCUSD\"\n   * ```\n   */",
      "tokens": 0,
      "firstFile": {
        "name": "server/trading/ai-analyzer.ts",
        "start": 137,
        "end": 193,
        "startLoc": {
          "line": 137,
          "column": 2,
          "position": 384
        },
        "endLoc": {
          "line": 193,
          "column": 6,
          "position": 569
        }
      },
      "secondFile": {
        "name": "server/trading/symbol-normalizer.ts",
        "start": 54,
        "end": 112,
        "startLoc": {
          "line": 54,
          "column": 2,
          "position": 75
        },
        "endLoc": {
          "line": 112,
          "column": 4,
          "position": 258
        }
      }
    },
    {
      "format": "typescript",
      "lines": 46,
      "fragment": ",\n  parameterBounds: PARAMETER_BOUNDS,\n  supportedSymbols: [\n    \"AAPL\",\n    \"MSFT\",\n    \"GOOGL\",\n    \"AMZN\",\n    \"NVDA\",\n    \"META\",\n    \"TSLA\",\n    \"JPM\",\n    \"V\",\n    \"UNH\",\n    \"JNJ\",\n    \"WMT\",\n    \"PG\",\n    \"MA\",\n    \"HD\",\n    \"CVX\",\n    \"ABBV\",\n    \"MRK\",\n    \"KO\",\n    \"PEP\",\n    \"COST\",\n    \"TMO\",\n    \"AVGO\",\n    \"ORCL\",\n    \"ACN\",\n    \"MCD\",\n    \"CSCO\",\n    \"ABT\",\n    \"AMD\",\n    \"INTC\",\n    \"IBM\",\n    \"CRM\",\n    \"NFLX\",\n    \"ADBE\",\n    \"PYPL\",\n    \"DIS\",\n    \"BTC/USD\",\n    \"ETH/USD\",\n    \"SOL/USD\",\n  ],\n};\n\nexport function normalizeMomentumConfig",
      "tokens": 0,
      "firstFile": {
        "name": "server/strategies/momentum-strategy.ts",
        "start": 92,
        "end": 137,
        "startLoc": {
          "line": 92,
          "column": 17,
          "position": 725
        },
        "endLoc": {
          "line": 137,
          "column": 24,
          "position": 908
        }
      },
      "secondFile": {
        "name": "server/strategies/moving-average-crossover.ts",
        "start": 83,
        "end": 128,
        "startLoc": {
          "line": 83,
          "column": 23,
          "position": 640
        },
        "endLoc": {
          "line": 128,
          "column": 29,
          "position": 823
        }
      }
    },
    {
      "format": "typescript",
      "lines": 25,
      "fragment": ";\n\n  const now = new Date();\n  const from = new Date(now.getTime() - lookbackDays * 24 * 60 * 60 * 1000);\n\n  let bars: AlpacaBar[];\n  try {\n    const response = await alpaca.getBars(\n      [normalizedConfig.symbol],\n      \"1Day\",\n      from.toISOString(),\n      now.toISOString(),\n      lookbackDays + 50\n    );\n    bars = response.bars[normalizedConfig.symbol] || [];\n  } catch (error) {\n    throw new Error(\n      `Failed to fetch historical data for ${normalizedConfig.symbol}: ${(error as Error).message}`\n    );\n  }\n\n  if (\n    !bars ||\n    bars.length <\n      Math",
      "tokens": 0,
      "firstFile": {
        "name": "server/strategies/momentum-strategy.ts",
        "start": 285,
        "end": 309,
        "startLoc": {
          "line": 285,
          "column": 2,
          "position": 2305
        },
        "endLoc": {
          "line": 309,
          "column": 5,
          "position": 2516
        }
      },
      "secondFile": {
        "name": "server/strategies/moving-average-crossover.ts",
        "start": 301,
        "end": 322,
        "startLoc": {
          "line": 301,
          "column": 7,
          "position": 2472
        },
        "endLoc": {
          "line": 322,
          "column": 17,
          "position": 2679
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": "&& position) {\n      const exitPrice = price;\n      const pnlPct =\n        ((exitPrice - position.entryPrice) / position.entryPrice) * 100;\n      const entryDate = new Date(timestamps[position.entryIndex] * 1000)\n        .toISOString()\n        .split(\"T\")[0];\n\n      trades.push({\n        entryDate,\n        exitDate: date,\n        entryPrice: position.entryPrice,\n        exitPrice,\n        pnlPct,\n        side: \"long\",\n        entryMomentum",
      "tokens": 0,
      "firstFile": {
        "name": "server/strategies/momentum-strategy.ts",
        "start": 376,
        "end": 391,
        "startLoc": {
          "line": 376,
          "column": 2,
          "position": 3244
        },
        "endLoc": {
          "line": 391,
          "column": 14,
          "position": 3376
        }
      },
      "secondFile": {
        "name": "server/strategies/moving-average-crossover.ts",
        "start": 355,
        "end": 370,
        "startLoc": {
          "line": 355,
          "column": 2,
          "position": 3092
        },
        "endLoc": {
          "line": 370,
          "column": 2,
          "position": 3224
        }
      }
    },
    {
      "format": "typescript",
      "lines": 26,
      "fragment": ",\n      });\n\n      position = null;\n    }\n  }\n\n  if (position && closePrices.length > position.entryIndex) {\n    const exitPrice = closePrices[closePrices.length - 1];\n    const pnlPct =\n      ((exitPrice - position.entryPrice) / position.entryPrice) * 100;\n    const entryDate = new Date(timestamps[position.entryIndex] * 1000)\n      .toISOString()\n      .split(\"T\")[0];\n    const exitDate = new Date(timestamps[timestamps.length - 1] * 1000)\n      .toISOString()\n      .split(\"T\")[0];\n\n    trades.push({\n      entryDate,\n      exitDate,\n      entryPrice: position.entryPrice,\n      exitPrice,\n      pnlPct,\n      side: \"long\",\n      entryMomentum",
      "tokens": 0,
      "firstFile": {
        "name": "server/strategies/momentum-strategy.ts",
        "start": 392,
        "end": 417,
        "startLoc": {
          "line": 392,
          "column": 9,
          "position": 3391
        },
        "endLoc": {
          "line": 417,
          "column": 14,
          "position": 3610
        }
      },
      "secondFile": {
        "name": "server/strategies/moving-average-crossover.ts",
        "start": 369,
        "end": 394,
        "startLoc": {
          "line": 369,
          "column": 7,
          "position": 3221
        },
        "endLoc": {
          "line": 394,
          "column": 2,
          "position": 3440
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": ",\n    });\n  }\n\n  const equityCurve: Array<{ date: string; value: number }> = [];\n  let equity = 10000;\n  let inPosition = false;\n  let entryEquity = equity;\n  let entryPrice = 0;\n  let maxEquity = equity;\n  let maxDrawdown = 0;\n  const dailyReturns: number[] = [];\n  let prevEquity = equity;\n\n  for (let i = 0; i < closePrices.length; i++) {\n    const date = new Date(timestamps[i] * 1000).toISOString().split(\"T\")[0];\n    const price = closePrices[i];\n\n    const signal",
      "tokens": 0,
      "firstFile": {
        "name": "server/strategies/momentum-strategy.ts",
        "start": 418,
        "end": 436,
        "startLoc": {
          "line": 418,
          "column": 9,
          "position": 3625
        },
        "endLoc": {
          "line": 436,
          "column": 7,
          "position": 3832
        }
      },
      "secondFile": {
        "name": "server/strategies/moving-average-crossover.ts",
        "start": 393,
        "end": 411,
        "startLoc": {
          "line": 393,
          "column": 7,
          "position": 3437
        },
        "endLoc": {
          "line": 411,
          "column": 10,
          "position": 3644
        }
      }
    },
    {
      "format": "typescript",
      "lines": 62,
      "fragment": ");\n      equity = currentEquity;\n    }\n\n    equityCurve.push({ date, value: Math.round(equity * 100) / 100 });\n\n    if (equity > maxEquity) maxEquity = equity;\n    const drawdown = ((maxEquity - equity) / maxEquity) * 100;\n    if (drawdown > maxDrawdown) maxDrawdown = drawdown;\n\n    if (i > 0) {\n      const dailyReturn = (equity - prevEquity) / prevEquity;\n      dailyReturns.push(dailyReturn);\n    }\n    prevEquity = equity;\n  }\n\n  const totalReturnPct = ((equity - 10000) / 10000) * 100;\n  const tradingDays = closePrices.length;\n  const yearsTraded = tradingDays / 252;\n  const annualReturnPct =\n    yearsTraded > 0\n      ? (Math.pow(1 + totalReturnPct / 100, 1 / yearsTraded) - 1) * 100\n      : 0;\n\n  const avgReturn = dailyReturns.length > 0 ? mean(dailyReturns).toNumber() : 0;\n  const returnVariance =\n    dailyReturns.length > 0 ? variance(dailyReturns).toNumber() : 0;\n  const stdDev = Math.sqrt(returnVariance);\n  const sharpeRatioValue =\n    dailyReturns.length > 0\n      ? calcSharpeRatio(dailyReturns, 0, 252).toNumber()\n      : 0;\n\n  const negativeReturns = dailyReturns.filter((r) => r < 0);\n  const downsideVariance =\n    negativeReturns.length > 0 ? variance(negativeReturns).toNumber() : 0;\n  const downsideStdDev = Math.sqrt(downsideVariance);\n  const sortinoRatio =\n    downsideStdDev > 0 ? (avgReturn / downsideStdDev) * Math.sqrt(252) : 0;\n\n  const winningTrades = trades.filter((t) => t.pnlPct > 0);\n  const losingTrades = trades.filter((t) => t.pnlPct <= 0);\n  const winRatePct =\n    trades.length > 0 ? (winningTrades.length / trades.length) * 100 : 0;\n  const avgWinPct =\n    winningTrades.length > 0\n      ? winningTrades.reduce((sum, t) => sum + t.pnlPct, 0) /\n        winningTrades.length\n      : 0;\n  const avgLossPct =\n    losingTrades.length > 0\n      ? losingTrades.reduce((sum, t) => sum + t.pnlPct, 0) / losingTrades.length\n      : 0;\n  const grossProfit = winningTrades.reduce((sum, t) => sum + t.pnlPct, 0);\n  const grossLoss = Math.abs(\n    losingTrades.reduce((sum, t) => sum + t.pnlPct, 0)\n  );\n  const profitFactor =\n    grossLoss > 0 ? grossProfit / grossLoss : grossProfit > 0 ? Infinity : 0;\n\n  const",
      "tokens": 0,
      "firstFile": {
        "name": "server/strategies/momentum-strategy.ts",
        "start": 449,
        "end": 510,
        "startLoc": {
          "line": 449,
          "column": 14,
          "position": 4035
        },
        "endLoc": {
          "line": 510,
          "column": 6,
          "position": 4863
        }
      },
      "secondFile": {
        "name": "server/strategies/moving-average-crossover.ts",
        "start": 425,
        "end": 486,
        "startLoc": {
          "line": 425,
          "column": 3,
          "position": 3856
        },
        "endLoc": {
          "line": 486,
          "column": 7,
          "position": 4684
        }
      }
    },
    {
      "format": "typescript",
      "lines": 18,
      "fragment": ": 0;\n\n  return {\n    symbol: normalizedConfig.symbol,\n    config: normalizedConfig,\n    trades,\n    metrics: {\n      annualReturnPct: Math.round(annualReturnPct * 100) / 100,\n      totalReturnPct: Math.round(totalReturnPct * 100) / 100,\n      maxDrawdownPct: Math.round(maxDrawdown * 100) / 100,\n      sharpeRatio: Math.round(sharpeRatioValue * 100) / 100,\n      sortinoRatio: Math.round(sortinoRatio * 100) / 100,\n      totalTrades: trades.length,\n      winRatePct: Math.round(winRatePct * 100) / 100,\n      avgWinPct: Math.round(avgWinPct * 100) / 100,\n      avgLossPct: Math.round(avgLossPct * 100) / 100,\n      profitFactor: Math.round(profitFactor * 100) / 100,\n      avgMomentum",
      "tokens": 0,
      "firstFile": {
        "name": "server/strategies/momentum-strategy.ts",
        "start": 513,
        "end": 530,
        "startLoc": {
          "line": 513,
          "column": 7,
          "position": 4913
        },
        "endLoc": {
          "line": 530,
          "column": 12,
          "position": 5140
        }
      },
      "secondFile": {
        "name": "server/strategies/moving-average-crossover.ts",
        "start": 484,
        "end": 501,
        "startLoc": {
          "line": 484,
          "column": 2,
          "position": 4677
        },
        "endLoc": {
          "line": 501,
          "column": 2,
          "position": 4904
        }
      }
    },
    {
      "format": "typescript",
      "lines": 46,
      "fragment": ",\n  parameterBounds: PARAMETER_BOUNDS,\n  supportedSymbols: [\n    \"AAPL\",\n    \"MSFT\",\n    \"GOOGL\",\n    \"AMZN\",\n    \"NVDA\",\n    \"META\",\n    \"TSLA\",\n    \"JPM\",\n    \"V\",\n    \"UNH\",\n    \"JNJ\",\n    \"WMT\",\n    \"PG\",\n    \"MA\",\n    \"HD\",\n    \"CVX\",\n    \"ABBV\",\n    \"MRK\",\n    \"KO\",\n    \"PEP\",\n    \"COST\",\n    \"TMO\",\n    \"AVGO\",\n    \"ORCL\",\n    \"ACN\",\n    \"MCD\",\n    \"CSCO\",\n    \"ABT\",\n    \"AMD\",\n    \"INTC\",\n    \"IBM\",\n    \"CRM\",\n    \"NFLX\",\n    \"ADBE\",\n    \"PYPL\",\n    \"DIS\",\n    \"BTC/USD\",\n    \"ETH/USD\",\n    \"SOL/USD\",\n  ],\n};\n\nexport function normalizeMeanReversionConfig",
      "tokens": 0,
      "firstFile": {
        "name": "server/strategies/mean-reversion-scalper.ts",
        "start": 83,
        "end": 128,
        "startLoc": {
          "line": 83,
          "column": 23,
          "position": 592
        },
        "endLoc": {
          "line": 128,
          "column": 29,
          "position": 775
        }
      },
      "secondFile": {
        "name": "server/strategies/moving-average-crossover.ts",
        "start": 83,
        "end": 128,
        "startLoc": {
          "line": 83,
          "column": 23,
          "position": 640
        },
        "endLoc": {
          "line": 128,
          "column": 29,
          "position": 823
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": ": number;\n  }>;\n}\n\nfunction calculateSMA(prices: number[], period: number): (number | null)[] {\n  const result: (number | null)[] = [];\n  for (let i = 0; i < prices.length; i++) {\n    if (i < period - 1) {\n      result.push(null);\n    } else {\n      const slice = prices.slice(i - period + 1, i + 1);\n      const sum = slice.reduce((a, b) => a + b, 0);\n      result.push(sum / period);\n    }\n  }\n  return result;\n}\n\nfunction calculateStdDev",
      "tokens": 0,
      "firstFile": {
        "name": "server/strategies/mean-reversion-scalper.ts",
        "start": 211,
        "end": 229,
        "startLoc": {
          "line": 211,
          "column": 7,
          "position": 1482
        },
        "endLoc": {
          "line": 229,
          "column": 16,
          "position": 1700
        }
      },
      "secondFile": {
        "name": "server/strategies/moving-average-crossover.ts",
        "start": 243,
        "end": 261,
        "startLoc": {
          "line": 243,
          "column": 6,
          "position": 1820
        },
        "endLoc": {
          "line": 261,
          "column": 17,
          "position": 2038
        }
      }
    },
    {
      "format": "typescript",
      "lines": 22,
      "fragment": "(config);\n\n  const now = new Date();\n  const from = new Date(now.getTime() - lookbackDays * 24 * 60 * 60 * 1000);\n\n  let bars: AlpacaBar[];\n  try {\n    const response = await alpaca.getBars(\n      [normalizedConfig.symbol],\n      \"1Day\",\n      from.toISOString(),\n      now.toISOString(),\n      lookbackDays + 50\n    );\n    bars = response.bars[normalizedConfig.symbol] || [];\n  } catch (error) {\n    throw new Error(\n      `Failed to fetch historical data for ${normalizedConfig.symbol}: ${(error as Error).message}`\n    );\n  }\n\n  if (!bars || bars.length < normalizedConfig.lookbackPeriod",
      "tokens": 0,
      "firstFile": {
        "name": "server/strategies/mean-reversion-scalper.ts",
        "start": 287,
        "end": 308,
        "startLoc": {
          "line": 287,
          "column": 29,
          "position": 2415
        },
        "endLoc": {
          "line": 308,
          "column": 15,
          "position": 2627
        }
      },
      "secondFile": {
        "name": "server/strategies/momentum-strategy.ts",
        "start": 285,
        "end": 322,
        "startLoc": {
          "line": 285,
          "column": 24,
          "position": 2302
        },
        "endLoc": {
          "line": 322,
          "column": 11,
          "position": 2681
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": ") {\n      const exitPrice = price;\n      const pnlPct =\n        ((exitPrice - position.entryPrice) / position.entryPrice) * 100;\n      const entryDate = new Date(timestamps[position.entryIndex] * 1000)\n        .toISOString()\n        .split(\"T\")[0];\n\n      trades.push({\n        entryDate,\n        exitDate: date,\n        entryPrice: position.entryPrice,\n        exitPrice,\n        pnlPct,\n        side: \"long\",\n        exitReason",
      "tokens": 0,
      "firstFile": {
        "name": "server/strategies/mean-reversion-scalper.ts",
        "start": 356,
        "end": 371,
        "startLoc": {
          "line": 356,
          "column": 7,
          "position": 3130
        },
        "endLoc": {
          "line": 371,
          "column": 11,
          "position": 3259
        }
      },
      "secondFile": {
        "name": "server/strategies/moving-average-crossover.ts",
        "start": 355,
        "end": 370,
        "startLoc": {
          "line": 355,
          "column": 9,
          "position": 3095
        },
        "endLoc": {
          "line": 370,
          "column": 2,
          "position": 3224
        }
      }
    },
    {
      "format": "typescript",
      "lines": 27,
      "fragment": "}\n\n    equityCurve.push({ date, value: Math.round(equity * 100) / 100 });\n\n    if (equity > maxEquity) maxEquity = equity;\n    const drawdown = ((maxEquity - equity) / maxEquity) * 100;\n    if (drawdown > maxDrawdown) maxDrawdown = drawdown;\n\n    if (i > 0) {\n      const dailyReturn = (equity - prevEquity) / prevEquity;\n      dailyReturns.push(dailyReturn);\n    }\n    prevEquity = equity;\n  }\n\n  const totalReturnPct = ((equity - 10000) / 10000) * 100;\n  const tradingDays = closePrices.length;\n  const yearsTraded = tradingDays / 252;\n  const annualReturnPct =\n    yearsTraded > 0\n      ? (Math.pow(1 + totalReturnPct / 100, 1 / yearsTraded) - 1) * 100\n      : 0;\n\n  const avgReturn = dailyReturns.length > 0 ? mean(dailyReturns).toNumber() : 0;\n  const returnVariance =\n    dailyReturns.length > 0 ? variance(dailyReturns).toNumber() : 0;\n  const stdDevReturns",
      "tokens": 0,
      "firstFile": {
        "name": "server/strategies/mean-reversion-scalper.ts",
        "start": 485,
        "end": 511,
        "startLoc": {
          "line": 485,
          "column": 5,
          "position": 4382
        },
        "endLoc": {
          "line": 511,
          "column": 14,
          "position": 4712
        }
      },
      "secondFile": {
        "name": "server/strategies/moving-average-crossover.ts",
        "start": 427,
        "end": 453,
        "startLoc": {
          "line": 427,
          "column": 5,
          "position": 3868
        },
        "endLoc": {
          "line": 453,
          "column": 7,
          "position": 4198
        }
      }
    },
    {
      "format": "typescript",
      "lines": 34,
      "fragment": "= Math.sqrt(returnVariance);\n  const sharpeRatioValue =\n    dailyReturns.length > 0\n      ? calcSharpeRatio(dailyReturns, 0, 252).toNumber()\n      : 0;\n\n  const negativeReturns = dailyReturns.filter((r) => r < 0);\n  const downsideVariance =\n    negativeReturns.length > 0 ? variance(negativeReturns).toNumber() : 0;\n  const downsideStdDev = Math.sqrt(downsideVariance);\n  const sortinoRatio =\n    downsideStdDev > 0 ? (avgReturn / downsideStdDev) * Math.sqrt(252) : 0;\n\n  const winningTrades = trades.filter((t) => t.pnlPct > 0);\n  const losingTrades = trades.filter((t) => t.pnlPct <= 0);\n  const winRatePct =\n    trades.length > 0 ? (winningTrades.length / trades.length) * 100 : 0;\n  const avgWinPct =\n    winningTrades.length > 0\n      ? winningTrades.reduce((sum, t) => sum + t.pnlPct, 0) /\n        winningTrades.length\n      : 0;\n  const avgLossPct =\n    losingTrades.length > 0\n      ? losingTrades.reduce((sum, t) => sum + t.pnlPct, 0) / losingTrades.length\n      : 0;\n  const grossProfit = winningTrades.reduce((sum, t) => sum + t.pnlPct, 0);\n  const grossLoss = Math.abs(\n    losingTrades.reduce((sum, t) => sum + t.pnlPct, 0)\n  );\n  const profitFactor =\n    grossLoss > 0 ? grossProfit / grossLoss : grossProfit > 0 ? Infinity : 0;\n\n  const avgHoldingPeriod",
      "tokens": 0,
      "firstFile": {
        "name": "server/strategies/mean-reversion-scalper.ts",
        "start": 511,
        "end": 544,
        "startLoc": {
          "line": 511,
          "column": 2,
          "position": 4714
        },
        "endLoc": {
          "line": 544,
          "column": 17,
          "position": 5200
        }
      },
      "secondFile": {
        "name": "server/strategies/moving-average-crossover.ts",
        "start": 453,
        "end": 510,
        "startLoc": {
          "line": 453,
          "column": 2,
          "position": 4200
        },
        "endLoc": {
          "line": 510,
          "column": 12,
          "position": 4865
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": ", 0) / trades.length\n      : 0;\n\n  return {\n    symbol: normalizedConfig.symbol,\n    config: normalizedConfig,\n    trades,\n    metrics: {\n      annualReturnPct: Math.round(annualReturnPct * 100) / 100,\n      totalReturnPct: Math.round(totalReturnPct * 100) / 100,\n      maxDrawdownPct: Math.round(maxDrawdown * 100) / 100,\n      sharpeRatio: Math.round(sharpeRatioValue * 100) / 100,\n      sortinoRatio: Math.round(sortinoRatio * 100) / 100,\n      totalTrades: trades.length,\n      winRatePct: Math.round(winRatePct * 100) / 100,\n      avgWinPct: Math.round(avgWinPct * 100) / 100,\n      avgLossPct: Math.round(avgLossPct * 100) / 100,\n      profitFactor: Math.round(profitFactor * 100) / 100,\n      avgHoldingPeriod",
      "tokens": 0,
      "firstFile": {
        "name": "server/strategies/mean-reversion-scalper.ts",
        "start": 550,
        "end": 568,
        "startLoc": {
          "line": 550,
          "column": 2,
          "position": 5309
        },
        "endLoc": {
          "line": 568,
          "column": 17,
          "position": 5548
        }
      },
      "secondFile": {
        "name": "server/strategies/momentum-strategy.ts",
        "start": 512,
        "end": 501,
        "startLoc": {
          "line": 512,
          "column": 14,
          "position": 4901
        },
        "endLoc": {
          "line": 501,
          "column": 2,
          "position": 4904
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": "open: lastBar.o?.toString(),\n              high: lastBar.h?.toString(),\n              low: lastBar.l?.toString(),\n              close: lastBar.c?.toString(),\n              volume: lastBar.v?.toString(),\n              sma20: indicators.sma20?.toString(),\n              sma50: indicators.sma50?.toString(),\n              sma200: indicators.sma200?.toString(),\n              ema12: indicators.ema12?.toString(),\n              ema26: indicators.ema26?.toString(),\n              rsi14: indicators.rsi14?.toString(),\n              macd: indicators.macd?.toString(),\n              macdSignal: indicators.macdSignal?.toString(),\n              macdHistogram: indicators.macdHistogram?.toString(),\n              atr14: indicators.atr14?.toString(),\n              bollingerUpper: indicators.bollingerUpper?.toString(),\n              bollingerLower: indicators.bollingerLower?.toString(),\n              adx14: technicalSignals.adx?.toString(),\n              lastUpdatedAt",
      "tokens": 0,
      "firstFile": {
        "name": "server/services/enrichment-scheduler.ts",
        "start": 325,
        "end": 343,
        "startLoc": {
          "line": 325,
          "column": 15,
          "position": 2961
        },
        "endLoc": {
          "line": 343,
          "column": 14,
          "position": 3213
        }
      },
      "secondFile": {
        "name": "server/services/enrichment-scheduler.ts",
        "start": 301,
        "end": 319,
        "startLoc": {
          "line": 301,
          "column": 13,
          "position": 2651
        },
        "endLoc": {
          "line": 319,
          "column": 7,
          "position": 2903
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": ") => {\n    try {\n      const { normalizeMovingAverageConfig } =\n        await import(\"../strategies/moving-average-crossover\");\n      const { validateMovingAverageConfig, getValidatorStatus } =\n        await import(\"../ai/ai-strategy-validator\");\n\n      const status = getValidatorStatus();\n      if (!status.available) {\n        return res\n          .status(503)\n          .json({ error: \"AI validation service is not available\" });\n      }\n\n      const config = normalizeMovingAverageConfig(req.body.config || req.body);\n      const result",
      "tokens": 0,
      "firstFile": {
        "name": "server/routes/portfolio-trading.ts",
        "start": 64,
        "end": 79,
        "startLoc": {
          "line": 64,
          "column": 4,
          "position": 586
        },
        "endLoc": {
          "line": 79,
          "column": 7,
          "position": 722
        }
      },
      "secondFile": {
        "name": "server/routes/strategies.ts",
        "start": 233,
        "end": 248,
        "startLoc": {
          "line": 233,
          "column": 9,
          "position": 2319
        },
        "endLoc": {
          "line": 248,
          "column": 19,
          "position": 2455
        }
      }
    },
    {
      "format": "typescript",
      "lines": 31,
      "fragment": ");\n\n    // Calculate portfolio metrics\n    const equity = parseFloat(alpacaAccount.equity);\n    const lastEquity = parseFloat(alpacaAccount.last_equity);\n    const buyingPower = parseFloat(alpacaAccount.buying_power);\n    const cash = parseFloat(alpacaAccount.cash);\n    const portfolioValue = parseFloat(alpacaAccount.portfolio_value);\n\n    // Calculate P&L\n    const dailyPl = equity - lastEquity;\n    const dailyPlPct = lastEquity > 0 ? (dailyPl / lastEquity) * 100 : 0;\n\n    // Map positions to required format\n    const positions = alpacaPositions.map((pos: any) => ({\n      id: pos.asset_id,\n      symbol: pos.symbol,\n      side: pos.side === \"long\" ? \"long\" : \"short\",\n      qty: parseFloat(pos.qty),\n      entryPrice: parseFloat(pos.avg_entry_price),\n      currentPrice: parseFloat(pos.current_price),\n      marketValue: parseFloat(pos.market_value),\n      unrealizedPl: parseFloat(pos.unrealized_pl),\n      unrealizedPlPct: parseFloat(pos.unrealized_plpc) * 100,\n      costBasis: parseFloat(pos.cost_basis),\n      assetClass: pos.asset_class === \"crypto\" ? \"crypto\" : \"us_equity\",\n    }));\n\n    // Calculate total unrealized P&L from positions\n    const totalUnrealizedPl = positions.reduce(\n      (sum,",
      "tokens": 0,
      "firstFile": {
        "name": "server/routes/portfolio-snapshot.ts",
        "start": 24,
        "end": 54,
        "startLoc": {
          "line": 24,
          "column": 2,
          "position": 143
        },
        "endLoc": {
          "line": 54,
          "column": 2,
          "position": 475
        }
      },
      "secondFile": {
        "name": "server/routes/positions.ts",
        "start": 29,
        "end": 59,
        "startLoc": {
          "line": 29,
          "column": 2,
          "position": 219
        },
        "endLoc": {
          "line": 59,
          "column": 2,
          "position": 551
        }
      }
    },
    {
      "format": "typescript",
      "lines": 27,
      "fragment": ") => sum + pos.unrealizedPl,\n      0\n    );\n\n    // Get trades from database for realized P&L\n    const trades = await storage.getTrades(undefined, 100);\n    const closedTrades = trades.filter((t) => t.pnl !== null && t.pnl !== \"\");\n    const totalRealizedPl = closedTrades.reduce(\n      (sum, t) => sum + parseFloat(t.pnl || \"0\"),\n      0\n    );\n\n    const snapshot = {\n      totalEquity: equity,\n      buyingPower,\n      cash,\n      portfolioValue,\n      dailyPl,\n      dailyPlPct,\n      totalPl: totalRealizedPl + totalUnrealizedPl,\n      totalPlPct:\n        lastEquity > 0\n          ? ((totalRealizedPl + totalUnrealizedPl) / lastEquity) * 100\n          : 0,\n      positions,\n      timestamp: new Date().toISOString(),\n      // Additional metrics",
      "tokens": 0,
      "firstFile": {
        "name": "server/routes/portfolio-snapshot.ts",
        "start": 54,
        "end": 80,
        "startLoc": {
          "line": 54,
          "column": 4,
          "position": 478
        },
        "endLoc": {
          "line": 80,
          "column": 22,
          "position": 710
        }
      },
      "secondFile": {
        "name": "server/routes/positions.ts",
        "start": 59,
        "end": 85,
        "startLoc": {
          "line": 59,
          "column": 4,
          "position": 560
        },
        "endLoc": {
          "line": 85,
          "column": 14,
          "position": 792
        }
      }
    },
    {
      "format": "typescript",
      "lines": 29,
      "fragment": ");\n    }\n    const symbols = symbolsParam.split(\",\").map((s) => s.trim().toUpperCase());\n    const snapshots = await alpaca.getSnapshots(symbols);\n\n    // Transform to a simpler format\n    const quotes = symbols.map((symbol) => {\n      const snap = snapshots[symbol];\n      if (!snap) {\n        return { symbol, price: null, change: null, changePercent: null };\n      }\n      const price = snap.latestTrade?.p || snap.dailyBar?.c || 0;\n      const prevClose = snap.prevDailyBar?.c || price;\n      const change = price - prevClose;\n      const changePercent = prevClose ? (change / prevClose) * 100 : 0;\n      return {\n        symbol,\n        price,\n        change,\n        changePercent,\n        volume: snap.dailyBar?.v || 0,\n        high: snap.dailyBar?.h || 0,\n        low: snap.dailyBar?.l || 0,\n        open: snap.dailyBar?.o || 0,\n      };\n    });\n    res.json(quotes);\n  } catch (error) {\n    log.error(\"MarketDataAPI\"",
      "tokens": 0,
      "firstFile": {
        "name": "server/routes/market-data.ts",
        "start": 188,
        "end": 216,
        "startLoc": {
          "line": 188,
          "column": 29,
          "position": 2033
        },
        "endLoc": {
          "line": 216,
          "column": 16,
          "position": 2375
        }
      },
      "secondFile": {
        "name": "server/routes/market-quotes.ts",
        "start": 16,
        "end": 44,
        "startLoc": {
          "line": 16,
          "column": 2,
          "position": 139
        },
        "endLoc": {
          "line": 44,
          "column": 21,
          "position": 481
        }
      }
    },
    {
      "format": "typescript",
      "lines": 31,
      "fragment": "async function authMiddleware(req: Request, res: Response, next: NextFunction) {\n  try {\n    const sessionId = req.cookies?.session;\n\n    if (!sessionId) {\n      log.warn(\"Auth\", \"No session cookie found for request:\", {\n        path: req.path,\n      });\n      return res.status(401).json({\n        error: \"Not authenticated\",\n        code: \"NO_SESSION\",\n        message: \"Please log in to access this resource\",\n      });\n    }\n\n    const session = await getSession(sessionId);\n    if (!session) {\n      log.warn(\"Auth\", \"Session expired or invalid:\", {\n        sessionId: sessionId.substring(0, 8) + \"...\",\n      });\n      return res.status(401).json({\n        error: \"Session expired\",\n        code: \"SESSION_EXPIRED\",\n        message: \"Your session has expired. Please log in again.\",\n      });\n    }\n\n    req.userId = session.userId;\n    next();\n  } catch (error) {\n    log.error(\"Auth\", \"Auth middleware error:\"",
      "tokens": 0,
      "firstFile": {
        "name": "server/routes/enforcement-fundamentals.ts",
        "start": 13,
        "end": 43,
        "startLoc": {
          "line": 13,
          "column": 1,
          "position": 108
        },
        "endLoc": {
          "line": 43,
          "column": 25,
          "position": 379
        }
      },
      "secondFile": {
        "name": "server/routes/portfolio-trading.ts",
        "start": 7,
        "end": 37,
        "startLoc": {
          "line": 7,
          "column": 1,
          "position": 77
        },
        "endLoc": {
          "line": 37,
          "column": 24,
          "position": 348
        }
      }
    },
    {
      "format": "typescript",
      "lines": 24,
      "fragment": "const result = await alpacaTradingEngine.closeAlpacaPosition(\n          symbol,\n          undefined,\n          {\n            authorizedByOrchestrator: true,\n          }\n        );\n\n        if (result.success) {\n          res.json({\n            success: true,\n            message: `Position ${symbol} closed successfully`,\n            result,\n          });\n        } else {\n          res\n            .status(400)\n            .json({\n              success: false,\n              error: result.error || \"Failed to close position\",\n            });\n        }\n      } catch (error) {\n        log.error(\"AutonomousRoutes\"",
      "tokens": 0,
      "firstFile": {
        "name": "server/routes/autonomous.ts",
        "start": 263,
        "end": 286,
        "startLoc": {
          "line": 263,
          "column": 9,
          "position": 2041
        },
        "endLoc": {
          "line": 286,
          "column": 19,
          "position": 2192
        }
      },
      "secondFile": {
        "name": "server/routes/positions.ts",
        "start": 302,
        "end": 323,
        "startLoc": {
          "line": 302,
          "column": 5,
          "position": 2534
        },
        "endLoc": {
          "line": 323,
          "column": 15,
          "position": 2681
        }
      }
    },
    {
      "format": "typescript",
      "lines": 18,
      "fragment": ": null };\n      }\n      const price = snap.latestTrade?.p || snap.dailyBar?.c || 0;\n      const prevClose = snap.prevDailyBar?.c || price;\n      const change = price - prevClose;\n      const changePercent = prevClose ? (change / prevClose) * 100 : 0;\n      return {\n        symbol,\n        price,\n        change,\n        changePercent,\n        volume: snap.dailyBar?.v || 0,\n        high: snap.dailyBar?.h || 0,\n        low: snap.dailyBar?.l || 0,\n        open: snap.dailyBar?.o || 0,\n      };\n    });\n    res.json(result",
      "tokens": 0,
      "firstFile": {
        "name": "server/routes/alpaca.ts",
        "start": 197,
        "end": 214,
        "startLoc": {
          "line": 197,
          "column": 7,
          "position": 2061
        },
        "endLoc": {
          "line": 214,
          "column": 7,
          "position": 2259
        }
      },
      "secondFile": {
        "name": "server/routes/market-quotes.ts",
        "start": 25,
        "end": 42,
        "startLoc": {
          "line": 25,
          "column": 14,
          "position": 263
        },
        "endLoc": {
          "line": 42,
          "column": 7,
          "position": 461
        }
      }
    },
    {
      "format": "typescript",
      "lines": 24,
      "fragment": ");\n      }\n\n      const results: Array<{\n        decisionId: string;\n        success: boolean;\n        error?: string;\n        order?: unknown;\n      }> = [];\n\n      for (const decisionId of decisionIds) {\n        const decisions = await storage.getAiDecisions(undefined, 100);\n        const decision = decisions.find((d) => d.id === decisionId);\n        if (!decision) {\n          results.push({\n            decisionId,\n            success: false,\n            error: \"Decision not found\",\n          });\n          continue;\n        }\n\n        try {\n          // Use AI's suggestedQuantity instead of hardcoded 1",
      "tokens": 0,
      "firstFile": {
        "name": "server/routes/ai-decisions.ts",
        "start": 736,
        "end": 759,
        "startLoc": {
          "line": 736,
          "column": 33,
          "position": 6033
        },
        "endLoc": {
          "line": 759,
          "column": 53,
          "position": 6207
        }
      },
      "secondFile": {
        "name": "server/routes/autonomous.ts",
        "start": 379,
        "end": 402,
        "startLoc": {
          "line": 379,
          "column": 2,
          "position": 2885
        },
        "endLoc": {
          "line": 402,
          "column": 58,
          "position": 3059
        }
      }
    },
    {
      "format": "typescript",
      "lines": 69,
      "fragment": "// suggestedQuantity is a percentage (0.01-0.25), calculate actual shares\n          const metadata = decision.metadata\n            ? JSON.parse(decision.metadata)\n            : {};\n          const suggestedPct = metadata?.suggestedQuantity\n            ? parseFloat(String(metadata.suggestedQuantity))\n            : 0.05; // Default 5% of portfolio\n\n          // Get account info to calculate quantity\n          const account = await alpaca.getAccount();\n          const buyingPower = parseFloat(account.buying_power);\n          const price = parseFloat(decision.entryPrice || \"0\");\n          if (!price) {\n            results.push({\n              decisionId,\n              success: false,\n              error: \"No entry price available\",\n            });\n            continue;\n          }\n\n          const tradeValue =\n            buyingPower * Math.min(Math.max(suggestedPct, 0.01), 0.1); // 1-10% cap\n          const quantity = Math.floor(tradeValue / price);\n\n          if (quantity < 1) {\n            results.push({\n              decisionId,\n              success: false,\n              error: \"Calculated quantity less than 1 share\",\n            });\n            continue;\n          }\n\n          // SECURITY: Mark as authorized since this is an admin-initiated action\n          // executing a pre-approved AI decision\n          const orderResult = await alpacaTradingEngine.executeAlpacaTrade({\n            symbol: decision.symbol,\n            side: decision.action as \"buy\" | \"sell\",\n            quantity,\n            authorizedByOrchestrator: true,\n          });\n\n          if (orderResult.success) {\n            results.push({\n              decisionId,\n              success: true,\n              order: orderResult.order,\n            });\n          } else {\n            results.push({\n              decisionId,\n              success: false,\n              error: orderResult.error,\n            });\n          }\n        } catch (err) {\n          results.push({ decisionId, success: false, error: String(err) });\n        }\n      }\n\n      const successCount = results.filter((r) => r.success).length;\n      res.json({\n        success: successCount > 0,\n        message: `Executed ${successCount}/${decisionIds.length} trades`,\n        results,\n      });\n    } catch (error) {\n      log.error(\"AiDecisionsAPI\"",
      "tokens": 0,
      "firstFile": {
        "name": "server/routes/ai-decisions.ts",
        "start": 760,
        "end": 828,
        "startLoc": {
          "line": 760,
          "column": 11,
          "position": 6210
        },
        "endLoc": {
          "line": 828,
          "column": 17,
          "position": 6761
        }
      },
      "secondFile": {
        "name": "server/routes/autonomous.ts",
        "start": 403,
        "end": 471,
        "startLoc": {
          "line": 403,
          "column": 13,
          "position": 3062
        },
        "endLoc": {
          "line": 471,
          "column": 19,
          "position": 3613
        }
      }
    },
    {
      "format": "typescript",
      "lines": 51,
      "fragment": ");\n    }\n\n    let strategy: StrategyContext | undefined;\n    if (strategyId) {\n      const dbStrategy = await storage.getStrategy(strategyId);\n      if (dbStrategy) {\n        strategy = {\n          id: dbStrategy.id,\n          name: dbStrategy.name,\n          type: dbStrategy.type,\n          parameters: dbStrategy.parameters\n            ? JSON.parse(dbStrategy.parameters)\n            : undefined,\n        };\n      }\n    }\n\n    const traceId = generateTraceId();\n    const decision = await aiDecisionEngine.analyzeOpportunity(\n      symbol,\n      marketData as MarketData,\n      newsContext as NewsContext | undefined,\n      strategy,\n      { traceId }\n    );\n\n    const aiDecisionRecord = await storage.createAiDecision({\n      strategyId: strategyId || null,\n      symbol,\n      action: decision.action,\n      confidence: decision.confidence.toString(),\n      reasoning: decision.reasoning,\n      traceId,\n      marketContext: JSON.stringify({\n        marketData,\n        newsContext,\n        riskLevel: decision.riskLevel,\n        suggestedQuantity: decision.suggestedQuantity,\n        targetPrice: decision.targetPrice,\n        stopLoss: decision.stopLoss,\n      }),\n    });\n\n    res.json({\n      id: aiDecisionRecord.id,\n      ...decision,\n      createdAt: aiDecisionRecord.createdAt,\n    });\n  } catch (error) {\n    log.error(\"Routes\"",
      "tokens": 0,
      "firstFile": {
        "name": "server/routes/ai-analysis.ts",
        "start": 29,
        "end": 79,
        "startLoc": {
          "line": 29,
          "column": 2,
          "position": 222
        },
        "endLoc": {
          "line": 79,
          "column": 9,
          "position": 595
        }
      },
      "secondFile": {
        "name": "server/routes/ai-decisions.ts",
        "start": 298,
        "end": 348,
        "startLoc": {
          "line": 298,
          "column": 38,
          "position": 2475
        },
        "endLoc": {
          "line": 348,
          "column": 17,
          "position": 2848
        }
      }
    },
    {
      "format": "typescript",
      "lines": 18,
      "fragment": "router.get(\"/events\", async (req: Request, res: Response) => {\n  try {\n    const limit = Math.min(parseInt(req.query.limit as string) || 20, 100);\n    const type = req.query.type as string | undefined;\n\n    // Get recent AI decisions from storage\n    const decisions = await storage.getAiDecisions(undefined, limit * 2);\n\n    // Transform decisions into events format\n    // Note: type, headline, explanation, signals are derived from action/reasoning\n    const events = decisions\n      .filter((d) => !type || d.action === type)\n      .slice(0, limit)\n      .map((d) => ({\n        id: d.id,\n        type: d.action || \"signal\",\n        title: `${d.action?.toUpperCase() || \"SIGNAL\"} - ${d.symbol || \"Market\"}`,\n        headline: `${d.action?.toUpperCase() || \"SIGNAL\"} - ${d.symbol",
      "tokens": 0,
      "firstFile": {
        "name": "server/routes/ai-analysis.ts",
        "start": 97,
        "end": 114,
        "startLoc": {
          "line": 97,
          "column": 1,
          "position": 743
        },
        "endLoc": {
          "line": 114,
          "column": 7,
          "position": 996
        }
      },
      "secondFile": {
        "name": "server/routes/ai-decisions.ts",
        "start": 371,
        "end": 388,
        "startLoc": {
          "line": 371,
          "column": 1,
          "position": 3002
        },
        "endLoc": {
          "line": 388,
          "column": 8,
          "position": 3255
        }
      }
    },
    {
      "format": "typescript",
      "lines": 31,
      "fragment": "router.get(\"/sentiment\", async (req: Request, res: Response) => {\n  try {\n    const symbols = (req.query.symbols as string)?.split(\",\") || [\n      \"SPY\",\n      \"QQQ\",\n      \"AAPL\",\n      \"TSLA\",\n      \"NVDA\",\n    ];\n\n    // Generate sentiment signals based on available data\n    // In production, this would call the data fusion engine or sentiment analysis service\n    const sentiments = symbols.map((symbol) => ({\n      id: `sent-${symbol}-${Date.now()}`,\n      sourceId: \"data-fusion\",\n      sourceName: \"Data Fusion Engine\",\n      symbol,\n      score: Math.random() * 100 - 50, // -50 to +50\n      trend:\n        Math.random() > 0.5\n          ? (\"up\" as const)\n          : Math.random() > 0.5\n            ? (\"down\" as const)\n            : (\"neutral\" as const),\n      explanation: `Aggregate sentiment analysis for ${symbol} based on news, social media, and market data`,\n      timestamp: new Date().toISOString(),\n    }));\n\n    res.json(sentiments);\n  } catch (error) {\n    log.error(\"Routes\"",
      "tokens": 0,
      "firstFile": {
        "name": "server/routes/ai-analysis.ts",
        "start": 190,
        "end": 220,
        "startLoc": {
          "line": 190,
          "column": 1,
          "position": 1707
        },
        "endLoc": {
          "line": 220,
          "column": 9,
          "position": 1996
        }
      },
      "secondFile": {
        "name": "server/routes/ai-decisions.ts",
        "start": 417,
        "end": 447,
        "startLoc": {
          "line": 417,
          "column": 1,
          "position": 3442
        },
        "endLoc": {
          "line": 447,
          "column": 17,
          "position": 3731
        }
      }
    },
    {
      "format": "typescript",
      "lines": 27,
      "fragment": ",\n  async (req: Request, res: Response) => {\n    const { traceId } = req.params;\n\n    if (!traceId) {\n      return res.status(400).json({ error: \"traceId is required\" });\n    }\n\n    try {\n      const [decisionResults, llmCallResults, workItemResults, tradeResults] =\n        await Promise.all([\n          db.select().from(aiDecisions).where(eq(aiDecisions.traceId, traceId)),\n          db\n            .select()\n            .from(llmCalls)\n            .where(eq(llmCalls.traceId, traceId))\n            .orderBy(desc(llmCalls.createdAt)),\n          db\n            .select()\n            .from(workItems)\n            .where(\n              or(\n                like(workItems.payload, `%${traceId}%`),\n                like(workItems.result, `%${traceId}%`)\n              )\n            ),\n          db",
      "tokens": 0,
      "firstFile": {
        "name": "server/observability/routes.ts",
        "start": 329,
        "end": 355,
        "startLoc": {
          "line": 329,
          "column": 18,
          "position": 2912
        },
        "endLoc": {
          "line": 355,
          "column": 3,
          "position": 3154
        }
      },
      "secondFile": {
        "name": "server/routes/traces.ts",
        "start": 78,
        "end": 103,
        "startLoc": {
          "line": 78,
          "column": 12,
          "position": 559
        },
        "endLoc": {
          "line": 103,
          "column": 8,
          "position": 800
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": ");\n\n      const totalTokens = llmCallResults.reduce(\n        (sum, c) => sum + (c.totalTokens || 0),\n        0\n      );\n      const estimatedCost = llmCallResults.reduce(\n        (sum, c) => sum + parseFloat(c.estimatedCost || \"0\"),\n        0\n      );\n      const totalLatency = llmCallResults.reduce(\n        (sum, c) => sum + (c.latencyMs || 0),\n        0\n      );\n      const providersUsed = [...new Set(llmCallResults.map((c) => c.provider))];\n\n      const",
      "tokens": 0,
      "firstFile": {
        "name": "server/observability/routes.ts",
        "start": 356,
        "end": 372,
        "startLoc": {
          "line": 356,
          "column": 2,
          "position": 3181
        },
        "endLoc": {
          "line": 372,
          "column": 6,
          "position": 3351
        }
      },
      "secondFile": {
        "name": "server/routes/traces.ts",
        "start": 177,
        "end": 193,
        "startLoc": {
          "line": 177,
          "column": 2,
          "position": 1388
        },
        "endLoc": {
          "line": 193,
          "column": 4,
          "position": 1558
        }
      }
    },
    {
      "format": "typescript",
      "lines": 18,
      "fragment": "function calculateSMA(\n  prices: number[],\n  period: number\n): (number | null)[] {\n  const result: (number | null)[] = [];\n  for (let i = 0; i < prices.length; i++) {\n    if (i < period - 1) {\n      result.push(null);\n    } else {\n      const slice = prices.slice(i - period + 1, i + 1);\n      const sum = slice.reduce((a, b) => a + b, 0);\n      result.push(sum / period);\n    }\n  }\n  return result;\n}\n\nexport",
      "tokens": 0,
      "firstFile": {
        "name": "server/lib/technical-indicators.ts",
        "start": 19,
        "end": 36,
        "startLoc": {
          "line": 19,
          "column": 2,
          "position": 176
        },
        "endLoc": {
          "line": 36,
          "column": 7,
          "position": 383
        }
      },
      "secondFile": {
        "name": "server/strategies/moving-average-crossover.ts",
        "start": 247,
        "end": 261,
        "startLoc": {
          "line": 247,
          "column": 1,
          "position": 1833
        },
        "endLoc": {
          "line": 261,
          "column": 9,
          "position": 2036
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": "function calculateStdDev(\n  prices: number[],\n  period: number\n): (number | null)[] {\n  const result: (number | null)[] = [];\n  for (let i = 0; i < prices.length; i++) {\n    if (i < period - 1) {\n      result.push(null);\n    } else {\n      const slice = prices.slice(i - period + 1, i + 1);\n      result.push(stdDev(slice).toNumber());\n    }\n  }\n  return result;\n}\n\nexport",
      "tokens": 0,
      "firstFile": {
        "name": "server/lib/technical-indicators.ts",
        "start": 229,
        "end": 245,
        "startLoc": {
          "line": 229,
          "column": 2,
          "position": 2646
        },
        "endLoc": {
          "line": 245,
          "column": 7,
          "position": 2825
        }
      },
      "secondFile": {
        "name": "server/strategies/mean-reversion-scalper.ts",
        "start": 229,
        "end": 242,
        "startLoc": {
          "line": 229,
          "column": 1,
          "position": 1698
        },
        "endLoc": {
          "line": 242,
          "column": 9,
          "position": 1873
        }
      }
    },
    {
      "format": "typescript",
      "lines": 28,
      "fragment": ");\n      try {\n        const fallbackResult = await callExternal<T>(\n          fallbackFetcher as () => Promise<T>,\n          {\n            provider: fallbackProvider,\n            endpoint,\n            cacheKey: effectiveCacheKey,\n            budgetPolicy,\n            cachePolicy,\n          }\n        );\n        return {\n          ...fallbackResult,\n          provenance: {\n            ...fallbackResult.provenance,\n            usedFallback: true,\n          },\n        };\n      } catch (fallbackError) {\n        log.warn(\n          \"CallExternal\",\n          `Fallback provider ${fallbackProvider} also failed`\n        );\n      }\n    }\n\n    throw error",
      "tokens": 0,
      "firstFile": {
        "name": "server/lib/callExternal.ts",
        "start": 227,
        "end": 254,
        "startLoc": {
          "line": 227,
          "column": 7,
          "position": 1730
        },
        "endLoc": {
          "line": 254,
          "column": 6,
          "position": 1885
        }
      },
      "secondFile": {
        "name": "server/lib/callExternal.ts",
        "start": 126,
        "end": 153,
        "startLoc": {
          "line": 126,
          "column": 9,
          "position": 1053
        },
        "endLoc": {
          "line": 153,
          "column": 4,
          "position": 1208
        }
      }
    },
    {
      "format": "typescript",
      "lines": 107,
      "fragment": ",\n    };\n  }\n\n  async getAccount(): Promise<FuturesAccount> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async getPositions(): Promise<FuturesPosition[]> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async getPosition(\n    symbol: string,\n    contractMonth?: string\n  ): Promise<FuturesPosition | null> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async createOrder(params: FuturesOrderParams): Promise<FuturesOrder> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async createBracketOrder(\n    params: FuturesOrderParams & {\n      takeProfitPrice: number;\n      stopLossPrice: number;\n    }\n  ): Promise<FuturesOrder> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async cancelOrder(orderId: string): Promise<void> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async cancelAllOrders(symbol?: string): Promise<number> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async getOrder(orderId: string): Promise<FuturesOrder> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async getOrders(status?: \"all\" | \"open\" | \"closed\"): Promise<FuturesOrder[]> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async closePosition(\n    symbol: string,\n    contractMonth?: string\n  ): Promise<FuturesOrder> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async getQuote(\n    symbol: string,\n    contractMonth?: string\n  ): Promise<FuturesQuote> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async getBars(\n    symbol: string,\n    timeframe: string,\n    start: Date,\n    end: Date,\n    contractMonth?: string\n  ): Promise<FuturesBar[]> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async getContractSpecs(symbol: string): Promise<any> {\n    throw new Error(\"Not implemented\");\n  }\n\n  subscribeQuotes(symbols: string[], callback: QuoteCallback): void {\n    throw new Error(\"Not implemented\");\n  }\n\n  unsubscribeQuotes(symbols: string[]): void {\n    throw new Error(\"Not implemented\");\n  }\n\n  subscribeBars(\n    symbols: string[],\n    timeframe: string,\n    callback: BarCallback\n  ): void {\n    throw new Error(\"Not implemented\");\n  }\n\n  unsubscribeBars(symbols: string[]): void {\n    throw new Error(\"Not implemented\");\n  }\n}\n\n/**\n * NinjaTrader futures connector stub\n *\n * To implement:\n * - Install NinjaTrader 8\n * - Enable NinjaTrader's ATI (Automated Trading Interface)\n * - Use NinjaTrader's C# API or HTTP endpoints\n *\n * @see https://ninjatrader.com/support/helpGuides/nt8/automated_trading_interface.htm\n */",
      "tokens": 0,
      "firstFile": {
        "name": "server/connectors/futures-broker-interface.ts",
        "start": 534,
        "end": 640,
        "startLoc": {
          "line": 534,
          "column": 49,
          "position": 2648
        },
        "endLoc": {
          "line": 640,
          "column": 4,
          "position": 3356
        }
      },
      "secondFile": {
        "name": "server/connectors/futures-broker-interface.ts",
        "start": 405,
        "end": 512,
        "startLoc": {
          "line": 405,
          "column": 46,
          "position": 1794
        },
        "endLoc": {
          "line": 512,
          "column": 4,
          "position": 2502
        }
      }
    },
    {
      "format": "typescript",
      "lines": 98,
      "fragment": ",\n    };\n  }\n\n  async getAccount(): Promise<FuturesAccount> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async getPositions(): Promise<FuturesPosition[]> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async getPosition(\n    symbol: string,\n    contractMonth?: string\n  ): Promise<FuturesPosition | null> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async createOrder(params: FuturesOrderParams): Promise<FuturesOrder> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async createBracketOrder(\n    params: FuturesOrderParams & {\n      takeProfitPrice: number;\n      stopLossPrice: number;\n    }\n  ): Promise<FuturesOrder> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async cancelOrder(orderId: string): Promise<void> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async cancelAllOrders(symbol?: string): Promise<number> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async getOrder(orderId: string): Promise<FuturesOrder> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async getOrders(status?: \"all\" | \"open\" | \"closed\"): Promise<FuturesOrder[]> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async closePosition(\n    symbol: string,\n    contractMonth?: string\n  ): Promise<FuturesOrder> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async getQuote(\n    symbol: string,\n    contractMonth?: string\n  ): Promise<FuturesQuote> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async getBars(\n    symbol: string,\n    timeframe: string,\n    start: Date,\n    end: Date,\n    contractMonth?: string\n  ): Promise<FuturesBar[]> {\n    throw new Error(\"Not implemented\");\n  }\n\n  async getContractSpecs(symbol: string): Promise<any> {\n    throw new Error(\"Not implemented\");\n  }\n\n  subscribeQuotes(symbols: string[], callback: QuoteCallback): void {\n    throw new Error(\"Not implemented\");\n  }\n\n  unsubscribeQuotes(symbols: string[]): void {\n    throw new Error(\"Not implemented\");\n  }\n\n  subscribeBars(\n    symbols: string[],\n    timeframe: string,\n    callback: BarCallback\n  ): void {\n    throw new Error(\"Not implemented\");\n  }\n\n  unsubscribeBars(symbols: string[]): void {\n    throw new Error(\"Not implemented\");\n  }\n}\n\n// ============================================================================",
      "tokens": 0,
      "firstFile": {
        "name": "server/connectors/futures-broker-interface.ts",
        "start": 662,
        "end": 759,
        "startLoc": {
          "line": 662,
          "column": 47,
          "position": 3502
        },
        "endLoc": {
          "line": 759,
          "column": 80,
          "position": 4210
        }
      },
      "secondFile": {
        "name": "server/connectors/futures-broker-interface.ts",
        "start": 405,
        "end": 512,
        "startLoc": {
          "line": 405,
          "column": 46,
          "position": 1794
        },
        "endLoc": {
          "line": 512,
          "column": 4,
          "position": 2502
        }
      }
    },
    {
      "format": "typescript",
      "lines": 16,
      "fragment": "${base.toUpperCase()}`;\n      if (symbols && symbols.length > 0) {\n        url += `&to=${symbols.map((s) => s.toUpperCase()).join(\",\")}`;\n      }\n\n      const response = await fetch(url, {\n        headers: { Accept: \"application/json\" },\n      });\n\n      if (!response.ok) {\n        throw new Error(\n          `Frankfurter API error: ${response.status} ${response.statusText}`\n        );\n      }\n\n      const data: HistoricalRates",
      "tokens": 0,
      "firstFile": {
        "name": "server/connectors/frankfurter.ts",
        "start": 142,
        "end": 157,
        "startLoc": {
          "line": 142,
          "column": 7,
          "position": 1361
        },
        "endLoc": {
          "line": 157,
          "column": 16,
          "position": 1510
        }
      },
      "secondFile": {
        "name": "server/connectors/frankfurter.ts",
        "start": 95,
        "end": 110,
        "startLoc": {
          "line": 95,
          "column": 14,
          "position": 910
        },
        "endLoc": {
          "line": 110,
          "column": 14,
          "position": 1059
        }
      }
    },
    {
      "format": "typescript",
      "lines": 19,
      "fragment": "}`;\n\n    const l1Cached = this.quotesCache.get(l1CacheKey);\n    if (l1Cached?.isFresh) {\n      log.debug(\"CMC\", `L1 cache HIT for ${l1CacheKey}`);\n      return l1Cached.data;\n    }\n\n    const apiKey = this.getApiKey();\n    if (!apiKey) {\n      const stale = this.quotesCache.getStale(l1CacheKey);\n      if (stale) {\n        log.debug(\"CMC\", `No API key, serving stale L1 data for ${l1CacheKey}`);\n        return stale;\n      }\n      throw new Error(\"COINMARKETCAP_API_KEY is not configured\");\n    }\n\n    const url = `${CMC_BASE_URL}/v1/cryptocurrency/quotes/latest?symbol=",
      "tokens": 0,
      "firstFile": {
        "name": "server/connectors/coinmarketcap.ts",
        "start": 288,
        "end": 306,
        "startLoc": {
          "line": 288,
          "column": 13,
          "position": 2298
        },
        "endLoc": {
          "line": 306,
          "column": 41,
          "position": 2461
        }
      },
      "secondFile": {
        "name": "server/connectors/coinmarketcap.ts",
        "start": 245,
        "end": 263,
        "startLoc": {
          "line": 245,
          "column": 9,
          "position": 1906
        },
        "endLoc": {
          "line": 263,
          "column": 37,
          "position": 2069
        }
      }
    },
    {
      "format": "typescript",
      "lines": 22,
      "fragment": "export async function getWatchlist(): Promise<{\n  stocks: string[];\n  crypto: string[];\n}> {\n  const now = Date.now();\n\n  // Return cached if still valid\n  if (cachedWatchlist && now - watchlistCacheTime < WATCHLIST_CACHE_TTL_MS) {\n    return cachedWatchlist;\n  }\n\n  try {\n    const dynamicWatchlist = await candidatesService.getWatchlistSymbols();\n\n    // If database has symbols, use them; otherwise fall back to defaults\n    if (\n      dynamicWatchlist.stocks.length > 0 ||\n      dynamicWatchlist.crypto.length > 0\n    ) {\n      cachedWatchlist = dynamicWatchlist;\n      watchlistCacheTime = now;\n      return",
      "tokens": 0,
      "firstFile": {
        "name": "server/autonomous/crypto-utils.ts",
        "start": 86,
        "end": 107,
        "startLoc": {
          "line": 86,
          "column": 1,
          "position": 185
        },
        "endLoc": {
          "line": 107,
          "column": 7,
          "position": 348
        }
      },
      "secondFile": {
        "name": "server/autonomous/watchlist-cache.ts",
        "start": 87,
        "end": 108,
        "startLoc": {
          "line": 87,
          "column": 1,
          "position": 184
        },
        "endLoc": {
          "line": 108,
          "column": 4,
          "position": 347
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": ") {\n      return false;\n    }\n\n    try {\n      const response = await this.call({\n        system: \"You are a helpful assistant. Respond with 'OK'.\",\n        messages: [{ role: \"user\", content: \"Hello\" }],\n        temperature: 0,\n        maxTokens: 10,\n      });\n\n      return (response.content || response.text || \"\")\n        .toLowerCase()\n        .includes(\"ok\");\n    } catch (error) {\n      log.error(\"CloudflareClient\"",
      "tokens": 0,
      "firstFile": {
        "name": "server/ai/cloudflareClient.ts",
        "start": 246,
        "end": 262,
        "startLoc": {
          "line": 246,
          "column": 2,
          "position": 1679
        },
        "endLoc": {
          "line": 262,
          "column": 19,
          "position": 1811
        }
      },
      "secondFile": {
        "name": "server/ai/geminiClient.ts",
        "start": 269,
        "end": 285,
        "startLoc": {
          "line": 269,
          "column": 7,
          "position": 1816
        },
        "endLoc": {
          "line": 285,
          "column": 15,
          "position": 1948
        }
      }
    },
    {
      "format": "typescript",
      "lines": 31,
      "fragment": "async function authMiddleware(req: Request, res: Response, next: NextFunction) {\n  try {\n    const sessionId = req.cookies?.session;\n\n    if (!sessionId) {\n      log.warn(\"Auth\", \"No session cookie found for request:\", {\n        path: req.path,\n      });\n      return res.status(401).json({\n        error: \"Not authenticated\",\n        code: \"NO_SESSION\",\n        message: \"Please log in to access this resource\",\n      });\n    }\n\n    const session = await getSession(sessionId);\n    if (!session) {\n      log.warn(\"Auth\", \"Session expired or invalid:\", {\n        sessionId: sessionId.substring(0, 8) + \"...\",\n      });\n      return res.status(401).json({\n        error: \"Session expired\",\n        code: \"SESSION_EXPIRED\",\n        message: \"Your session has expired. Please log in again.\",\n      });\n    }\n\n    req.userId = session.userId;\n    next();\n  } catch (error) {\n    log.error(\"Auth\", \"Middleware error\"",
      "tokens": 0,
      "firstFile": {
        "name": "server/routes.ts",
        "start": 183,
        "end": 213,
        "startLoc": {
          "line": 183,
          "column": 1,
          "position": 1309
        },
        "endLoc": {
          "line": 213,
          "column": 19,
          "position": 1580
        }
      },
      "secondFile": {
        "name": "server/routes/portfolio-trading.ts",
        "start": 7,
        "end": 37,
        "startLoc": {
          "line": 7,
          "column": 1,
          "position": 77
        },
        "endLoc": {
          "line": 37,
          "column": 24,
          "position": 348
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": "const redactWebhook = (webhook: WebhookConfig) => ({\n    ...webhook,\n    secret: webhook.secret ? \"***REDACTED***\" : undefined,\n    headers: webhook.headers\n      ? Object.fromEntries(\n          Object.entries(webhook.headers).map(([k, v]) =>\n            k.toLowerCase().includes(\"auth\") ||\n            k.toLowerCase().includes(\"token\") ||\n            k.toLowerCase().includes(\"key\")\n              ? [k, \"***REDACTED***\"]\n              : [k, v]\n          )\n        )\n      : undefined,\n  });\n\n  const",
      "tokens": 0,
      "firstFile": {
        "name": "server/routes.ts",
        "start": 470,
        "end": 486,
        "startLoc": {
          "line": 470,
          "column": 3,
          "position": 4074
        },
        "endLoc": {
          "line": 486,
          "column": 6,
          "position": 4232
        }
      },
      "secondFile": {
        "name": "server/routes/webhooks.ts",
        "start": 22,
        "end": 41,
        "startLoc": {
          "line": 22,
          "column": 1,
          "position": 100
        },
        "endLoc": {
          "line": 41,
          "column": 4,
          "position": 256
        }
      }
    },
    {
      "format": "typescript",
      "lines": 17,
      "fragment": "const redactChannelConfig = (channel: any) => {\n    const redacted = { ...channel };\n    if (redacted.config) {\n      const config = { ...redacted.config };\n      if (\"botToken\" in config) config.botToken = \"***REDACTED***\";\n      if (\"webhookUrl\" in config)\n        config.webhookUrl = config.webhookUrl.replace(\n          /\\/[^/]+$/,\n          \"/***REDACTED***\"\n        );\n      if (\"password\" in config) config.password = \"***REDACTED***\";\n      redacted.config = config;\n    }\n    return redacted;\n  };\n\n  // ============================================================",
      "tokens": 0,
      "firstFile": {
        "name": "server/routes.ts",
        "start": 507,
        "end": 523,
        "startLoc": {
          "line": 507,
          "column": 3,
          "position": 4336
        },
        "endLoc": {
          "line": 523,
          "column": 64,
          "position": 4497
        }
      },
      "secondFile": {
        "name": "server/routes/notifications.ts",
        "start": 27,
        "end": 43,
        "startLoc": {
          "line": 27,
          "column": 1,
          "position": 127
        },
        "endLoc": {
          "line": 43,
          "column": 80,
          "position": 286
        }
      }
    }
  ]
}

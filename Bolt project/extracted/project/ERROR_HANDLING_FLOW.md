# Error Handling Flow Diagram

## API Call Flow with Error Handling

```
┌─────────────────────────────────────────────────────────────────┐
│                        Component Loads                           │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
                   ┌─────────────────────┐
                   │  useQuery Hook      │
                   │  - data             │
                   │  - isLoading        │
                   │  - error            │
                   │  - refetch          │
                   └──────────┬──────────┘
                              │
                              ▼
                   ┌──────────────────────┐
                   │  Make API Request    │
                   └──────────┬───────────┘
                              │
                ┌─────────────┴─────────────┐
                │                           │
                ▼                           ▼
    ┌────────────────────┐      ┌─────────────────────┐
    │   Success (200)    │      │   Error (4xx/5xx)   │
    └──────────┬─────────┘      └──────────┬──────────┘
               │                           │
               ▼                           ▼
    ┌──────────────────┐       ┌────────────────────────┐
    │ data = response  │       │ error = Error object   │
    │ isLoading = false│       │ isLoading = false      │
    └──────────┬───────┘       └──────────┬─────────────┘
               │                           │
               │                           ▼
               │              ┌──────────────────────────┐
               │              │ Check Error Type         │
               │              └──────────┬───────────────┘
               │                         │
               │              ┌──────────┴───────────┐
               │              │                      │
               │              ▼                      ▼
               │    ┌──────────────────┐   ┌──────────────────┐
               │    │  Auth Error      │   │  Network Error   │
               │    │  (401/403)       │   │  (500/Network)   │
               │    └─────────┬────────┘   └────────┬─────────┘
               │              │                      │
               │              ▼                      ▼
               │    ┌──────────────────┐   ┌──────────────────┐
               │    │  No Retry        │   │  Retry 2x with   │
               │    │  Show Auth Error │   │  Backoff         │
               │    └──────────────────┘   └────────┬─────────┘
               │                                     │
               │                           ┌─────────┴─────────┐
               │                           │                   │
               │                           ▼                   ▼
               │                  ┌─────────────┐    ┌─────────────┐
               │                  │  Success    │    │  Still Fails│
               │                  └──────┬──────┘    └──────┬──────┘
               │                         │                  │
               └─────────────────────────┘                  │
                              │                             │
                              ▼                             ▼
                   ┌─────────────────────┐      ┌─────────────────────┐
                   │  Render Component   │      │  Render Error State │
                   │  with Data          │      │  with Retry Button  │
                   └─────────────────────┘      └──────────┬──────────┘
                                                            │
                                                            ▼
                                               ┌───────────────────────┐
                                               │  User Clicks Retry   │
                                               └──────────┬────────────┘
                                                          │
                                                          ▼
                                               ┌───────────────────────┐
                                               │  refetch() called     │
                                               │  (Loop back to API)   │
                                               └───────────────────────┘
```

## Component Render Decision Tree

```
┌──────────────────────────────────────────────────────────────────┐
│                     Component Render Logic                        │
└───────────────────────────────┬──────────────────────────────────┘
                                │
                                ▼
                    ┌────────────────────────┐
                    │  isLoading && !data?   │
                    └────────┬───────────────┘
                             │
                    ┌────────┴────────┐
                    │                 │
                YES ▼                 │ NO
        ┌──────────────────┐          │
        │  Show Loading    │          │
        │  Spinner +       │          │
        │  Message         │          │
        └──────────────────┘          │
                                      ▼
                          ┌──────────────────────┐
                          │  error && !data?     │
                          └────────┬─────────────┘
                                   │
                          ┌────────┴────────┐
                          │                 │
                      YES ▼                 │ NO
            ┌──────────────────────┐        │
            │  Show Full Error     │        │
            │  Page with Retry     │        │
            └──────────────────────┘        │
                                            ▼
                                ┌──────────────────────┐
                                │  data exists?        │
                                └────────┬─────────────┘
                                         │
                                ┌────────┴────────┐
                                │                 │
                            YES ▼                 │ NO
                  ┌──────────────────────┐        │
                  │  Render Component    │        │
                  │  with Data           │        │
                  └──────────┬───────────┘        │
                             │                    │
                             ▼                    ▼
                  ┌──────────────────────┐  ┌──────────────┐
                  │  Check for Partial   │  │  Show Empty  │
                  │  Errors?             │  │  State       │
                  └──────────┬───────────┘  └──────────────┘
                             │
                    ┌────────┴────────┐
                    │                 │
                YES ▼                 │ NO
      ┌──────────────────────┐        │
      │  Show Warning Banner │        │
      │  + Available Data    │        │
      └──────────────────────┘        │
                                      ▼
                          ┌──────────────────────┐
                          │  Show Complete Data  │
                          └──────────────────────┘
```

## Multi-API Graceful Degradation

```
┌────────────────────────────────────────────────────────────────┐
│                     Page with 3 APIs                            │
│  1. Portfolio API (Critical)                                    │
│  2. Strategies API (Important)                                  │
│  3. Events API (Nice to have)                                   │
└─────────────────────────────┬──────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Load All 3 APIs in Parallel  │
              └───────┬───────────────────────┘
                      │
        ┌─────────────┼─────────────┐
        │             │             │
        ▼             ▼             ▼
    Portfolio     Strategies     Events
        │             │             │
        │             │             │
        ▼             ▼             ▼

┌─────────────────────────────────────────────────────────────────┐
│                     Scenario 1: All Success                      │
├─────────────────────────────────────────────────────────────────┤
│  ✓ Portfolio     ✓ Strategies     ✓ Events                     │
│                                                                  │
│  Result: Show complete dashboard with all data                  │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│              Scenario 2: Critical API Fails                      │
├─────────────────────────────────────────────────────────────────┤
│  ✗ Portfolio     ✓ Strategies     ✓ Events                     │
│                                                                  │
│  Result: Show full error page with retry button                 │
│          (Can't function without critical data)                 │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│              Scenario 3: Non-Critical Fails                      │
├─────────────────────────────────────────────────────────────────┤
│  ✓ Portfolio     ✗ Strategies     ✓ Events                     │
│                                                                  │
│  Result:                                                         │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ ⚠ Warning: Unable to load strategies                   │    │
│  └────────────────────────────────────────────────────────┘    │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ Portfolio Metrics                                       │    │
│  │  $50K    +$500    5 Strategies    $20K                │    │
│  └────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────┐  ┌──────────────────────────────┐    │
│  │ Strategies          │  │ AI Activity                  │    │
│  │                     │  │  • Event 1                   │    │
│  │  ⚠ Unable to load   │  │  • Event 2                   │    │
│  │  [Retry]            │  │  • Event 3                   │    │
│  └─────────────────────┘  └──────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│              Scenario 4: All Non-Critical Fail                   │
├─────────────────────────────────────────────────────────────────┤
│  ✓ Portfolio     ✗ Strategies     ✗ Events                     │
│                                                                  │
│  Result:                                                         │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ ⚠ Warning: Unable to load strategies and events        │    │
│  └────────────────────────────────────────────────────────┘    │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ Portfolio Metrics (still works!)                       │    │
│  │  $50K    +$500    5 Strategies    $20K                │    │
│  └────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────┐  ┌──────────────────────────────┐    │
│  │ Strategies          │  │ AI Activity                  │    │
│  │  ⚠ Unable to load   │  │  ⚠ Unable to load            │    │
│  │  [Retry]            │  │  [Retry]                     │    │
│  └─────────────────────┘  └──────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│              Scenario 5: All APIs Fail                           │
├─────────────────────────────────────────────────────────────────┤
│  ✗ Portfolio     ✗ Strategies     ✗ Events                     │
│                                                                  │
│  Result:                                                         │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ Dashboard                                               │    │
│  │ Overview of your trading performance                    │    │
│  │                                                          │    │
│  │  ╔═══════════════════════════════════════════════════╗ │    │
│  │  ║          ⚠                                        ║ │    │
│  │  ║    Unable to load dashboard                       ║ │    │
│  │  ║                                                    ║ │    │
│  │  ║    API Error: 401 Unauthorized                    ║ │    │
│  │  ║    Could not connect to the server                ║ │    │
│  │  ║                                                    ║ │    │
│  │  ║           [Try Again]                             ║ │    │
│  │  ╚═══════════════════════════════════════════════════╝ │    │
│  └────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
```

## Retry Logic Flow

```
┌────────────────────────────────────────────────────────────────┐
│                      API Request Fails                          │
└─────────────────────────────┬──────────────────────────────────┘
                              │
                              ▼
                   ┌──────────────────────┐
                   │  Analyze Error       │
                   └──────────┬───────────┘
                              │
                ┌─────────────┴─────────────┐
                │                           │
                ▼                           ▼
    ┌────────────────────┐      ┌─────────────────────┐
    │   4xx Error        │      │   5xx/Network Error │
    │   (Client Error)   │      │   (Server Error)    │
    └──────────┬─────────┘      └──────────┬──────────┘
               │                           │
               ▼                           ▼
    ┌────────────────────┐      ┌──────────────────────┐
    │  401/403?          │      │  Retry with Backoff  │
    └──────────┬─────────┘      └──────────┬───────────┘
               │                           │
        ┌──────┴──────┐                    │
        │             │                    ▼
    YES ▼             │ NO       Attempt 1: Wait 1s
┌───────────────┐     │          Attempt 2: Wait 2s
│  No Retry     │     │          Attempt 3: Wait 4s
│  Show Auth    │     │                    │
│  Error        │     │          ┌─────────┴─────────┐
└───────────────┘     │          │                   │
                      ▼      SUCCESS ▼               │ FAIL
            ┌───────────────┐  ┌───────────┐        │
            │  No Retry     │  │  Return   │        │
            │  Show Error   │  │  Data     │        │
            └───────────────┘  └───────────┘        │
                                                     ▼
                                          ┌──────────────────┐
                                          │  Show Error +    │
                                          │  Retry Button    │
                                          └────────┬─────────┘
                                                   │
                                                   ▼
                                          ┌──────────────────┐
                                          │  User Clicks     │
                                          │  Retry           │
                                          └────────┬─────────┘
                                                   │
                                                   ▼
                                          ┌──────────────────┐
                                          │  refetch()       │
                                          │  Start Over      │
                                          └──────────────────┘
```

## State Machine

```
                    ┌──────────┐
                    │   IDLE   │
                    └────┬─────┘
                         │
                         ▼
                    ┌──────────┐
                    │ LOADING  │
                    └────┬─────┘
                         │
              ┌──────────┴──────────┐
              │                     │
              ▼                     ▼
        ┌──────────┐          ┌──────────┐
        │ SUCCESS  │          │  ERROR   │
        └────┬─────┘          └────┬─────┘
             │                     │
             │                     ▼
             │              ┌─────────────┐
             │              │  RETRYING   │
             │              └─────┬───────┘
             │                    │
             │         ┌──────────┴──────────┐
             │         │                     │
             │         ▼                     ▼
             │   ┌──────────┐          ┌──────────┐
             └───│ SUCCESS  │          │  ERROR   │
                 └──────────┘          └────┬─────┘
                                            │
                                            ▼
                                     ┌─────────────┐
                                     │ User Retry  │
                                     │  (refetch)  │
                                     └─────┬───────┘
                                           │
                                           ▼
                                     ┌──────────┐
                                     │ LOADING  │
                                     └──────────┘
```

This comprehensive error handling ensures users never get stuck with infinite loading spinners and always have a path to recovery!

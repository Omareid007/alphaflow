Before doing anything:

1. Open and follow docs/AGENT_EXECUTION_GUIDE.md as the primary governance document for this repo.
2. Open docs/INDEX.md and treat it as the front door for documentation navigation.
3. When the guide or INDEX tells you to consult other docs (such as:
   - docs/APP_OVERVIEW.md
   - docs/ARCHITECTURE.md
   - docs/ORCHESTRATOR_AND_AGENT_RUNTIME.md
   - docs/AI_MODELS_AND_PROVIDERS.md
   - docs/CONNECTORS_AND_INTEGRATIONS.md
   - docs/FINANCIAL_METRICS.md
   - docs/TESTING.md
   - docs/OBSERVABILITY.md
   - docs/LESSONS_LEARNED.md
   - docs/API_REFERENCE.md
   - docs/EVENT_SCHEMA_REGISTRY.md
   - docs/MICROSERVICES_ROADMAP.md
   - docs/DATA_MIGRATION_STRATEGY.md
   - docs/N8N_INTEGRATION_GUIDE.md
   - docs/listener_context_table_spec.md
   - docs/COMPETITIVE_BENCHMARKING.md
   - docs/services/*.md
   - docs/providers/*.md
   - docs/adr/*.md
   and any other .md files in docs/),
   open and follow those sections before starting changes.

4. Classify this task as:
   - Type: DOCUMENTATION REFACTOR, CONSOLIDATION & CLEANUP (no functional code changes).
   - Priority: HIGH (governance + onboarding + future work).
   - Goal: Make the docs easier to navigate, non-duplicated, clearly status-labelled, and tightly aligned with the actual code and architecture.

You ARE allowed to:
- Reorganise and restructure docs in the docs/ folder.
- Merge overlapping content and **delete truly duplicated text** once it is safely represented in one canonical place.
- Create new docs (like INDEX, API_REFERENCE, etc.) or split big docs into smaller focused ones.
- Add “Status” labels, “When to update this doc” sections, and tags/timestamps.

You are NOT allowed to:
- Change business logic, trading logic, or external API behaviour in code.
- Remove unique information that does not exist anywhere else.
- Fabricate architecture or behaviour that is not supported by the current codebase.

==================================================
PHASE A – DISCOVERY & REFACTOR PLAN (READ-ONLY FIRST)
==================================================

1) Inventory docs/
- Enumerate all Markdown files under docs/ and subfolders:
  - Core: INDEX, AGENT_EXECUTION_GUIDE, APP_OVERVIEW, ARCHITECTURE, ORCHESTRATOR_AND_AGENT_RUNTIME, AI_MODELS_AND_PROVIDERS, CONNECTORS_AND_INTEGRATIONS, FINANCIAL_METRICS, TESTING, OBSERVABILITY, LESSONS_LEARNED, API_REFERENCE, EVENT_SCHEMA_REGISTRY, MICROSERVICES_ROADMAP, DATA_MIGRATION_STRATEGY, N8N_INTEGRATION_GUIDE, listener_context_table_spec, COMPETITIVE_BENCHMARKING.
  - Service specs: docs/services/*.md
  - Provider capability docs: docs/providers/*.md
  - ADRs: docs/adr/*.md
- For each, note internally:
  - Purpose (overview, architecture, runtime, AI, connectors, metrics, testing, observability, roadmap, lessons, automation, etc.).
  - Intended audience (dev, PM, DevOps, AI/agent, etc.).
  - Main topics covered and obvious overlaps with other docs.

2) Scan code & behaviour
- At a high level, verify against the codebase:
  - Backend: orchestrator, trading engine, connectors, repositories, P&L logic.
  - Frontend: dashboard, analytics, strategy builder, positions/trades, settings.
  - Testing: unit/integration/E2E structure and current coverage.
  - Observability: logger usage, correlation IDs, log categories.
  - AI integration: where AI calls happen and via which provider abstractions.
- Identify where docs:
  - Describe features that no longer exist, or
  - Miss features that now exist, or
  - Duplicate the same explanation in multiple places.

3) Build a concise internal refactor plan
Before editing docs, decide (internally, in your own planning step):

- For each major topic, what is the **canonical home**:
  - Product overview & narrative → APP_OVERVIEW.md
  - Navigation & entry points → INDEX.md
  - Architecture (C4 views) → ARCHITECTURE.md
  - Orchestrator runtime behaviour → ORCHESTRATOR_AND_AGENT_RUNTIME.md
  - AI providers, routing, prompts → AI_MODELS_AND_PROVIDERS.md
  - Connectors & external integrations → CONNECTORS_AND_INTEGRATIONS.md + providers/*.md
  - Financial metrics & P&L logic → FINANCIAL_METRICS.md
  - Testing philosophy & backlog → TESTING.md
  - Observability & logging → OBSERVABILITY.md
  - Lessons & meta-learning → LESSONS_LEARNED.md
  - HTTP APIs → API_REFERENCE.md
  - Events & event schemas → EVENT_SCHEMA_REGISTRY.md
  - Microservices roadmap → MICROSERVICES_ROADMAP.md
  - Migration strategy → DATA_MIGRATION_STRATEGY.md
  - Automation/webhooks/n8n → N8N_INTEGRATION_GUIDE.md
  - Signal/feature space → listener_context_table_spec.md
  - Competitive context → COMPETITIVE_BENCHMARKING.md
  - Service-specific detail → docs/services/*.md
  - Long-term decisions → docs/adr/*.md

- Decide what will happen with duplicates:
  - For each overlapping topic, pick ONE canonical doc for the full explanation.
  - Other docs should keep only a short summary + link to the canonical doc.
  - Duplicated paragraphs will be removed after they are safely represented in that canonical home.

Only after you have this mental plan, start editing.

==================================================
PHASE B – ENTRYPOINT & NAVIGATION IMPROVEMENTS
==================================================

4) Strengthen docs/INDEX.md
- Ensure INDEX.md contains:
  - Short description of the app.
  - Role-based navigation (New dev, AI/Replit agent, Backend dev, DevOps, QA).
  - **Task-based navigation**: add a small table like:
    - Fix P&L / metrics → FINANCIAL_METRICS → TESTING → OBSERVABILITY.
    - Add/modify connector → CONNECTORS_AND_INTEGRATIONS → relevant providers/*.md → TESTING.
    - Modify orchestrator behaviour → ORCHESTRATOR_AND_AGENT_RUNTIME → ARCHITECTURE → TESTING.
    - Add or change AI logic → AI_MODELS_AND_PROVIDERS → ORCHESTRATOR_AND_AGENT_RUNTIME → TESTING.
  - A “If you are completely new” route: AGENT_EXECUTION_GUIDE → APP_OVERVIEW → ARCHITECTURE.

5) Update AGENT_EXECUTION_GUIDE.md
- Keep the detailed content, but:
  - Make sure the **Quick Checklist** at the top is compact and actionable.
  - Add an explicit line: “For navigation and entry points, see docs/INDEX.md.”
  - Ensure the guide explicitly mentions:
    - Always find the canonical doc for a topic before adding new explanations.
    - Prefer linking to that doc instead of duplicating content.

==================================================
PHASE C – CANONICALISE & DE-DUPLICATE BY TOPIC
==================================================

For each of the major docs below, follow this pattern:
- Keep unique content.
- Move overlapping content into one canonical doc.
- Replace removed duplicates with a short summary + link.
- You ARE allowed to delete duplicated paragraphs once they are safely represented in the canonical file.

6) APP_OVERVIEW.md (Product & system overview)
- Confirm this is the **one place** where:
  - The high-level product vision and feature overview live.
  - The main user flows are described in natural language.
- Remove or drastically shorten low-level architecture/connector/AI/logging content that is fully described in other docs.
- Replace removed parts with short links to:
  - ARCHITECTURE (for technical structure).
  - AI_MODELS_AND_PROVIDERS (for AI details).
  - CONNECTORS_AND_INTEGRATIONS (for integration details).
- Keep any “Old vs New / Enhancements” section but make it concise and non-duplicated with ARCHITECTURE.

7) ARCHITECTURE.md (C4 architecture)
- Make this the **canonical technical architecture**:
  - Context view (system + external actors).
  - Container view (frontend/backends/data stores/external systems).
  - Component/service view where critical, or via links to service docs.
- Remove product narrative and high-level business descriptions already covered in APP_OVERVIEW; replace with a “See APP_OVERVIEW” pointer.
- For any microservices content:
  - Keep high-level structure and link to MICROSERVICES_ROADMAP.md and docs/services/*.md for detailed rollout.
- Ensure all service docs and event docs are referenced from here, not duplicated.

8) ORCHESTRATOR_AND_AGENT_RUNTIME.md (runtime behaviour)
- Focus this doc on:
  - Orchestrator cycles and states.
  - Agent runtime modes and transitions.
  - Risk limits, kill switches, safety behaviour.
  - Relation to events (with links to EVENT_SCHEMA_REGISTRY).
- Remove generic architecture content and product description, linking back to ARCHITECTURE and APP_OVERVIEW instead.
- Keep or add a concise “Old vs New Orchestrator Behaviour” section describing safety and reliability improvements.

9) AI_MODELS_AND_PROVIDERS.md (AI usage)
- Ensure this is the **single detailed spec** for:
  - AI providers (OpenAI/OpenRouter/others).
  - What each provider is used for (signals, explanations, Q&A, etc.).
  - Prompt patterns and cost-control strategies.
- Remove AI deep-dives from other docs (except 1-2 line summaries) and replace them with links here.
- Harmonise with provider capability docs in docs/providers/*.md:
  - High-level “who/what/why” here.
  - Detailed per-provider capability tables in the provider docs.

10) CONNECTORS_AND_INTEGRATIONS.md + docs/providers/*.md
- Make CONNECTORS_AND_INTEGRATIONS.md the **canonical inventory** of connectors:
  - For each connector:
    - Name, purpose, main data type (e.g. quotes, account, news).
    - Implementation status (see status section below).
    - Pointer to its provider doc in docs/providers/.
- In each provider doc (e.g. ALPACA_CAPABILITIES.md, FINNHUB_CAPABILITIES.md, COINGECKO_CAPABILITIES.md, OPENAI_CAPABILITIES.md):
  - Clearly separate:
    - Actively used features → mapped to code modules.
    - Underused features → potential improvements.
    - Not yet implemented features → backlog ideas.
- Remove duplicate capability explanations from AI_MODELS_AND_PROVIDERS and APP_OVERVIEW; keep only short summaries + links.

11) FINANCIAL_METRICS.md (financial logic)
- Treat this as the **source of truth** for:
  - P&L formulas (unrealised, realised, total).
  - Performance metrics (win rate, profit factor, etc.).
  - Risk metrics and trade classification.
- Move detailed P&L formulas / metric explanations here if they appear in other docs.
- In other docs (APP_OVERVIEW, ARCHITECTURE, ORCHESTRATOR), keep only short references like “For details see FINANCIAL_METRICS.md”.

12) TESTING.md (testing strategy & backlog)
- Consolidate **all testing TODO / Not Yet Implemented tests** from other docs into a testing backlog table here.
- Ensure TESTING.md clearly defines:
  - Which flows must always be covered (trading, P&L, orchestrator, connectors).
  - Current coverage vs gaps.
- Remove duplicated testing philosophy paragraphs from other docs; replace with a link here.

13) OBSERVABILITY.md (logging & monitoring)
- Make this the **only detailed logging & observability spec**:
  - Log levels, categories, log structure, correlation IDs, redaction rules.
  - Any metrics/tracing expectations.
- Remove repeated logging guidance from other docs; keep a one-line “see OBSERVABILITY” reference.

14) LESSONS_LEARNED.md
- Keep all existing lessons.
- For each lesson or group:
  - Add a date/timestamp if missing.
  - Add simple tags like [P&L], [Orchestrator], [AI], [Docs], [Testing], [Connectors].
- If some lessons are now fully addressed by new processes/docs:
  - Add a short note linking to the relevant doc section (e.g. TESTING, ARCHITECTURE).

15) MICROSERVICES_ROADMAP.md, DATA_MIGRATION_STRATEGY.md, N8N_INTEGRATION_GUIDE.md, listener_context_table_spec.md, COMPETITIVE_BENCHMARKING.md
- MICROSERVICES_ROADMAP:
  - Keep microservices vision and phased rollout here.
  - Remove architecture duplication; link to ARCHITECTURE for diagrams and service structure.
- DATA_MIGRATION_STRATEGY:
  - Ensure it references actual schemas/entities used now.
  - Clearly link it to MICROSERVICES_ROADMAP and relevant service docs.
- N8N_INTEGRATION_GUIDE:
  - Clearly mark as “Optional / Experimental”.
  - Link from CONNECTORS_AND_INTEGRATIONS under an “Automation / Workflows” subsection.
- listener_context_table_spec.md:
  - Link it from:
    - AI_MODELS_AND_PROVIDERS (Feature/Signal space section).
    - docs/services/AI_DECISION.md or equivalent.
    - FINANCIAL_METRICS.md if any metrics directly depend on signal fields.
- COMPETITIVE_BENCHMARKING:
  - Ensure proposed features here tie back into ROADMAP or MICROSERVICES_ROADMAP; don’t let them float as disconnected ideas.

16) Service docs (docs/services/*.md) and ADRs (docs/adr/*.md)
- Service_docs:
  - Keep them focused on that service’s:
    - Responsibilities.
    - Public APIs.
    - Events produced/consumed.
    - Dependencies.
  - Remove general architecture explanations duplicated from ARCHITECTURE; link back instead.
- ADRs:
  - Keep structure (Status, Context, Decision, Consequences).
  - Ensure major decisions (microservices, event bus, AI routing, etc.) are referenced from ARCHITECTURE and APP_OVERVIEW.

==================================================
PHASE D – STATUS LABELS & CENTRAL API/EVENT CONTRACTS
==================================================

17) Apply consistent Status labels
Use a consistent vocabulary everywhere:

- Implemented
- Partially Implemented
- Planned
- Deprecated

Apply these labels to:

- Each connector in CONNECTORS_AND_INTEGRATIONS.md.
- Each provider / feature group in docs/providers/*.md.
- Each service in docs/services/*.md and MICROSERVICES_ROADMAP.md.
- Each metric in FINANCIAL_METRICS.md (e.g. columns: Implemented (Y/N), Used in UI (Y/N), Tested (Y/N)).
- Each major test area in TESTING.md backlog.
- Any major AI capability in AI_MODELS_AND_PROVIDERS.md.

18) API_REFERENCE.md (REST contract)
- Ensure API_REFERENCE.md is the **single place** listing HTTP/REST endpoints:
  - Group endpoints by domain (trading, orchestrator, analytics, admin, etc.).
  - For each endpoint:
    - Method, path, purpose, and link to the relevant service doc.
    - Add a “Stability” column: Stable / Experimental / Internal.
- Where other docs mention endpoints, replace detailed lists with a link to API_REFERENCE.

19) EVENT_SCHEMA_REGISTRY.md (events contract)
- For each event:
  - Clearly indicate:
    - Produced by: <service(s)>
    - Consumed by: <service(s)>
    - Link to relevant service docs.
- If event descriptions are duplicated in services or ORCHESTRATOR docs, replace with a summary + link back to the registry.

==================================================
PHASE E – “WHEN TO UPDATE THIS DOC” HOOKS
==================================================

20) Add “When to update this doc” sections
For these docs at minimum:

- AI_MODELS_AND_PROVIDERS.md
- CONNECTORS_AND_INTEGRATIONS.md
- FINANCIAL_METRICS.md
- TESTING.md
- OBSERVABILITY.md
- APP_OVERVIEW.md
- ARCHITECTURE.md
- ORCHESTRATOR_AND_AGENT_RUNTIME.md

Add a small section near the bottom titled “When to update this document”, listing triggers such as:

- New provider added or removed.
- P&L formulas changed or new metrics added.
- New critical tests added or a test pillar created.
- New log categories or observability tools introduced.
- New service split or architecture evolution done.
- Major orchestrator behaviour changes.

This ensures future changes automatically come with doc updates.

==================================================
PHASE F – FINAL CONSISTENCY & NAVIGATION CHECK
==================================================

21) Duplication & consistency pass
- Do a final sweep to ensure:
  - For each topic, there is exactly one canonical detailed explanation.
  - Other docs contain only short summaries + links.
  - No long duplicated paragraphs remain.
- Verify all internal links between docs are valid.

22) Execution summary & lessons
- At the end of the work:
  - Add a new entry in LESSONS_LEARNED.md summarising:
    - What changed in the docs structure.
    - What worked well (e.g. INDEX, API_REFERENCE, status labels).
    - Guidelines for future doc writers (e.g. “always pick a canonical home before writing”).

==================================================
EXECUTION RULES
==================================================

- This task is **docs-first**:
  - Only change code if a comment or annotation is clearly incorrect or to fix doc references.
- Prefer:
  - Shorter, clearer docs with cross-links over long, repetitive pages.
  - Layered documentation: overview → architecture → service spec → code.
- Always align docs with actual implementation, not assumptions.
- Any time you remove text, ensure its information is either:
  - Redundant with the canonical doc, or
  - Migrated to the canonical doc before deletion.

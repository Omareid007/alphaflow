{
  "title": "Section 1 — Make AI Active Trader match 'ai-trading' best practices: end-to-end explainable flow + real broker-truth UI",
  "non_negotiables": [
    "NO mock/demo data in user-facing flows unless explicitly labeled and disabled by default",
    "Do NOT claim a task is done unless you can prove it via: (1) code changes, (2) API response validation, (3) UI button end-to-end behavior",
    "Reuse existing modules/screens/endpoints whenever possible — avoid duplicating Admin pages or creating parallel dashboards"
  ],
  "read_first": {
    "docs": [
      "docs/APP_OVERVIEW.md",
      "docs/ARCHITECTURE.md",
      "docs/SOURCE_OF_TRUTH_CONTRACT.md",
      "docs/ORDER_LIFECYCLE.md",
      "docs/TRADING_SAGA_SEQUENCES.md",
      "docs/UI_INFORMATION_ARCHITECTURE.md",
      "docs/API_BUDGETING_AND_CACHING.md",
      "docs/AI_MODELS_AND_PROVIDERS.md",
      "docs/OBSERVABILITY.md",
      "docs/AUDIT_DOC_VS_IMPLEMENTATION_GAP.md",
      "docs/ADMIN_DASHBOARD.md",
      "docs/ADMIN_ACCESS.md"
    ],
    "code_hotspots": [
      "server/ai/llmGateway.ts",
      "server/trading/alpaca-stream.ts",
      "server/routes.ts (endpoints: /api/orders, /api/fills, /api/admin/*)",
      "client/screens/AdminHubScreen.tsx"
    ]
  },
  "goal": "Make the UI and Admin Hub reflect a single real workflow: Universe -> Signal -> Decision(traceId) -> Order(brokerOrderId) -> Fill -> Position -> Performance, with meaningful statuses and full explainability.",
  "deliverables": [
    {
      "type": "doc",
      "path": "docs/COMPETITOR_PATTERNS_AI_TRADING_TOPIC.md",
      "content_requirements": [
        "Summarize the reusable patterns we are adopting (microservices/modules, dashboard timeline, agent roles, data reusability)",
        "Map each pattern to our actual modules/screens/endpoints (with file paths)",
        "List what we intentionally will NOT implement in this iteration"
      ]
    },
    {
      "type": "ui",
      "name": "End-to-end Timeline View",
      "requirements": [
        "Create/upgrade a primary screen (or enhance existing) that shows a single timeline per traceId:",
        "Cycle/Run -> LLM Calls -> Decision -> Orders -> Fills -> Position impact",
        "Every item must be clickable and show raw supporting metadata (model used, provider, cost estimate, data sources, broker ids).",
        "Statuses must come from real broker-synced order/fill states (DB is fine IF it is synced from broker via alpaca-stream)."
      ]
    },
    {
      "type": "ui",
      "name": "Fix Trade Ledger semantics",
      "requirements": [
        "If Trade Ledger currently shows internal DB 'trades' that don't map to orders/fills, either:",
        "(A) replace it with Orders+Fills+Realized P&L view, or",
        "(B) keep it but enforce a strict mapping: trade -> orderId/brokerOrderId -> fill ids",
        "Remove or relabel meaningless statuses like pending_execution if not tied to the ORDER_LIFECYCLE state machine."
      ]
    },
    {
      "type": "admin",
      "name": "Make AdminHubScreen authoritative (WordPress-style single admin entry)",
      "requirements": [
        "Keep ALL admin-related components under AdminHubScreen (do not scatter new admin pages elsewhere)",
        "Add missing backend endpoints only if an Admin module is currently calling a non-existent route",
        "Ensure each Admin section has: live data, refresh button, and at least one actionable control (pause/resume orchestrator, purge cache with capability check, retry dead letters, etc.)"
      ]
    },
    {
      "type": "routing",
      "name": "Separate Admin entry point + access guide",
      "requirements": [
        "Create a dedicated navigation entry point to Admin (web + mobile) WITHOUT breaking existing routes",
        "Update docs/ADMIN_ACCESS.md with exact steps to reach Admin in web and mobile builds"
      ]
    }
  ],
  "implementation_steps": [
    "1) Inventory existing UI screens that show: Trade Ledger, AI Suggested Trades, Auto Trading, Analytics. Identify duplicates and decide ONE canonical flow screen.",
    "2) Confirm reality of data sources used by each UI card/table: does it call /api/orders, /api/fills, /api/positions, /api/trades, or /api/ai-decisions/history? Document this in docs/COMPETITOR_PATTERNS_AI_TRADING_TOPIC.md.",
    "3) Implement a Trace Timeline viewer using existing endpoints first: /api/admin/trace/:traceId (if available) + /api/orders + /api/fills. If missing, create a minimal endpoint that returns the stitched timeline by traceId.",
    "4) Update Trade Ledger UI to use broker-synced Orders+Fills as primary truth. Keep internal AI decisions as annotations, not as the ledger itself.",
    "5) Wire AdminHubScreen modules to real endpoints; remove dead UI controls or connect them properly.",
    "6) Add a visible 'Source of truth' badge on every table (broker-synced DB vs internal decision log) to prevent confusion."
  ],
  "verification": {
    "api_checks": [
      "GET /api/orders returns non-empty orders after at least one orchestrator cycle triggers an order submit",
      "GET /api/fills returns fills for at least one executed order (or shows empty with clear reason if none)",
      "AdminHubScreen 'Orders' section matches /api/orders output",
      "Timeline view renders a complete chain Decision->Order->Fill for at least one traceId"
    ],
    "ui_checks": [
      "All primary buttons perform a real action and show success/error states",
      "No duplicated widgets showing conflicting values for the same concept (positions/orders/trades)",
      "Pending/success/skipped labels only appear when tied to a real state machine transition"
    ],
    "code_quality": [
      "npm run check:types",
      "npm run lint",
      "Update docs when behavior changes (especially ADMIN_ACCESS.md and UI_INFORMATION_ARCHITECTURE.md)"
    ]
  },
  "definition_of_done": [
    "A user can open ONE main workflow UI and understand: what the system decided, why, what order was placed, what filled, and how it impacted positions.",
    "AdminHub is the single admin surface and every section actually works against live endpoints.",
    "Docs updated so implementation matches reality."
  ]
}

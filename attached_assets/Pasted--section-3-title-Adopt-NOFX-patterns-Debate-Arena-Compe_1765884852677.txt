{
"section": "3",
"title": "Adopt NOFX patterns (Debate Arena + Competition Mode + Strategy Studio UX) + MCP-style tool routing (Alpaca)",
"role": "Senior software engineer + CTO",
"repo_context": {
"app_name": "AI Active Trader",
"execution_source_of_truth": "Alpaca broker (orders/positions/fills)",
"llm_sources_available": ["OpenRouter (primary for powerful/specialized models)", "OpenAI (use smaller models for cheap/simple tasks)"],
"non_negotiables": [
"No mock/demo data in any production flow",
"Do not claim implementation is done unless verified by reading code AND running",
"Every order op must go through the durable work queue + idempotency",
"All actions must be traceId-linked end-to-end",
"Do NOT store raw chain-of-thought; store structured rationale summaries only"
]
},
"why_this_section": {
"goal": "Fix UX + AI-engine reliability by borrowing the best product primitives from NOFX (debate, competition, web-based config) while keeping your Alpaca-based execution model intact.",
"inspiration_notes": [
"NOFX has a Strategy Studio (visual builder), AI Debate Arena (Bull/Bear/Analyst roles), Competition Mode (multi-AI traders leaderboard), and backtest lab wizard UI.",
"Alpaca MCP server demonstrates a clean tool-based surface for market data + orders + account ops."
]
},
"read_first": {
"must_read_paths": [
"docs/",
"server/ (or backend equivalent)",
"client/** (or frontend equivalent)",
"any existing Admin/wordpress-like admin module",
"any existing LLM gateway / orchestrator / work-queue modules",
"any existing trade ledger + ai decisions history modules"
],
"output_required_before_coding": {
"name": "Reality Check (No Hallucinations)",
"format": [
"List exact files opened (paths)",
"Summarize what exists already for: Admin, orchestration, LLM router, trade state machine, decision logs",
"List gaps vs this section deliverables"
]
}
},
"deliverables": [
{
"name": "AI Debate Arena (minimal but real)",
"definition": [
"A debate session runs N roles in parallel (Bull, Bear, Risk Manager, Technical Analyst, Fundamental Analyst)",
"Each role returns a STRICT JSON output: {stance, confidence, key_signals[], risks[], invalidation_points[], proposed_action, proposed_order?, evidence_refs[]}",
"A final 'Judge/Consensus' step aggregates and outputs: {decision, order_intent?, reasons_summary, risk_checks, confidence, traceId}",
"If decision includes an order: enqueue ORDER_SUBMIT via work queue; do NOT bypass broker truth",
"Everything stored and trace-linked (session, messages, consensus, order mapping)"
],
"model_routing_policy": {
"heavy_roles": "OpenRouter (best available reasoning model you have access to)",
"cheap_roles": "OpenAI smaller models or OpenRouter free models for summarization/formatting/low-stakes tasks",
"guardrails": [
"Token budgets per role",
"Timeouts + retries + fallback models",
"Hard cap on debate rounds",
"Never store chain-of-thought; only store structured outputs + short rationale summaries"
]
}
},
{
"name": "AI Competition Mode (performance + accountability)",
"definition": [
"Allow multiple 'Traders' (each = strategy + model profile + risk preset) to run on the same symbol universe",
"All traders produce decisions, but execution is gated (configurable):",
" - Mode A: 'paper execute all' (each trader has its own paper sub-portfolio tracking, but orders still go through Alpaca paper in separate tags/identifiers)",
" - Mode B: 'recommend only' (no orders, just score)",
"Scoreboard metrics: ROI, max drawdown, win rate, avg hold time, #trades, error rate, cost per decision, slippage proxy",
"A/B compare traders side-by-side and allow promoting the best trader to 'Active'"
],
"data_integrity_rules": [
"Orders/positions must map to real Alpaca entities (no fake IDs)",
"Trade ledger must reflect broker truth; internal DB stores references and analytics only",
"Every score must be reproducible from stored decisions + broker fills"
]
},
{
"name": "Web-based Strategy Studio (Admin-first, no JSON editing)",
"definition": [
"Inside the existing WordPress-like Admin page, create a 'Strategy Studio' section with forms:",
" - Universe source (watchlist, screener, manual symbols, provider-backed candidates)",
" - Signals toggles (TA indicators, news/events triggers, fundamentals if available)",
" - Risk controls (position sizing, max exposure, stop/TP rules, cooldowns)",
" - LLM policy (which roles enabled, which model profiles used)",
"Provide 'Prompt Preview' + 'Dry Run' buttons that generate the exact feature-pack JSON and show expected outputs.",
"Strategies saved as versioned specs in DB (strategy_versions) with diff + rollback."
]
},
{
"name": "MCP-style Tool Router layer (internal pattern, optional external MCP later)",
"definition": [
"Define a tool registry for broker + data tools (getQuotes, getBars, listPositions, placeOrder, cancelOrder, etc.)",
"LLM never calls random endpoints; it can only request tool invocations with strict schemas",
"Tool invocations are executed by server with budgets/caching and audit logs",
"This mirrors the clean separation demonstrated by Alpaca MCP server, but keep it internal unless you explicitly decide to run MCP."
]
},
{
"name": "Admin UI consolidation + entry point",
"definition": [
"Ensure ALL admin-related pages/components are reachable from ONE Admin shell (WordPress-like page you already have).",
"Create a single entry route, e.g. /admin (or /app/admin), and document it.",
"Add left-nav groups:",
" - Providers & Budgets",
" - Orchestration & Work Queue",
" - AI Debate Arena",
" - Competition Mode",
" - Strategy Studio",
" - Trades (Broker Truth) + Decision Trace",
"Every button must work end-to-end with real backend calls."
]
},
{
"name": "Docs updates (mandatory)",
"definition": [
"docs/AI_DEBATE_ARENA.md (schemas, flows, configs, troubleshooting)",
"docs/AI_COMPETITION_MODE.md (scoring, execution gating, metrics)",
"docs/STRATEGY_STUDIO.md (admin UX, versioning, dry-run)",
"docs/ADMIN_DASHBOARD.md update (new sections + how to access /admin)",
"docs/TOOL_ROUTER.md (schemas, audit logs, allowed tools, how to add tools)"
]
}
],
"implementation_plan": [
{
"step": "1) DB schema + migrations",
"tasks": [
"Add tables: debate_sessions, debate_messages, debate_consensus, trader_profiles, competition_runs, competition_scores, strategy_specs, strategy_versions, tool_invocations",
"Add strong indexing on traceId and broker IDs",
"Add retention policy configs (keep raw responses limited; keep normalized/summary longer)"
]
},
{
"step": "2) Backend APIs",
"tasks": [
"POST /api/admin/strategy (create/update/version)",
"POST /api/admin/debate/start (inputs: symbol(s), strategyVersionId, traceId)",
"GET /api/admin/debate/:id (session + role outputs + consensus)",
"POST /api/admin/competition/start (trader set, universe, duration/mode)",
"GET /api/admin/competition/:id (leaderboard + drilldown)",
"POST /api/admin/tools/invoke (server-only; never expose dangerous tools publicly)"
]
},
{
"step": "3) Orchestrator wiring",
"tasks": [
"Add Debate pipeline as an orchestrator stage that produces a consensus object",
"If consensus includes order intent: route to ORDER_SUBMIT work item (existing durable queue)",
"Tag every order with: traceId, strategyVersionId, traderProfileId, decisionId",
"Guarantee decision→order→fill mapping always resolvable"
]
},
{
"step": "4) UI implementation",
"tasks": [
"In Admin shell: add new sections and components for Debate, Competition, Strategy Studio",
"Add drilldown pages: click a trade → see decision pack → debate role outputs → consensus → order → fills",
"Fix any existing duplicated/meaningless status labels by mapping to real state machine statuses",
"Add 'Run Dry' and 'Run Live' (paper) buttons with clear warnings"
]
},
{
"step": "5) Verification (no fake completion)",
"tasks": [
"Add integration test(s) for: debate start → consensus → optional order enqueued → order placed → fill recorded → UI shows it",
"Add smoke tests for Admin buttons",
"Add instrumentation: debate duration, per-role cost, cache hits, provider call counts",
"Update docs and ensure links exist in docs index"
]
}
],
"acceptance_criteria": [
"From /admin: create a strategy → dry run → start debate on a symbol → see role outputs + consensus → (optional) place paper order via queue → verify Alpaca order exists → see fill/position reflect in UI",
"Competition mode runs at least 2 trader profiles and shows leaderboard with real broker-linked trades (or recommend-only scores)",
"No unresolved 'pending_execution' artifacts without an actual work item/order reference",
"No mock data displayed anywhere unless explicitly labeled 'demo' and isolated from production",
"Docs updated and match reality (with commands + screenshots placeholders)"
],
"stop_when_done": [
"Stop after finishing this section’s deliverables and verification.",
"Print: what you implemented, what you ran, and what remains for the next section."
],
"next_section_preview": "Section 4 will cover: capitalise.ai + HKUDS/AI-Trader + broader ai-trading repos (benchmark features + what to borrow) + cost/value optimizations."
}